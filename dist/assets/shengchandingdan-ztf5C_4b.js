import{_ as ae,r as y,v as G,g as se,E as V,s as be,h as u,G as pe,o as v,l as W,w as a,a as r,b as e,e as ie,i as h,H as ce,q as U,c as F,x as q,a8 as Ve,F as X,m as Z,a9 as de,aa as ne,ab as fe,ac as ge,ad as Se,ae as ke,p as re,k as ue,f as De,W as _e,Y as Ie,A as he}from"./index-Bwbtb0V1.js";import{g as xe,s as ze,u as Ue,c as $e,a as Te,d as Ae,b as ve,e as Fe,f as Oe}from"./plshengchandingdan-DHtGS8yY.js";import{g as Me}from"./tongzhi-CcYQq5I0.js";import{u as je}from"./term-BqpDPAMp.js";import{g as qe}from"./bascontract-KulZMAIs.js";import{g as me}from"./department-D3nNq-Av.js";import{b as Be}from"./basno-kehUVSav.js";const Le={class:"search-bar"},We={class:"pagination-container"},Pe={__name:"ContractSelector",props:{modelValue:{type:Boolean,default:!1},onSelect:{type:Function,default:()=>{}}},emits:["update:modelValue"],setup(R,{emit:H}){const $=R,B=H,g=y(!1),D=je(),O=y(D.currentTerm);G(()=>$.modelValue,m=>{g.value=m,m&&(O.value=D.currentTerm||"",M())}),G(g,m=>{B("update:modelValue",m)}),G(()=>D.currentTerm,m=>{O.value=m||"",g.value&&M()},{immediate:!0});const N=se({contractNo:"",projectName:""}),c=se({pageNumber:1,pageSize:10,term:O.value||"",contractNo:"",projectName:""}),T=y([]),L=y(0),I=y(!1),M=async()=>{I.value=!0;try{c.contractNo=N.contractNo,c.projectName=N.projectName,c.term=O.value;const m=await Me(c);T.value=m.data.page.list,L.value=m.data.page.totalRow}catch(m){V.error("获取合同列表失败: "+m.message)}finally{I.value=!1}},p=m=>({10:"info",20:"success",30:"warning",40:"danger",50:"danger",60:"primary"})[m]||"info",_=m=>({10:"录入",20:"确认",30:"下计划",40:"生产中",50:"发货",60:"完成"})[m]||"未知",b=()=>{c.pageNumber=1,M()},A=()=>{N.contractNo="",N.projectName="",c.pageNumber=1,M()},d=m=>{c.pageSize=m,c.pageNumber=1,M()},n=m=>{c.pageNumber=m,M()},s=m=>{$.onSelect(m),g.value=!1},o=m=>{s(m)},K=()=>{N.contractNo="",N.projectName="",c.pageNumber=1};return be(()=>{D.terms.length||D.fetchTerms()}),(m,w)=>{const P=u("el-input"),C=u("el-col"),E=u("el-button"),Y=u("el-row"),x=u("el-table-column"),S=u("el-tag"),J=u("el-table"),l=u("el-pagination"),t=u("el-dialog"),z=pe("loading");return v(),W(t,{title:"选择合同",modelValue:g.value,"onUpdate:modelValue":w[4]||(w[4]=f=>g.value=f),width:"80%",onClosed:K},{default:a(()=>[r("div",Le,[e(Y,{gutter:20},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(P,{modelValue:N.contractNo,"onUpdate:modelValue":w[0]||(w[0]=f=>N.contractNo=f),placeholder:"请输入合同编号",onKeyup:ie(b,["enter"])},null,8,["modelValue"])]),_:1}),e(C,{span:8},{default:a(()=>[e(P,{modelValue:N.projectName,"onUpdate:modelValue":w[1]||(w[1]=f=>N.projectName=f),placeholder:"请输入合同名称",onKeyup:ie(b,["enter"])},null,8,["modelValue"])]),_:1}),e(C,{span:8},{default:a(()=>[e(E,{type:"primary",onClick:b},{default:a(()=>w[5]||(w[5]=[h("搜索")])),_:1}),e(E,{onClick:A},{default:a(()=>w[6]||(w[6]=[h("重置")])),_:1})]),_:1})]),_:1})]),ce((v(),W(J,{data:T.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:o},{default:a(()=>[e(x,{type:"index",label:"序号",width:"80"}),e(x,{prop:"no",label:"合同号",width:"120"}),e(x,{prop:"gridno",label:"电网编号",width:"120"}),e(x,{prop:"name",label:"工程名称"}),e(x,{prop:"salesmanName",label:"销售员",width:"100"}),e(x,{prop:"customerName",label:"客户名称"}),e(x,{prop:"contractSum",label:"合同金额",width:"120"},{default:a(({row:f})=>{var k;return[h(" ¥"+U(((k=f.contractSum)==null?void 0:k.toFixed(2))??"0.00"),1)]}),_:1}),e(x,{prop:"signDate",label:"签定时间",width:"120"}),e(x,{prop:"term",label:"期间",width:"120"}),e(x,{prop:"status",label:"合同状态",width:"100"},{default:a(({row:f})=>[e(S,{type:p(f.status)},{default:a(()=>[h(U(_(f.status)),1)]),_:2},1032,["type"])]),_:1}),e(x,{label:"操作",width:"150"},{default:a(({row:f})=>[e(E,{type:"primary",size:"small",onClick:k=>s(f)},{default:a(()=>w[7]||(w[7]=[h(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,I.value]]),r("div",We,[e(l,{"current-page":c.pageNumber,"onUpdate:currentPage":w[2]||(w[2]=f=>c.pageNumber=f),"page-size":c.pageSize,"onUpdate:pageSize":w[3]||(w[3]=f=>c.pageSize=f),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:L.value,onSizeChange:d,onCurrentChange:n},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},Ee=ae(Pe,[["__scopeId","data-v-1d697e12"]]),Re={class:"content-container"},He={key:0,class:"empty-state"},Ke={key:1,class:"material-details"},Ge=["onClick"],Ye={class:"header-info"},Je={class:"main-title"},Qe={class:"item-no"},Xe={class:"tag-group"},Ze={key:0,class:"children-container"},et=["onClick"],tt={class:"header-info"},at={class:"order-title"},ot={class:"stat-group"},lt={class:"stat-item"},nt={class:"stat-value"},st={class:"stat-item"},rt={class:"stat-value"},dt={class:"stat-item"},it={class:"stat-value"},ut={key:0,class:"children-container"},pt={class:"workorder-info"},ct={class:"workorder-header"},mt={class:"wo-no"},ft={class:"workorder-stat"},gt={class:"stat-value"},_t={__name:"ConItemCountDetail",props:{visible:{type:Boolean,default:!1},conItemId:{type:String,required:!0}},emits:["update:visible"],setup(R,{emit:H}){const $=y([]),B=async()=>{try{const p=await me();if(!p.success){console.error(p.msg);return}$.value=p.data.options||[]}catch{console.error("加载车间数据失败")}},g=p=>p?p.split(",").map(A=>{const d=$.value.find(n=>n.code===A.trim());return d?d.name:A}).join(","):"",D=R,O=H,N=y(D.visible),c=y(!1),T=y([]);G(()=>D.visible,p=>{N.value=p,p&&D.conItemId&&(B(),L())},{immediate:!0}),G(()=>D.conItemId,p=>{p&&N.value&&(B(),L())});const L=async()=>{var p,_;if(D.conItemId){c.value=!0;try{const b=await xe({conItemId:D.conItemId});b.success&&((_=(p=b.data)==null?void 0:p.itemList)!=null&&_.length)?T.value=I(b.data.itemList[0]):(T.value=[],V.warning("未查询到相关数据"))}catch(b){T.value=[],V.error(`加载失败: ${b.message||"未知错误"}`),console.error("数据加载失败:",b)}finally{c.value=!1}}},I=p=>{const _={id:`item_${p.itemNo}`,level:"item",itemNo:p.itemNo,itemName:p.itemName,spec:p.spec,totalAmount:p.totalAmount,allocatedOrderAmount:p.allocatedOrderAmount,expanded:!0,children:[]};return p.orders&&p.orders.length&&(_.children=p.orders.map(b=>{var A;return{id:`order_${b.ipoNo}`,level:"order",ipoNo:b.ipoNo,orderAmount:b.orderAmount,remainingInOrder:b.remainingInOrder,workshopName:b.workshopName,expanded:!1,children:((A=b.workorders)==null?void 0:A.map(d=>({id:`workorder_${d.woNo}`,level:"workorder",woNo:d.woNo,workorderAmount:d.workorderAmount})))||[]}})),[_]},M=()=>{O("update:visible",!1)};return(p,_)=>{const b=u("el-button"),A=u("el-dialog"),d=pe("loading");return v(),W(A,{title:"物料分解详情",modelValue:N.value,"onUpdate:modelValue":_[0]||(_[0]=n=>N.value=n),width:"900px","before-close":M,"append-to-body":"",class:"custom-dialog"},{footer:a(()=>[e(b,{onClick:M},{default:a(()=>_[5]||(_[5]=[h("关闭")])),_:1})]),default:a(()=>[ce((v(),F("div",Re,[!c.value&&T.value.length===0?(v(),F("div",He,[e(q(Ve),{description:"暂无物料分解数据"})])):(v(),F("div",Ke,[(v(!0),F(X,null,Z(T.value,n=>(v(),F("div",{key:n.id,class:"level-card item-card"},[r("div",{class:"card-header",onClick:s=>n.expanded=!n.expanded},[r("div",Ye,[r("h3",Je,[h(U(n.itemName)+" ",1),r("span",Qe,"("+U(n.itemNo)+")",1)]),r("div",Xe,[e(q(de),{size:"small",class:"spec-tag"},{default:a(()=>[h(U(n.spec),1)]),_:2},1024),e(q(de),{size:"small",type:"info"},{default:a(()=>[h("总量: "+U(n.totalAmount),1)]),_:2},1024),e(q(de),{size:"small",type:n.allocatedOrderAmount>0?"success":"warning"},{default:a(()=>[h(" 已分配: "+U(n.allocatedOrderAmount),1)]),_:2},1032,["type"])])]),e(q(ne),{class:"toggle-icon"},{default:a(()=>[n.expanded?(v(),W(q(fe),{key:0})):(v(),W(q(ge),{key:1}))]),_:2},1024)],8,Ge),n.expanded?(v(),F("div",Ze,[(v(!0),F(X,null,Z(n.children,s=>(v(),F("div",{key:s.id,class:"level-card order-card"},[r("div",{class:"card-header",onClick:o=>s.expanded=!s.expanded},[r("div",tt,[r("h4",at,[e(q(ne),{class:"order-icon"},{default:a(()=>[e(q(Se))]),_:1}),h(" 订单: "+U(s.ipoNo),1)]),r("div",ot,[r("div",lt,[_[1]||(_[1]=r("span",{class:"stat-label"},"数量:",-1)),r("span",nt,U(s.orderAmount),1)]),r("div",st,[_[2]||(_[2]=r("span",{class:"stat-label"},"剩余:",-1)),r("span",rt,U(s.remainingInOrder),1)]),r("div",dt,[_[3]||(_[3]=r("span",{class:"stat-label"},"车间:",-1)),r("span",it,U(g(s.workshopName)),1)])])]),e(q(ne),{class:"toggle-icon"},{default:a(()=>[s.expanded?(v(),W(q(fe),{key:0})):(v(),W(q(ge),{key:1}))]),_:2},1024)],8,et),s.expanded?(v(),F("div",ut,[(v(!0),F(X,null,Z(s.children,o=>(v(),F("div",{key:o.id,class:"level-card workorder-card"},[r("div",pt,[r("div",ct,[e(q(ne),{class:"workorder-icon"},{default:a(()=>[e(q(ke))]),_:1}),r("span",mt,"工单: "+U(o.woNo),1)]),r("div",ft,[_[4]||(_[4]=r("span",{class:"stat-label"},"数量:",-1)),r("span",gt,U(o.workorderAmount),1)])])]))),128))])):re("",!0)]))),128))])):re("",!0)]))),128))]))])),[[d,c.value]])]),_:1},8,["modelValue"])}}},vt=ae(_t,[["__scopeId","data-v-165ad5ab"]]),bt={class:"material-selector"},ht={class:"card-header"},yt={class:"action-buttons"},Nt={key:0,class:"empty-material"},wt={__name:"ContracItemSelect",props:{contractNo:{type:String,default:""},ipoNo:{type:String,default:""},modelValue:{type:Boolean,default:!1},onSelect:{type:Function,default:()=>{}}},emits:["update:modelValue"],setup(R,{emit:H}){const $=R,B=y(!1),g=y(""),D=d=>{g.value=d,B.value=!0},O=H,N=y({no:"",name:""}),c=y([]),T=y([]),L=async()=>{const d=await me();if(!d.success){V.error(d.msg);return}T.value=d.data.options},I=ue(()=>c.value.some(d=>p(d))),M=async()=>{if(!$.contractNo){V.error("未提供合同编号"),c.value=[];return}try{const d=await qe({contractNo:$.contractNo}),{contractInfo:n,itemList:s}=d.data;N.value.no=(n==null?void 0:n.no)||"",N.value.name=(n==null?void 0:n.name)||"",c.value=(s==null?void 0:s.map(o=>({id:o.id,conitemId:o.id,itemName:o.itemName||"",allocatedOrderAmount:o.allocatedOrderAmount||0,itemSpec:o.itemSpec||"",itemnum:o.itemnum||0,itemunit:o.itemunit||"",itemmemo:o.itemmemo||"",productionAmount:0,selectedWorkshops:[],memo:""})))||[]}catch(d){console.error("加载合同数据失败:",d),V.error("加载合同数据失败"),c.value=[]}},p=d=>d.productionAmount>0&&d.selectedWorkshops.length>0,_=d=>{d.productionAmount=0,d.selectedWorkshops=[],d.memo=""},b=async()=>{const d=c.value.filter(n=>p(n));if(d.length===0){V.warning("请为物料设置有效的生产数量和生产车间");return}try{const n=d.map(s=>({ipoNo:$.ipoNo,conitemId:s.conitemId,itemname:s.itemName,allocatedOrderAmount:s.allocatedOrderAmount,productModel:s.itemSpec,amount:s.productionAmount.toString(),unit:s.itemunit,memo:s.memo,workshopName:s.selectedWorkshops.join(",")}));for(const s of n)await ze(s);V.success(`成功添加${d.length}个物料`),await M(),c.value.forEach(_),$.onSelect(d)}catch(n){console.error("批量添加物料失败:",n),V.error("批量添加物料失败")}},A=()=>{O("update:modelValue",!1)};return G(()=>[$.modelValue,$.contractNo],([d,n])=>{d&&n&&(M(),L())},{immediate:!0}),(d,n)=>{const s=u("el-form-item"),o=u("el-form"),K=u("el-col"),m=u("el-row"),w=u("el-card"),P=u("el-button"),C=u("el-table-column"),E=u("el-input"),Y=u("el-option"),x=u("el-select"),S=u("el-table"),J=u("el-dialog");return v(),W(J,{"model-value":R.modelValue,title:"选择物料",width:"90%","onUpdate:modelValue":n[1]||(n[1]=l=>O("update:modelValue",l)),onClose:A},{footer:a(()=>[e(P,{onClick:A},{default:a(()=>n[7]||(n[7]=[h("关闭")])),_:1})]),default:a(()=>[r("div",bt,[e(w,{class:"contract-info-card",shadow:"never"},{header:a(()=>n[2]||(n[2]=[r("span",{class:"card-title"},"合同信息",-1)])),default:a(()=>[e(m,{gutter:12},{default:a(()=>[e(K,{span:12},{default:a(()=>[e(o,{"label-width":"100px",size:"small"},{default:a(()=>[e(s,{label:"合同编号"},{default:a(()=>[r("span",null,U(N.value.no),1)]),_:1}),e(s,{label:"合同名称"},{default:a(()=>[r("span",null,U(N.value.name),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{class:"material-list-card",shadow:"never"},{header:a(()=>[r("div",ht,[n[4]||(n[4]=r("span",{class:"card-title"},"物料信息",-1)),r("div",yt,[e(P,{type:"primary",onClick:b,disabled:!I.value},{default:a(()=>n[3]||(n[3]=[h(" 批量添加物料 ")])),_:1},8,["disabled"])])])]),default:a(()=>[e(S,{data:c.value,border:"",size:"small",style:{width:"100%"}},{default:a(()=>[e(C,{prop:"itemName",label:"物料名称","min-width":"120"}),e(C,{prop:"itemSpec",label:"规格型号","min-width":"100"}),e(C,{prop:"itemunit",label:"单位",width:"80"}),e(C,{prop:"itemnum",label:"合同数量",width:"100"}),e(C,{prop:"allocatedOrderAmount",label:"已分配数量",width:"100"}),e(C,{label:"生产数量",width:"120"},{default:a(({row:l})=>[e(E,{modelValue:l.productionAmount,"onUpdate:modelValue":t=>l.productionAmount=t,modelModifiers:{number:!0},type:"number",min:0,max:l.itemnum-l.allocatedOrderAmount,placeholder:"生产数量",size:"small"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),e(C,{label:"生产车间","min-width":"200"},{default:a(({row:l})=>[e(x,{modelValue:l.selectedWorkshops,"onUpdate:modelValue":t=>l.selectedWorkshops=t,multiple:"",placeholder:"选择生产车间",size:"small",style:{width:"100%"}},{default:a(()=>[(v(!0),F(X,null,Z(T.value,t=>(v(),W(Y,{key:t.code,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(C,{label:"备注","min-width":"150"},{default:a(({row:l})=>[e(E,{modelValue:l.memo,"onUpdate:modelValue":t=>l.memo=t,placeholder:"备注信息",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(C,{prop:"itemmemo",label:"合同备注","min-width":"100"}),e(C,{label:"操作",width:"100"},{default:a(({row:l})=>[e(P,{type:"primary",size:"small",onClick:t=>D(l.id)},{default:a(()=>n[5]||(n[5]=[h(" 查看分配详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),c.value.length===0?(v(),F("div",Nt,n[6]||(n[6]=[r("p",null,"暂无物料信息",-1)]))):re("",!0)]),_:1})]),e(vt,{visible:B.value,conItemId:g.value,"onUpdate:visible":n[0]||(n[0]=l=>B.value=l)},null,8,["visible","conItemId"])]),_:1},8,["model-value"])}}},Ct=ae(wt,[["__scopeId","data-v-0d9f1388"]]),Vt={class:"order-section"},St={class:"section-header"},kt={class:"form-section"},Dt={class:"form-section"},It={class:"form-section"},xt={class:"material-section"},zt={class:"section-header"},Ut={key:0,class:"empty-material"},$t={__name:"shengchandingdanForm",props:{visible:{type:Boolean,default:!1},type:{type:String,default:"add"},formData:{type:Object,default:()=>({})}},emits:["update:visible","submit","cancel"],setup(R,{emit:H}){const $=De(),B=()=>(console.log("获取登录用户名称",$.descr),$.descr),g=R,D=H,O=y([]),N=async()=>{try{const l=await me();if(!l.success){V.error(l.msg);return}O.value=l.data.options||[]}catch{V.error("加载车间数据失败")}},c=l=>l?O.value.length===0?l:l.split(",").map(k=>{const j=k.trim(),ee=O.value.find(oe=>oe.code===j);return ee?ee.name:k}).join(","):"",T=[{id:1,value:"采购订单"},{id:2,value:"生产订单"},{id:3,value:"销售订单"},{id:4,value:"其他订单"}],L=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],I=ue({get:()=>g.visible,set:l=>D("update:visible",l)}),M=ue(()=>g.type==="add"?"新增生产订单":"编辑生产订单"),p=y(null),_=y(!1),b=y(!1),A=y(!1),d=y(!1),n=y([]),s=async()=>{try{const l=await Be("scdd");return(l==null?void 0:l.code)===200?(console.log("获取编码成功",l.data.fullNoNyName),l.data.fullNoNyName):(V.error((l==null?void 0:l.msg)||"获取编码失败"),"")}catch(l){return console.error("生成生产订单编码出错:",l),V.error("请求编码服务时发生错误"),""}};G(I,async l=>{l&&(g.type==="add"?(o.ipoNo=await s(),d.value=!1):d.value=!0)});const o=se({id:void 0,purchaserHqCode:"",ipoType:2,supplierCode:"1000014491",supplierName:"中国电建集团四平线路器材有限公司",ipoNo:"",categoryCode:"60",subclassCode:"60004",scheduleCode:"",poItemId:void 0,dataType:void 0,soItemNo:void 0,materialsCode:"",materialsName:"",materialsUnit:"",materialsDesc:"",amount:0,unit:"",productIdGrpNo:"",productIdType:"",productModel:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",plantName:"",workshopName:"",ipoStatus:1,center:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",contractNo:"",contractName:"",writer:B()}),K={purchaserHqCode:[{required:!0,message:"请输入采购方总部编码",trigger:"blur"},{max:20,message:"长度不能超过20个字符",trigger:"blur"}],ipoType:[{required:!0,message:"请选择订单类型",trigger:"change"},{type:"number",message:"请选择有效的订单类型",trigger:["blur","change"]}],supplierCode:[{required:!0,message:"请输入供应商编码",trigger:"blur"},{max:48,message:"长度不能超过48个字符",trigger:"blur"}],supplierName:[{required:!0,message:"请输入供应商名称",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],ipoNo:[{required:!0,message:"请输入生产订单号",trigger:"blur"},{max:48,message:"长度不能超过48个字符",trigger:"blur"}],categoryCode:[{required:!0,message:"请输入品类编码",trigger:"blur"},{max:10,message:"长度不能超过10个字符",trigger:"blur"}],contractNo:[{required:!0,message:"请选择合同编号",trigger:"blur"}]},m=()=>{p.value&&p.value.resetFields(),Object.assign(o,{id:void 0,purchaserHqCode:"",ipoType:2,supplierCode:"1000014491",supplierName:"中国电建集团四平线路器材有限公司",ipoNo:"",categoryCode:"60",subclassCode:"60004",scheduleCode:"",poItemId:void 0,dataType:void 0,soItemNo:void 0,materialsCode:"",materialsName:"",materialsUnit:"",materialsDesc:"",amount:0,unit:"",productIdGrpNo:"",productIdType:"",productModel:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",plantName:"",workshopName:"",ipoStatus:1,center:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",contractNo:"",contractName:"",writer:B()}),n.value=[],d.value=!1},w=l=>{l.stopPropagation(),_.value=!0},P=async l=>{if(l==null||l.stopPropagation(),!d.value){if(!p.value)return;let t=!1;try{await p.value.validate(z=>{t=z})}catch{t=!1}if(t)await Y();else{V.warning("请先完善订单信息并保存");return}}b.value=!0},C=l=>{l&&(o.contractNo=l.no,o.contractName=l.name),_.value=!1},E=l=>{x()},Y=()=>{p.value&&p.value.validate(async l=>{var t;if(l)try{const z={...o};delete z.contractName;let f;o.id?(f=await Ue(z),V.success("订单信息更新成功")):(f=await $e(z),(t=f==null?void 0:f.data)!=null&&t.id&&(o.id=f.data.id),V.success("订单信息保存成功")),d.value=!0,g.type==="add"&&o.ipoNo&&x()}catch(z){console.error("保存生产订单失败",z),V.error("保存生产订单失败")}finally{A.value=!1}})},x=async()=>{if(o.ipoNo)try{const l=await Te({ipoNo:o.ipoNo});n.value=(l.data.itemList||[]).map(t=>({...t,workshopName:c(t.workshopName||t.workshopCode||"")}))}catch{V.error("加载物料列表失败")}},S=async l=>{try{await he.confirm("确定要删除这个物料吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ae({id:l.id}),V.success("删除成功"),x()}catch(t){t!=="cancel"&&(console.error("删除物料失败",t),V.error("删除物料失败"))}};G(()=>g.formData,l=>{if(N(),l&&Object.keys(l).length>0){const t={...l};t.planStartDate&&(t.planStartDate=new Date(t.planStartDate)),t.planFinishDate&&(t.planFinishDate=new Date(t.planFinishDate)),t.actualStartDate&&(t.actualStartDate=new Date(t.actualStartDate)),t.actualFinishDate&&(t.actualFinishDate=new Date(t.actualFinishDate)),t.dataSourceCreateTime&&(t.dataSourceCreateTime=new Date(t.dataSourceCreateTime)),Object.assign(o,t),g.type==="edit"&&o.ipoNo&&x()}},{immediate:!0,deep:!0});const J=()=>{D("cancel")};return(l,t)=>{const z=u("el-button"),f=u("el-input"),k=u("el-form-item"),j=u("el-col"),ee=u("el-option"),oe=u("el-select"),te=u("el-row"),le=u("el-date-picker"),ye=u("el-form"),Ne=u("el-tooltip"),Q=u("el-table-column"),we=u("el-table"),Ce=u("el-dialog");return v(),W(Ce,{title:M.value,modelValue:I.value,"onUpdate:modelValue":t[17]||(t[17]=i=>I.value=i),width:"1400px",onClosed:m},{footer:a(()=>[e(z,{onClick:J},{default:a(()=>t[29]||(t[29]=[h("关闭")])),_:1})]),default:a(()=>[r("div",Vt,[r("div",St,[t[19]||(t[19]=r("h3",null,"生产订单信息",-1)),e(z,{type:"primary",onClick:Y,loading:A.value},{default:a(()=>t[18]||(t[18]=[h(" 保存订单信息 ")])),_:1},8,["loading"])]),e(ye,{ref_key:"formRef",ref:p,model:o,rules:K,"label-width":"120px",size:"small"},{default:a(()=>[r("div",kt,[t[20]||(t[20]=r("div",{class:"section-title"},"基本信息",-1)),e(te,{gutter:10},{default:a(()=>[e(j,{span:8},{default:a(()=>[e(k,{label:"采购方总部编码",prop:"purchaserHqCode"},{default:a(()=>[e(f,{modelValue:o.purchaserHqCode,"onUpdate:modelValue":t[0]||(t[0]=i=>o.purchaserHqCode=i),placeholder:"请输入采购方总部编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:8},{default:a(()=>[e(k,{label:"订单类型",prop:"ipoType"},{default:a(()=>[e(oe,{modelValue:o.ipoType,"onUpdate:modelValue":t[1]||(t[1]=i=>o.ipoType=i),placeholder:"请选择订单类型",style:{width:"100%"}},{default:a(()=>[(v(),F(X,null,Z(T,i=>e(ee,{key:i.id,label:i.value,value:i.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(j,{span:8},{default:a(()=>[e(k,{label:"生产订单号",prop:"ipoNo"},{default:a(()=>[e(f,{modelValue:o.ipoNo,"onUpdate:modelValue":t[2]||(t[2]=i=>o.ipoNo=i),placeholder:"请输入生产订单号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),r("div",Dt,[t[22]||(t[22]=r("div",{class:"section-title"},"供应商信息",-1)),e(te,{gutter:10},{default:a(()=>[e(j,{span:12},{default:a(()=>[e(k,{label:"供应商编码",prop:"supplierCode"},{default:a(()=>[e(f,{disabled:"",modelValue:o.supplierCode,"onUpdate:modelValue":t[3]||(t[3]=i=>o.supplierCode=i),placeholder:"请输入供应商编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:12},{default:a(()=>[e(k,{label:"供应商名称",prop:"supplierName"},{default:a(()=>[e(f,{disabled:"",modelValue:o.supplierName,"onUpdate:modelValue":t[4]||(t[4]=i=>o.supplierName=i),placeholder:"请输入供应商名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(te,{gutter:10},{default:a(()=>[e(j,{span:12},{default:a(()=>[e(k,{label:"合同编号",prop:"contractNo"},{default:a(()=>[e(f,{modelValue:o.contractNo,"onUpdate:modelValue":t[5]||(t[5]=i=>o.contractNo=i),placeholder:"选择合同编号",readonly:"",onClick:_e(w,["stop"])},{append:a(()=>[e(z,{onClick:w,size:"small"},{default:a(()=>t[21]||(t[21]=[h("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(j,{span:12},{default:a(()=>[e(k,{label:"合同名称",prop:"contractName"},{default:a(()=>[e(f,{disabled:"",modelValue:o.contractName,"onUpdate:modelValue":t[6]||(t[6]=i=>o.contractName=i),placeholder:"合同名称",readonly:"",class:Ie({"has-select":!!o.contractNo}),onClick:t[7]||(t[7]=_e(()=>{},["stop"]))},null,8,["modelValue","class"])]),_:1})]),_:1})]),_:1})]),r("div",It,[t[23]||(t[23]=r("div",{class:"section-title"},"其他信息",-1)),e(te,{gutter:10},{default:a(()=>[e(j,{span:8},{default:a(()=>[e(k,{label:"品类编码",prop:"categoryCode"},{default:a(()=>[e(f,{modelValue:o.categoryCode,"onUpdate:modelValue":t[8]||(t[8]=i=>o.categoryCode=i),placeholder:"请输入品类编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:8},{default:a(()=>[e(k,{label:"种类编码",prop:"subclassCode"},{default:a(()=>[e(f,{modelValue:o.subclassCode,"onUpdate:modelValue":t[9]||(t[9]=i=>o.subclassCode=i),placeholder:"请输入种类编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:8},{default:a(()=>[e(k,{label:"生产订单状态",prop:"ipoStatus"},{default:a(()=>[e(oe,{modelValue:o.ipoStatus,"onUpdate:modelValue":t[10]||(t[10]=i=>o.ipoStatus=i),placeholder:"请选择生产订单状态",style:{width:"100%"}},{default:a(()=>[(v(),F(X,null,Z(L,i=>e(ee,{key:i.id,label:i.value,value:i.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(te,{gutter:10},{default:a(()=>[e(j,{span:6},{default:a(()=>[e(k,{label:"计划开始日期",prop:"planStartDate"},{default:a(()=>[e(le,{modelValue:o.planStartDate,"onUpdate:modelValue":t[11]||(t[11]=i=>o.planStartDate=i),type:"date",placeholder:"选择计划开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:6},{default:a(()=>[e(k,{label:"计划完成日期",prop:"planFinishDate"},{default:a(()=>[e(le,{modelValue:o.planFinishDate,"onUpdate:modelValue":t[12]||(t[12]=i=>o.planFinishDate=i),type:"date",placeholder:"选择计划完成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:6},{default:a(()=>[e(k,{label:"实际开始日期",prop:"actualStartDate"},{default:a(()=>[e(le,{modelValue:o.actualStartDate,"onUpdate:modelValue":t[13]||(t[13]=i=>o.actualStartDate=i),type:"date",placeholder:"选择实际开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:6},{default:a(()=>[e(k,{label:"实际完成日期",prop:"actualFinishDate"},{default:a(()=>[e(le,{modelValue:o.actualFinishDate,"onUpdate:modelValue":t[14]||(t[14]=i=>o.actualFinishDate=i),type:"date",placeholder:"选择实际完成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])]),r("div",xt,[r("div",zt,[t[26]||(t[26]=r("h3",null,"物料信息",-1)),d.value?(v(),W(z,{key:1,type:"success",onClick:P},{default:a(()=>t[25]||(t[25]=[h(" 添加物料 ")])),_:1})):(v(),W(Ne,{key:0,content:"请先保存订单信息",placement:"top"},{default:a(()=>[e(z,{type:"success",disabled:!0},{default:a(()=>t[24]||(t[24]=[h(" 添加物料 ")])),_:1})]),_:1}))]),e(we,{data:n.value,border:"",size:"small",style:{width:"100%"}},{default:a(()=>[e(Q,{prop:"itemname",label:"物料名称","min-width":"120"}),e(Q,{prop:"productModel",label:"规格型号",width:"100"}),e(Q,{prop:"amount",label:"数量",width:"80"}),e(Q,{prop:"unit",label:"单位",width:"80"}),e(Q,{prop:"workshopName",label:"生产车间","min-width":"150"}),e(Q,{prop:"memo",label:"备注","min-width":"120"}),e(Q,{label:"操作",width:"160"},{default:a(({row:i})=>[e(z,{type:"danger",size:"small",onClick:jt=>S(i)},{default:a(()=>t[27]||(t[27]=[h("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n.value.length===0?(v(),F("div",Ut,t[28]||(t[28]=[r("p",null,"暂无物料信息，请先保存订单信息后添加物料",-1)]))):re("",!0)]),e(Ee,{modelValue:_.value,"onUpdate:modelValue":t[15]||(t[15]=i=>_.value=i),onSelect:C},null,8,["modelValue"]),e(Ct,{modelValue:b.value,"onUpdate:modelValue":t[16]||(t[16]=i=>b.value=i),contractNo:o.contractNo,ipoNo:o.ipoNo,onSelect:E},null,8,["modelValue","contractNo","ipoNo"])]),_:1},8,["title","modelValue"])}}},Tt=ae($t,[["__scopeId","data-v-efb7359a"]]),At={class:"production-order-management"},Ft={class:"action-bar"},Ot={class:"pagination-container"},Mt={__name:"shengchandingdan",setup(R){const H=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],$=s=>{const o=H.find(K=>K.id===s);return o?o.value:"未知状态"},B=s=>{if(!s)return"";const o=new Date(s);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`},g=se({ipoNo:"",pageNumber:1,pageSize:10}),D=y([]),O=y(0),N=y(!1),c=y(!1),T=y("add"),L=y({}),I=async()=>{N.value=!0;try{const s=await ve(g);D.value=s.data.page.list,O.value=s.data.page.totalRow}catch(s){console.error("获取生产订单列表失败",s),V.error("获取生产订单列表失败")}finally{N.value=!1}},M=s=>{g.pageSize=s,I()},p=s=>{g.pageNumber=s,I()},_=()=>{g.ipoNo="",g.pageNumber=1,I()},b=()=>{T.value="add",L.value={},c.value=!0},A=async s=>{T.value="edit";const o=await Fe({id:s.id});L.value=o.data.plshengchandingdan,c.value=!0},d=s=>{he.confirm(`确认删除生产订单"${s.ipoNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Oe({id:s.id}),V.success("删除成功"),I()}catch(o){console.error("删除生产订单失败",o),V.error("删除生产订单失败")}}).catch(()=>{})},n=()=>{console.log("表单取消"),c.value=!1};return G(c,(s,o)=>{o&&!s&&I()}),be(()=>{I()}),(s,o)=>{const K=u("el-input"),m=u("el-button"),w=u("Refresh"),P=u("el-icon"),C=u("el-table-column"),E=u("el-table"),Y=u("el-pagination"),x=pe("loading");return v(),F("div",At,[r("div",Ft,[e(K,{modelValue:g.ipoNo,"onUpdate:modelValue":o[0]||(o[0]=S=>g.ipoNo=S),placeholder:"请输入生产订单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:q(ve),onKeyup:ie(I,["enter"])},null,8,["modelValue","onClear"]),e(m,{type:"primary",onClick:I},{default:a(()=>o[4]||(o[4]=[h("搜索")])),_:1}),e(m,{type:"warning",onClick:_},{default:a(()=>[e(P,null,{default:a(()=>[e(w)]),_:1}),o[5]||(o[5]=h(" 刷新 "))]),_:1}),e(m,{type:"primary",style:{"margin-left":"auto"},onClick:b},{default:a(()=>o[6]||(o[6]=[h("新增订单")])),_:1})]),ce((v(),W(E,{data:D.value,border:"",style:{width:"100%"}},{default:a(()=>[e(C,{type:"index",label:"序号",width:"80"}),e(C,{prop:"contractNo",label:"合同编号"}),e(C,{prop:"ipoNo",label:"生产订单号"}),e(C,{prop:"planStartDate",label:"计划开始日期",width:"180"},{default:a(({row:S})=>[h(U(B(S.planStartDate)),1)]),_:1}),e(C,{prop:"planFinishDate",label:"计划完成日期",width:"180"},{default:a(({row:S})=>[h(U(B(S.planFinishDate)),1)]),_:1}),e(C,{prop:"ipoStatus",label:"订单状态",width:"120"},{default:a(({row:S})=>[h(U($(S.ipoStatus)),1)]),_:1}),e(C,{prop:"writer",label:"录入人名称",width:"100"}),e(C,{prop:"writetime",label:"录入时间",width:"120"}),e(C,{label:"操作",width:"200"},{default:a(({row:S})=>[e(m,{type:"primary",size:"small",onClick:J=>A(S)},{default:a(()=>o[7]||(o[7]=[h("编辑")])),_:2},1032,["onClick"]),e(m,{type:"danger",size:"small",onClick:J=>d(S)},{default:a(()=>o[8]||(o[8]=[h("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,N.value]]),r("div",Ot,[e(Y,{"current-page":g.pageNumber,"onUpdate:currentPage":o[1]||(o[1]=S=>g.pageNumber=S),"page-size":g.pageSize,"onUpdate:pageSize":o[2]||(o[2]=S=>g.pageSize=S),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:O.value,onSizeChange:M,onCurrentChange:p},null,8,["current-page","page-size","total"])]),e(Tt,{visible:c.value,"onUpdate:visible":o[3]||(o[3]=S=>c.value=S),type:T.value,"form-data":L.value,onCancel:n},null,8,["visible","type","form-data"])])}}},Ht=ae(Mt,[["__scopeId","data-v-b5dc63e2"]]);export{Ht as default};
