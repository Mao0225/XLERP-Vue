import{a as P,s as G}from"./beiliaodan-2Bn9qyYh.js";import{_ as L,g as w,r as f,v as A,s as I,h as p,o as T,c as $,b as e,w as a,a as H,i as Y,af as U,E as b}from"./index-Bwbtb0V1.js";const J={class:"beiliaodan-container"},K={class:"dialog-footer"},O={__name:"chakanbeiliaodan",props:{noticeid:{type:String,required:!0},noticedrawno:{type:String,required:!0},contractno:{type:String,required:!0},contractname:{type:String,required:!0}},emits:["close"],setup(q,{emit:Q}){const g=q,m=w({noticeid:g.noticeid,noticedrawno:g.noticedrawno,contractno:g.contractno,contractname:g.contractname,pageNumber:1,pageSize:10}),d=f([]),x=f(0),h=f([]),_=f(!1),n=w({}),y=f(null);f(-1);const M={sxclshuliang:[{required:!0,message:"请输入所需材料数量",trigger:"blur"}],sxclshijishuliang:[{required:!0,message:"请输入实际备料数量",trigger:"blur"}],sxclcaizhi:[{required:!0,message:"请输入材质",trigger:"blur"}],zhidingbumen:[{required:!0,message:"请输入制定部门",trigger:"blur"}],zhidingriqi:[{required:!0,message:"请选择制定日期",trigger:"change"}],tiliaoshijian:[{required:!0,message:"请选择提料时间",trigger:"change"}],jiaohuoshijian:[{required:!0,message:"请选择交货时间",trigger:"change"}],bianzhiren:[{required:!0,message:"请输入编制人",trigger:"blur"}],jiaoyanren:[{required:!0,message:"请输入校验人",trigger:"blur"}],shenheren:[{required:!0,message:"请输入审核人",trigger:"blur"}]},C=()=>{n.dinghuotaoshu&&n.sxclshuliang&&(n.sxcltihuoshuliang=n.dinghuotaoshu*n.sxclshuliang)},D=({row:i,column:l,rowIndex:o,columnIndex:u})=>{if(u<6)return{rowspan:h.value[o],colspan:1}},k=()=>{if(h.value=[],!d.value||d.value.length===0)return;d.value.forEach(()=>{h.value.push(1)});let i=0;for(;i<d.value.length;){let l=1;for(let o=i+1;o<d.value.length&&(d.value[i].itemno===d.value[o].itemno&&d.value[i].spec===d.value[o].spec&&d.value[i].name===d.value[o].name&&d.value[i].unit===d.value[o].unit&&d.value[i].dinghuotaoshu===d.value[o].dinghuotaoshu);o++)l++,h.value[o]=0;h.value[i]=l,i+=l}},V=async()=>{let i=null;try{i=U.service({lock:!0,text:"加载数据中...",background:"rgba(0, 0, 0, 0.7)"});const l=await P(m);l.success?(d.value=l.data.page.list||[],d.value.sort((o,u)=>o.itemno!==u.itemno?o.itemno.localeCompare(u.itemno):o.spec!==u.spec?o.spec.localeCompare(u.spec):o.name!==u.name?o.name.localeCompare(u.name):o.unit!==u.unit?o.unit.localeCompare(u.unit):o.dinghuotaoshu-u.dinghuotaoshu),x.value=l.data.page.totalRow||0,k()):b.error(l.msg||"获取备料计划失败")}catch(l){b.error("获取备料计划失败: "+l.message),console.error("获取备料计划失败",l)}finally{i==null||i.close()}},S=i=>{m.pageSize=i,V()},B=i=>{m.pageNumber=i,V()},N=async()=>{y.value.validate(async i=>{if(i){let l=null;try{l=U.service({lock:!0,text:"保存中...",background:"rgba(0, 0, 0, 0.7)"});const o={...n,noticeid:g.noticeid,noticedrawno:g.noticedrawno},u=await G(o);u.success?(b.success("保存成功"),_.value=!1,V()):b.error(u.msg||"保存失败")}catch(o){b.error("保存失败: "+o.message),console.error("保存失败",o)}finally{l==null||l.close()}}else return b.error("请检查表单信息"),!1})};return A(()=>[g.noticeid,g.noticedrawno],i=>{m.noticeid=i[0],m.noticedrawno=i[1],V()},{immediate:!0}),I(()=>{V()}),(i,l)=>{const o=p("el-input"),u=p("el-form-item"),r=p("el-col"),c=p("el-row"),z=p("el-form"),s=p("el-table-column"),E=p("el-table"),R=p("el-pagination"),v=p("el-date-picker"),j=p("el-button"),F=p("el-dialog");return T(),$("div",J,[e(z,{model:m,size:"small","label-width":"80px",class:"search-form"},{default:a(()=>[e(c,{gutter:12},{default:a(()=>[e(r,{span:6},{default:a(()=>[e(u,{label:"通知编号"},{default:a(()=>[e(o,{modelValue:m.noticeid,"onUpdate:modelValue":l[0]||(l[0]=t=>m.noticeid=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"合同编号"},{default:a(()=>[e(o,{modelValue:m.contractno,"onUpdate:modelValue":l[1]||(l[1]=t=>m.contractno=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"工程名称"},{default:a(()=>[e(o,{modelValue:m.contractname,"onUpdate:modelValue":l[2]||(l[2]=t=>m.contractname=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(E,{data:d.value,border:"",size:"small",style:{width:"100%"},"span-method":D},{default:a(()=>[e(s,{prop:"itemno",label:"订货产品编码"}),e(s,{prop:"spec",label:"订货产品型号"}),e(s,{prop:"name",label:"订货产品名称"}),e(s,{prop:"unit",label:"订货产品单位"}),e(s,{prop:"dinghuotaoshu",label:"订货套数"}),e(s,{prop:"noticedrawno",label:"图纸编号"}),e(s,{prop:"sxclitemno",label:"所需子材料编码"}),e(s,{prop:"sxclname",label:"所需子材料名称"}),e(s,{prop:"unit",label:"单位"}),e(s,{prop:"sxclshuliang",label:"所需材料数量"}),e(s,{prop:"sxcltihuoshuliang",label:"子材料数量"}),e(s,{prop:"sxclshijishuliang",label:"实际备货数量"}),e(s,{prop:"sxclcaizhi",label:"材质"}),e(s,{prop:"zhidingbumen",label:"制定部门"}),e(s,{prop:"zhidingriqi",label:"制定日期"}),e(s,{prop:"tiliaoshijian",label:"提料时间"}),e(s,{prop:"jiaohuoshijian",label:"交货时间"}),e(s,{prop:"memo",label:"备注"}),e(s,{prop:"bianzhiren",label:"编制人"}),e(s,{prop:"jiaoyanren",label:"校验人"}),e(s,{prop:"shenheren",label:"审核人"})]),_:1},8,["data"]),e(R,{onSizeChange:S,onCurrentChange:B,"current-page":m.pageNumber,"page-sizes":[10,20,50,100],"page-size":m.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:x.value},null,8,["current-page","page-size","total"]),e(F,{modelValue:_.value,"onUpdate:modelValue":l[22]||(l[22]=t=>_.value=t),title:"编辑备料计划",width:"70%"},{footer:a(()=>[H("div",K,[e(j,{onClick:l[21]||(l[21]=t=>_.value=!1)},{default:a(()=>l[23]||(l[23]=[Y("取消")])),_:1}),e(j,{type:"primary",onClick:N},{default:a(()=>l[24]||(l[24]=[Y("保存")])),_:1})])]),default:a(()=>[e(z,{ref_key:"editFormRef",ref:y,model:n,rules:M,"label-width":"100px",size:"small"},{default:a(()=>[e(c,{gutter:12},{default:a(()=>[e(r,{span:6},{default:a(()=>[e(u,{label:"合同编号"},{default:a(()=>[e(o,{modelValue:n.contractno,"onUpdate:modelValue":l[3]||(l[3]=t=>n.contractno=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"工程名称"},{default:a(()=>[e(o,{modelValue:n.contractname,"onUpdate:modelValue":l[4]||(l[4]=t=>n.contractname=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"通知编号"},{default:a(()=>[e(o,{modelValue:n.noticeid,"onUpdate:modelValue":l[5]||(l[5]=t=>n.noticeid=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"订货物料编码"},{default:a(()=>[e(o,{modelValue:n.itemno,"onUpdate:modelValue":l[6]||(l[6]=t=>n.itemno=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:12},{default:a(()=>[e(r,{span:6},{default:a(()=>[e(u,{label:"所需子材料编码"},{default:a(()=>[e(o,{modelValue:n.sxclitemno,"onUpdate:modelValue":l[7]||(l[7]=t=>n.sxclitemno=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"所需材料名称"},{default:a(()=>[e(o,{modelValue:n.sxclname,"onUpdate:modelValue":l[8]||(l[8]=t=>n.sxclname=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"单位"},{default:a(()=>[e(o,{modelValue:n.unit,"onUpdate:modelValue":l[9]||(l[9]=t=>n.unit=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"订货套数"},{default:a(()=>[e(o,{modelValue:n.dinghuotaoshu,"onUpdate:modelValue":l[10]||(l[10]=t=>n.dinghuotaoshu=t),modelModifiers:{number:!0},readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:12},{default:a(()=>[e(r,{span:6},{default:a(()=>[e(u,{label:"所需材料数量",prop:"sxclshuliang"},{default:a(()=>[e(o,{modelValue:n.sxclshuliang,"onUpdate:modelValue":l[11]||(l[11]=t=>n.sxclshuliang=t),modelModifiers:{number:!0},onChange:C},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"计划提货数量",prop:"sxcltihuoshuliang"},{default:a(()=>[e(o,{modelValue:n.sxcltihuoshuliang,"onUpdate:modelValue":l[12]||(l[12]=t=>n.sxcltihuoshuliang=t),modelModifiers:{number:!0},readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"实际提货数量",prop:"sxclshijishuliang"},{default:a(()=>[e(o,{modelValue:n.sxclshijishuliang,"onUpdate:modelValue":l[13]||(l[13]=t=>n.sxclshijishuliang=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"材质",prop:"sxclcaizhi"},{default:a(()=>[e(o,{modelValue:n.sxclcaizhi,"onUpdate:modelValue":l[14]||(l[14]=t=>n.sxclcaizhi=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"制定部门",prop:"zhidingbumen"},{default:a(()=>[e(o,{modelValue:n.zhidingbumen,"onUpdate:modelValue":l[15]||(l[15]=t=>n.zhidingbumen=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:12},{default:a(()=>[e(r,{span:6},{default:a(()=>[e(u,{label:"制定日期",prop:"zhidingriqi"},{default:a(()=>[e(v,{modelValue:n.zhidingriqi,"onUpdate:modelValue":l[16]||(l[16]=t=>n.zhidingriqi=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"提料时间",prop:"tiliaoshijian"},{default:a(()=>[e(v,{modelValue:n.tiliaoshijian,"onUpdate:modelValue":l[17]||(l[17]=t=>n.tiliaoshijian=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"交货时间",prop:"jiaohuoshijian"},{default:a(()=>[e(v,{modelValue:n.jiaohuoshijian,"onUpdate:modelValue":l[18]||(l[18]=t=>n.jiaohuoshijian=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(u,{label:"编制人",prop:"bianzhiren"},{default:a(()=>[e(o,{modelValue:n.bianzhiren,"onUpdate:modelValue":l[19]||(l[19]=t=>n.bianzhiren=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:12},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"备注",prop:"memo"},{default:a(()=>[e(o,{type:"textarea",rows:3,modelValue:n.memo,"onUpdate:modelValue":l[20]||(l[20]=t=>n.memo=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Z=L(O,[["__scopeId","data-v-849276db"]]);export{Z as C};
