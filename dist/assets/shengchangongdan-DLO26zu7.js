import{_ as te,r as h,v as Y,g as Z,E as b,h as u,G as se,o as q,l as G,w as a,a as c,b as e,e as ee,i as y,H as de,q as R,k as oe,c as J,p as ne,f as ge,W as fe,F as _e,m as be,A as le,s as ve,D as ye,x as re,a6 as we,z as Ne}from"./index-Bwbtb0V1.js";import{s as he,u as Ve,c as Ce,g as Se,d as De,a as ke,b as Ue,e as ze,f as Fe}from"./plshengchangongdan-BS-Hu3DG.js";import{b as xe,a as $e}from"./plshengchandingdan-DHtGS8yY.js";import{g as ie}from"./department-D3nNq-Av.js";import{b as Me}from"./basno-kehUVSav.js";const Ie={class:"search-bar"},Ae={class:"pagination-container"},qe={__name:"DingdanbianhaoSelector",props:{modelValue:{type:Boolean,default:!1},onSelect:{type:Function,default:()=>{}}},emits:["update:modelValue"],setup(H,{emit:j}){const k=H,L=j,S=h(!1);Y(()=>k.modelValue,n=>{S.value=n,n&&M()}),Y(S,n=>{L("update:modelValue",n)});const g=Z({ipoNo:"",contractNo:""}),w=Z({pageNumber:1,pageSize:10,ipoNo:"",contractNo:""}),U=h([]),A=h(0),O=h(!1),$=[{id:1,value:"待处理",type:"info"},{id:2,value:"处理中",type:"warning"},{id:3,value:"已完成",type:"success"},{id:4,value:"已取消",type:"danger"},{id:5,value:"已过期",type:"danger"}],f=n=>{const o=$.find(V=>V.id===n);return o?o.value:"未知状态"},N=n=>{const o=$.find(V=>V.id===n);return o?o.type:"info"},z=n=>{if(!n)return"";const o=new Date(n);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`},M=async()=>{O.value=!0;try{w.ipoNo=g.ipoNo,w.contractNo=g.contractNo;const n=await xe(w);U.value=n.data.page.list,A.value=n.data.page.totalRow}catch(n){b.error("获取生产订单列表失败: "+n.message)}finally{O.value=!1}},I=()=>{w.pageNumber=1,M()},d=()=>{g.ipoNo="",g.contractNo="",w.pageNumber=1,M()},p=n=>{w.pageSize=n,w.pageNumber=1,M()},m=n=>{w.pageNumber=n,M()},l=n=>{k.onSelect(n),S.value=!1},T=n=>{l(n)},W=()=>{g.ipoNo="",g.contractNo="",w.pageNumber=1};return(n,o)=>{const V=u("el-input"),F=u("el-col"),B=u("el-button"),D=u("el-row"),_=u("el-table-column"),P=u("el-tag"),r=u("el-table"),t=u("el-pagination"),v=u("el-dialog"),x=se("loading");return q(),G(v,{title:"选择生产订单",modelValue:S.value,"onUpdate:modelValue":o[4]||(o[4]=i=>S.value=i),width:"80%",onClosed:W},{default:a(()=>[c("div",Ie,[e(D,{gutter:20},{default:a(()=>[e(F,{span:8},{default:a(()=>[e(V,{modelValue:g.ipoNo,"onUpdate:modelValue":o[0]||(o[0]=i=>g.ipoNo=i),placeholder:"请输入生产订单号",onKeyup:ee(I,["enter"])},null,8,["modelValue"])]),_:1}),e(F,{span:8},{default:a(()=>[e(V,{modelValue:g.contractNo,"onUpdate:modelValue":o[1]||(o[1]=i=>g.contractNo=i),placeholder:"请输入合同编号",onKeyup:ee(I,["enter"])},null,8,["modelValue"])]),_:1}),e(F,{span:8},{default:a(()=>[e(B,{type:"primary",onClick:I},{default:a(()=>o[5]||(o[5]=[y("搜索")])),_:1}),e(B,{onClick:d},{default:a(()=>o[6]||(o[6]=[y("重置")])),_:1})]),_:1})]),_:1})]),de((q(),G(r,{data:U.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:T},{default:a(()=>[e(_,{type:"index",label:"序号",width:"80"}),e(_,{prop:"ipoNo",label:"生产订单号",width:"150"}),e(_,{prop:"contractNo",label:"合同编号",width:"120"}),e(_,{prop:"contractName",label:"合同名称"}),e(_,{prop:"planStartDate",label:"计划开始日期",width:"120"},{default:a(({row:i})=>[y(R(z(i.planStartDate)),1)]),_:1}),e(_,{prop:"planFinishDate",label:"计划完成日期",width:"120"},{default:a(({row:i})=>[y(R(z(i.planFinishDate)),1)]),_:1}),e(_,{prop:"ipoStatus",label:"订单状态",width:"100"},{default:a(({row:i})=>[e(P,{type:N(i.ipoStatus)},{default:a(()=>[y(R(f(i.ipoStatus)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"writer",label:"录入人",width:"100"}),e(_,{prop:"writetime",label:"录入时间",width:"120"}),e(_,{label:"操作",width:"150"},{default:a(({row:i})=>[e(B,{type:"primary",size:"small",onClick:C=>l(i)},{default:a(()=>o[7]||(o[7]=[y(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,O.value]]),c("div",Ae,[e(t,{"current-page":w.pageNumber,"onUpdate:currentPage":o[2]||(o[2]=i=>w.pageNumber=i),"page-size":w.pageSize,"onUpdate:pageSize":o[3]||(o[3]=i=>w.pageSize=i),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:A.value,onSizeChange:p,onCurrentChange:m},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},Oe=te(qe,[["__scopeId","data-v-165d09ae"]]),Be={class:"material-selector"},Le={class:"card-header"},Te={class:"action-buttons"},Pe={key:0,class:"empty-material"},Re={__name:"DingdanItemSelector",props:{ipoNo:{type:String,default:""},woNo:{type:String,default:""},modelValue:{type:Boolean,default:!1},onSelect:{type:Function,default:()=>{}}},emits:["update:modelValue"],setup(H,{emit:j}){const k=H,L=j,S=h({ipoNo:""}),g=h([]),w=oe(()=>g.value.some(d=>N(d))),U=h([]),A=async()=>{try{const d=await ie();if(!d.success){console.error(d.msg);return}U.value=d.data.options||[]}catch{console.error("加载车间数据失败")}},O=d=>d?d.split(",").map(l=>{const T=U.value.find(W=>W.code===l.trim());return T?T.name:l}).join(","):"",$=async()=>{if(!k.ipoNo){b.error("未提供生产订单编号"),g.value=[];return}try{const p=(await $e({ipoNo:k.ipoNo})).data.itemList||[];S.value.ipoNo=k.ipoNo,g.value=p.map(m=>({id:m.id,dingdanitemId:m.id,itemname:m.itemname||"",productModel:m.productModel||"",amount:m.amount||0,unit:m.unit||"",workshopName:O(m.workshopName||m.workshopCode||""),originalMemo:m.memo||"",productionAmount:0,memo:""}))}catch(d){console.error("加载生产订单物料数据失败:",d),b.error("加载生产订单物料数据失败"),g.value=[]}},f=d=>{d.productionAmount>d.amount&&(b.warning("生产数量不能超过订单数量"),d.productionAmount=d.amount),d.productionAmount<0&&(d.productionAmount=0)},N=d=>d.productionAmount>0,z=d=>{d.productionAmount=0,d.memo=""},M=async()=>{const d=g.value.filter(p=>N(p));if(d.length===0){b.warning("请为物料设置有效的生产数量");return}try{const p=d.map(m=>({woNo:k.woNo,dingdanitemId:m.dingdanitemId,itemname:m.itemname,productModel:m.productModel,amount:m.productionAmount.toString(),unit:m.unit,memo:m.memo}));for(const m of p)await he(m);b.success(`成功添加${d.length}个物料`),g.value.forEach(z),k.onSelect(d),I()}catch(p){console.error("批量添加物料失败:",p),b.error("批量添加物料失败")}},I=()=>{L("update:modelValue",!1)};return Y(()=>[k.modelValue,k.ipoNo],([d,p])=>{d&&p&&(A(),$())},{immediate:!0}),(d,p)=>{const m=u("el-form-item"),l=u("el-form"),T=u("el-col"),W=u("el-row"),n=u("el-card"),o=u("el-button"),V=u("el-table-column"),F=u("el-input"),B=u("el-table"),D=u("el-dialog");return q(),G(D,{"model-value":H.modelValue,title:"选择物料",width:"90%","onUpdate:modelValue":p[0]||(p[0]=_=>L("update:modelValue",_)),onClose:I},{footer:a(()=>[e(o,{onClick:I},{default:a(()=>p[5]||(p[5]=[y("关闭")])),_:1})]),default:a(()=>[c("div",Be,[e(n,{class:"order-info-card",shadow:"never"},{header:a(()=>p[1]||(p[1]=[c("span",{class:"card-title"},"生产订单信息",-1)])),default:a(()=>[e(W,{gutter:12},{default:a(()=>[e(T,{span:12},{default:a(()=>[e(l,{"label-width":"100px",size:"small"},{default:a(()=>[e(m,{label:"订单编号"},{default:a(()=>[c("span",null,R(S.value.ipoNo),1)]),_:1}),e(m,{label:"工单编号"},{default:a(()=>[c("span",null,R(H.woNo),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{class:"material-list-card",shadow:"never"},{header:a(()=>[c("div",Le,[p[3]||(p[3]=c("span",{class:"card-title"},"物料信息",-1)),c("div",Te,[e(o,{type:"primary",onClick:M,disabled:!w.value},{default:a(()=>p[2]||(p[2]=[y(" 批量添加物料 ")])),_:1},8,["disabled"])])])]),default:a(()=>[e(B,{data:g.value,border:"",size:"small",style:{width:"100%"}},{default:a(()=>[e(V,{prop:"itemname",label:"物料名称","min-width":"120"}),e(V,{prop:"productModel",label:"规格型号","min-width":"100"}),e(V,{prop:"unit",label:"单位",width:"80"}),e(V,{prop:"amount",label:"订单数量",width:"100"}),e(V,{label:"生产数量",width:"120"},{default:a(({row:_})=>[e(F,{modelValue:_.productionAmount,"onUpdate:modelValue":P=>_.productionAmount=P,modelModifiers:{number:!0},type:"number",placeholder:"生产数量",size:"small",min:0,max:_.amount,onChange:P=>f(_)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),_:1}),e(V,{label:"生产车间","min-width":"150"},{default:a(({row:_})=>[c("span",null,R(_.workshopName),1)]),_:1}),e(V,{label:"备注","min-width":"150"},{default:a(({row:_})=>[e(F,{modelValue:_.memo,"onUpdate:modelValue":P=>_.memo=P,placeholder:"备注信息",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(V,{prop:"originalMemo",label:"原始备注","min-width":"100"})]),_:1},8,["data"]),g.value.length===0?(q(),J("div",Pe,p[4]||(p[4]=[c("p",null,"暂无物料信息",-1)]))):ne("",!0)]),_:1})])]),_:1},8,["model-value"])}}},We=te(Re,[["__scopeId","data-v-29197f98"]]),He={class:"order-section"},je={class:"section-header"},Ee={class:"form-section"},Ge={class:"form-section"},Ke={class:"form-section"},Ye={class:"form-section"},Je={class:"form-section"},Qe={class:"material-section"},Xe={class:"section-header"},Ze={key:0,class:"empty-material"},et={__name:"shengchangongdanForm",props:{visible:{type:Boolean,default:!1},type:{type:String,default:"add"},formData:{type:Object,default:()=>({})}},emits:["update:visible","submit","cancel"],setup(H,{emit:j}){const k=ge(),L=()=>(console.log("获取登录用户名称",k.descr),k.descr),S=H,g=j,w=h([]),U=async()=>{try{const r=await ie();if(!r.success){b.error(r.msg);return}w.value=r.data.options||[]}catch{b.error("加载车间数据失败")}},A=r=>r?w.value.length===0?r:r.split(",").map(i=>{const C=i.trim(),Q=w.value.find(ae=>ae.code===C);return Q?Q.name:i}).join(","):"",O=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],$=oe({get:()=>S.visible,set:r=>g("update:visible",r)}),f=oe(()=>S.type==="add"?"新增生产工单":"编辑生产工单"),N=h(null),z=h(!1),M=h(!1),I=h(!1),d=h(!1),p=h([]),m=async()=>{try{const r=await Me("scgd");return(r==null?void 0:r.code)===200?(console.log("获取编码成功",r.data.fullNoNyName),r.data.fullNoNyName):(b.error((r==null?void 0:r.msg)||"获取编码失败"),"")}catch(r){return console.error("生成生产工单编码出错:",r),b.error("请求编码服务时发生错误"),""}};Y($,async r=>{r&&(S.type==="add"?(l.woNo=await m(),d.value=!1):d.value=!0)});const l=Z({id:void 0,purchaserHqCode:"",ipoNo:"",supplierCode:"",supplierName:"",contractNo:"",woNo:"",categoryCode:"",subclassCode:"",materialsCode:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",woStatus:1,entityCode:"",processRouteNo:"",dataSource:"手工录入",dataSourceCreateTime:"",ownerId:"",openId:"",writer:L()}),T={ipoNo:[{required:!0,message:"请选择生产订单号",trigger:"blur"}],woNo:[{required:!0,message:"请输入工单编码",trigger:"blur"},{max:48,message:"长度不能超过48个字符",trigger:"blur"}],purchaserHqCode:[{required:!0,message:"采购方总部编码不能为空",trigger:"blur"}],supplierCode:[{required:!0,message:"供应商编码不能为空",trigger:"blur"}],supplierName:[{required:!0,message:"供应商名称不能为空",trigger:"blur"}],categoryCode:[{required:!0,message:"请输入品类编码",trigger:"blur"}],subclassCode:[{required:!0,message:"请输入种类编码",trigger:"blur"}],woStatus:[{required:!0,message:"请选择工单状态",trigger:"change"}]},W=()=>{N.value&&N.value.resetFields(),Object.assign(l,{id:void 0,purchaserHqCode:"",ipoNo:"",supplierCode:"",supplierName:"",contractNo:"",woNo:"",categoryCode:"",subclassCode:"",materialsCode:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",woStatus:1,entityCode:"",processRouteNo:"",dataSource:"手工录入",dataSourceCreateTime:"",ownerId:"",openId:"",writer:L()}),p.value=[],d.value=!1},n=r=>{r.stopPropagation(),z.value=!0},o=async r=>{if(r==null||r.stopPropagation(),!d.value){if(!N.value)return;let t=!1;try{await N.value.validate(v=>{t=v})}catch{t=!1}if(t)await B();else{b.warning("请先完善工单信息并保存");return}}M.value=!0},V=r=>{r&&(l.ipoNo=r.ipoNo,l.purchaserHqCode=r.purchaserHqCode,l.supplierCode=r.supplierCode,l.supplierName=r.supplierName,l.categoryCode=r.categoryCode,l.subclassCode=r.subclassCode,l.contractNo=r.contractNo),z.value=!1},F=r=>{D()},B=()=>{N.value&&N.value.validate(async r=>{var t;if(r)try{I.value=!0;let v;l.id?(v=await Ve(l),b.success("工单信息更新成功")):(v=await Ce(l),(t=v==null?void 0:v.data)!=null&&t.id&&(l.id=v.data.id),b.success("工单信息保存成功")),d.value=!0,S.type==="add"&&l.woNo&&D()}catch(v){console.error("保存生产工单失败",v),b.error("保存生产工单失败")}finally{I.value=!1}})},D=async()=>{if(l.woNo)try{const r=await Se({woNo:l.woNo});p.value=(r.data.itemList||[]).map(t=>({...t,workshopName:A(t.workshopName||t.workshopCode||"")}))}catch{b.error("加载物料列表失败")}},_=async r=>{try{await le.confirm("确定要删除这个物料吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De({id:r.id}),b.success("删除成功"),D()}catch(t){t!=="cancel"&&(console.error("删除物料失败",t),b.error("删除物料失败"))}};Y(()=>S.formData,r=>{if(U(),r&&Object.keys(r).length>0){const t={...r};t.planStartDate&&(t.planStartDate=new Date(t.planStartDate)),t.planFinishDate&&(t.planFinishDate=new Date(t.planFinishDate)),t.actualStartDate&&(t.actualStartDate=new Date(t.actualStartDate)),t.actualFinishDate&&(t.actualFinishDate=new Date(t.actualFinishDate)),t.dataSourceCreateTime&&(t.dataSourceCreateTime=new Date(t.dataSourceCreateTime)),Object.assign(l,t),S.type==="edit"&&l.woNo&&D()}},{immediate:!0,deep:!0});const P=()=>{g("cancel")};return(r,t)=>{const v=u("el-button"),x=u("el-input"),i=u("el-form-item"),C=u("el-col"),Q=u("el-option"),ae=u("el-select"),K=u("el-row"),X=u("el-date-picker"),ue=u("el-form"),pe=u("el-tooltip"),E=u("el-table-column"),ce=u("el-table"),me=u("el-dialog");return q(),G(me,{title:f.value,modelValue:$.value,"onUpdate:modelValue":t[19]||(t[19]=s=>$.value=s),width:"1400px",onClosed:W},{footer:a(()=>[e(v,{onClick:P},{default:a(()=>t[33]||(t[33]=[y("关闭")])),_:1})]),default:a(()=>[c("div",He,[c("div",je,[t[21]||(t[21]=c("h3",null,"生产工单信息",-1)),e(v,{type:"primary",onClick:B,loading:I.value},{default:a(()=>t[20]||(t[20]=[y(" 保存工单信息 ")])),_:1},8,["loading"])]),e(ue,{ref_key:"formRef",ref:N,model:l,rules:T,"label-width":"120px",size:"small"},{default:a(()=>[c("div",Ee,[t[23]||(t[23]=c("div",{class:"section-title"},"基本信息",-1)),e(K,{gutter:10},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(i,{label:"生产订单号",prop:"ipoNo"},{default:a(()=>[e(x,{modelValue:l.ipoNo,"onUpdate:modelValue":t[0]||(t[0]=s=>l.ipoNo=s),placeholder:"选择生产订单号",readonly:"",onClick:fe(n,["stop"])},{append:a(()=>[e(v,{onClick:n,size:"small"},{default:a(()=>t[22]||(t[22]=[y("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"工单编码",prop:"woNo"},{default:a(()=>[e(x,{modelValue:l.woNo,"onUpdate:modelValue":t[1]||(t[1]=s=>l.woNo=s),placeholder:"请输入工单编码",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"工单状态",prop:"woStatus"},{default:a(()=>[e(ae,{modelValue:l.woStatus,"onUpdate:modelValue":t[2]||(t[2]=s=>l.woStatus=s),placeholder:"请选择工单状态",style:{width:"100%"}},{default:a(()=>[(q(),J(_e,null,be(O,s=>e(Q,{key:s.id,label:s.value,value:s.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",Ge,[t[24]||(t[24]=c("div",{class:"section-title"},"供应商信息",-1)),e(K,{gutter:10},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(i,{label:"采购方总部编码",prop:"purchaserHqCode"},{default:a(()=>[e(x,{disabled:"",modelValue:l.purchaserHqCode,"onUpdate:modelValue":t[3]||(t[3]=s=>l.purchaserHqCode=s),placeholder:"采购方总部编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"供应商编码",prop:"supplierCode"},{default:a(()=>[e(x,{disabled:"",modelValue:l.supplierCode,"onUpdate:modelValue":t[4]||(t[4]=s=>l.supplierCode=s),placeholder:"供应商编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"供应商名称",prop:"supplierName"},{default:a(()=>[e(x,{disabled:"",modelValue:l.supplierName,"onUpdate:modelValue":t[5]||(t[5]=s=>l.supplierName=s),placeholder:"供应商名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(K,{gutter:10},{default:a(()=>[e(C,{span:12},{default:a(()=>[e(i,{label:"合同编号",prop:"contractNo"},{default:a(()=>[e(x,{disabled:"",modelValue:l.contractNo,"onUpdate:modelValue":t[6]||(t[6]=s=>l.contractNo=s),placeholder:"合同编号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",Ke,[t[25]||(t[25]=c("div",{class:"section-title"},"物料信息",-1)),e(K,{gutter:10},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(i,{label:"品类编码",prop:"categoryCode"},{default:a(()=>[e(x,{disabled:"",modelValue:l.categoryCode,"onUpdate:modelValue":t[7]||(t[7]=s=>l.categoryCode=s),placeholder:"品类编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"种类编码",prop:"subclassCode"},{default:a(()=>[e(x,{disabled:"",modelValue:l.subclassCode,"onUpdate:modelValue":t[8]||(t[8]=s=>l.subclassCode=s),placeholder:"种类编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"厂家物料编码",prop:"materialsCode"},{default:a(()=>[e(x,{modelValue:l.materialsCode,"onUpdate:modelValue":t[9]||(t[9]=s=>l.materialsCode=s),placeholder:"请输入厂家物料编码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",Ye,[t[26]||(t[26]=c("div",{class:"section-title"},"时间计划",-1)),e(K,{gutter:10},{default:a(()=>[e(C,{span:6},{default:a(()=>[e(i,{label:"计划开始日期",prop:"planStartDate"},{default:a(()=>[e(X,{modelValue:l.planStartDate,"onUpdate:modelValue":t[10]||(t[10]=s=>l.planStartDate=s),type:"date",placeholder:"选择计划开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:6},{default:a(()=>[e(i,{label:"计划完成日期",prop:"planFinishDate"},{default:a(()=>[e(X,{modelValue:l.planFinishDate,"onUpdate:modelValue":t[11]||(t[11]=s=>l.planFinishDate=s),type:"date",placeholder:"选择计划完成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:6},{default:a(()=>[e(i,{label:"实际开始日期",prop:"actualStartDate"},{default:a(()=>[e(X,{modelValue:l.actualStartDate,"onUpdate:modelValue":t[12]||(t[12]=s=>l.actualStartDate=s),type:"date",placeholder:"选择实际开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:6},{default:a(()=>[e(i,{label:"实际完成日期",prop:"actualFinishDate"},{default:a(()=>[e(X,{modelValue:l.actualFinishDate,"onUpdate:modelValue":t[13]||(t[13]=s=>l.actualFinishDate=s),type:"date",placeholder:"选择实际完成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",Je,[t[27]||(t[27]=c("div",{class:"section-title"},"其他信息",-1)),e(K,{gutter:10},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(i,{label:"实物ID",prop:"entityCode"},{default:a(()=>[e(x,{modelValue:l.entityCode,"onUpdate:modelValue":t[14]||(t[14]=s=>l.entityCode=s),placeholder:"请输入实物ID"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"工艺路线编码",prop:"processRouteNo"},{default:a(()=>[e(x,{modelValue:l.processRouteNo,"onUpdate:modelValue":t[15]||(t[15]=s=>l.processRouteNo=s),placeholder:"请输入工艺路线编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:8},{default:a(()=>[e(i,{label:"数据来源",prop:"dataSource"},{default:a(()=>[e(x,{modelValue:l.dataSource,"onUpdate:modelValue":t[16]||(t[16]=s=>l.dataSource=s),placeholder:"请输入数据来源"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])]),c("div",Qe,[c("div",Xe,[t[30]||(t[30]=c("h3",null,"物料信息",-1)),d.value?(q(),G(v,{key:1,type:"success",onClick:o},{default:a(()=>t[29]||(t[29]=[y(" 添加物料 ")])),_:1})):(q(),G(pe,{key:0,content:"请先保存工单信息",placement:"top"},{default:a(()=>[e(v,{type:"success",disabled:!0},{default:a(()=>t[28]||(t[28]=[y(" 添加物料 ")])),_:1})]),_:1}))]),e(ce,{data:p.value,border:"",size:"small",style:{width:"100%"}},{default:a(()=>[e(E,{prop:"itemname",label:"物料名称","min-width":"120"}),e(E,{prop:"productModel",label:"规格型号",width:"100"}),e(E,{prop:"amount",label:"数量",width:"80"}),e(E,{prop:"unit",label:"单位",width:"80"}),e(E,{prop:"workshopName",label:"生产车间","min-width":"150"}),e(E,{prop:"memo",label:"备注","min-width":"120"}),e(E,{label:"操作",width:"160"},{default:a(({row:s})=>[e(v,{type:"danger",size:"small",onClick:st=>_(s)},{default:a(()=>t[31]||(t[31]=[y("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),p.value.length===0?(q(),J("div",Ze,t[32]||(t[32]=[c("p",null,"暂无物料信息，请先保存工单信息后添加物料",-1)]))):ne("",!0)]),e(Oe,{modelValue:z.value,"onUpdate:modelValue":t[17]||(t[17]=s=>z.value=s),onSelect:V},null,8,["modelValue"]),e(We,{modelValue:M.value,"onUpdate:modelValue":t[18]||(t[18]=s=>M.value=s),ipoNo:l.ipoNo,woNo:l.woNo,onSelect:F},null,8,["modelValue","ipoNo","woNo"])]),_:1},8,["title","modelValue"])}}},tt=te(et,[["__scopeId","data-v-a1df1b9e"]]),at={class:"production-workorder-management"},ot={class:"action-bar"},lt={key:0,class:"batch-actions"},nt={class:"pagination-container"},rt={__name:"shengchangongdan",setup(H){const j={1:{label:"待处理",type:"info"},2:{label:"处理中",type:"warning"},3:{label:"已完成",type:"success"},4:{label:"已取消",type:"danger"},5:{label:"已过期",type:"danger"}},k=n=>{var o;return((o=j[n])==null?void 0:o.label)||"未知状态"},L=n=>{if(!n)return"-";const o=new Date(n);return`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`},S=h(!1),g=h([]),w=h(0),U=h([]),A=h(!1),O=h("add"),$=h({}),f=Z({ipoNo:"",woNo:"",pageNumber:1,pageSize:10}),N=async()=>{S.value=!0;try{const n=await ke(f);g.value=n.data.page.list||[],w.value=n.data.page.totalRow||0}catch(n){console.error("获取生产工单列表失败:",n),b.error("获取生产工单列表失败")}finally{S.value=!1}},z=()=>{f.pageNumber=1,N()},M=()=>{f.ipoNo="",f.woNo="",f.pageNumber=1,N()},I=n=>{f.pageSize=n,f.pageNumber=1,N()},d=n=>{f.pageNumber=n,N()},p=()=>{O.value="add",$.value={},A.value=!0},m=async n=>{try{O.value="edit";const o=await Ue({id:n.id});$.value=o.data.plshengchangongdan||{},A.value=!0}catch(o){console.error("获取工单详情失败:",o),b.error("获取工单详情失败")}},l=async n=>{try{await le.confirm(`确认删除生产工单"${n.woNo}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ze({id:n.id}),b.success("删除成功"),g.value.length===1&&f.pageNumber>1&&(f.pageNumber-=1),N()}catch(o){o!=="cancel"&&(console.error("删除工单失败:",o),b.error("删除工单失败"))}},T=async()=>{if(U.value.length===0){b.warning("请选择要删除的工单");return}try{await le.confirm(`确认删除选中的 ${U.value.length} 条生产工单吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const n=U.value.map(o=>o.id);await Fe(n),b.success("批量删除成功"),U.value=[],g.value.length===U.value.length&&f.pageNumber>1&&(f.pageNumber-=1),N()}catch(n){n!=="cancel"&&(console.error("批量删除失败:",n),b.error("批量删除失败"))}},W=()=>{A.value=!1,$.value={},N()};return ve(()=>{N()}),ye(()=>{}),(n,o)=>{const V=u("el-input"),F=u("el-button"),B=u("el-icon"),D=u("el-table-column"),_=u("el-table"),P=u("el-pagination"),r=se("loading");return q(),J("div",at,[c("div",ot,[e(V,{modelValue:f.ipoNo,"onUpdate:modelValue":o[0]||(o[0]=t=>f.ipoNo=t),placeholder:"请输入供应商生产订单序号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:z,onKeyup:ee(z,["enter"])},null,8,["modelValue"]),e(V,{modelValue:f.woNo,"onUpdate:modelValue":o[1]||(o[1]=t=>f.woNo=t),placeholder:"请输入生产工单编码查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:z,onKeyup:ee(z,["enter"])},null,8,["modelValue"]),e(F,{type:"primary",onClick:z},{default:a(()=>o[5]||(o[5]=[y("搜索")])),_:1}),e(F,{type:"warning",onClick:M},{default:a(()=>[e(B,null,{default:a(()=>[e(re(we))]),_:1}),o[6]||(o[6]=y(" 刷新 "))]),_:1}),e(F,{type:"primary",style:{"margin-left":"auto"},onClick:p},{default:a(()=>[e(B,null,{default:a(()=>[e(re(Ne))]),_:1}),o[7]||(o[7]=y(" 新增工单 "))]),_:1})]),de((q(),G(_,{data:g.value,border:"",style:{width:"100%"}},{default:a(()=>[e(D,{type:"selection",width:"55"}),e(D,{type:"index",label:"序号",width:"80"}),e(D,{prop:"woNo",label:"生产工单号"}),e(D,{prop:"contractNo",label:"合同编号"}),e(D,{prop:"ipoNo",label:"生产订单号"}),e(D,{prop:"planStartDate",label:"计划开始日期",width:"180"},{default:a(({row:t})=>[y(R(L(t.planStartDate)),1)]),_:1}),e(D,{prop:"planFinishDate",label:"计划完成日期",width:"180"},{default:a(({row:t})=>[y(R(L(t.planFinishDate)),1)]),_:1}),e(D,{prop:"woStatus",label:"工单状态",width:"120"},{default:a(({row:t})=>[y(R(k(t.woStatus)),1)]),_:1}),e(D,{prop:"dataSource",label:"数据来源"}),e(D,{label:"操作",width:"200"},{default:a(({row:t})=>[e(F,{type:"primary",size:"small",onClick:v=>m(t)},{default:a(()=>o[8]||(o[8]=[y("编辑")])),_:2},1032,["onClick"]),e(F,{type:"danger",size:"small",onClick:v=>l(t)},{default:a(()=>o[9]||(o[9]=[y("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[r,S.value]]),U.value.length>0?(q(),J("div",lt,[e(F,{type:"danger",onClick:T},{default:a(()=>[y(" 批量删除 ("+R(U.value.length)+") ",1)]),_:1})])):ne("",!0),c("div",nt,[e(P,{"current-page":f.pageNumber,"onUpdate:currentPage":o[2]||(o[2]=t=>f.pageNumber=t),"page-size":f.pageSize,"onUpdate:pageSize":o[3]||(o[3]=t=>f.pageSize=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:w.value,onSizeChange:I,onCurrentChange:d},null,8,["current-page","page-size","total"])]),e(tt,{visible:A.value,"onUpdate:visible":o[4]||(o[4]=t=>A.value=t),type:O.value,"form-data":$.value,onCancel:W},null,8,["visible","type","form-data"])])}}},mt=te(rt,[["__scopeId","data-v-937880fd"]]);export{mt as default};
