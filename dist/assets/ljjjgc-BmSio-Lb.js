import{O as z,P as he,Q as ye,R as Ve,_ as Ne,f as Se,g as A,r as g,k as ve,s as we,h as p,G as je,o as V,c as S,a as U,b as l,e as _,w as o,i as b,x as T,a6 as Ce,H as Me,l as ke,F as H,m as Q,ai as X,q as Z,p as Ue,E as f,A as _e,B as xe}from"./index-DvIhe9Wx.js";import{a as Be}from"./file-dcKrrYHU.js";import{W as De}from"./WoNoSelector-Ccp7to0E.js";import"./plshengchangongdan-xXUNx7N2.js";function qe(c){return z("/clljjjGc/getpage",c)}function Le(c){return z("/clljjjGc/get",c)}function Te(c){return he("/clljjjGc/save",c)}function ze(c){return ye("/clljjjGc/update",c)}function Ge(c){return Ve("/clljjjGc/delete",c)}function $e(c){return z("/cljjjGc/getWoNoList",c)}const We={class:"ljjjGc-management"},Fe={class:"action-bar"},Pe=["onClick"],Oe={class:"pagination-container"},Je={key:0,class:"uploaded-files"},Ye=["onClick"],Ee={__name:"ljjjgc",setup(c){const I=xe,w=Se(),G=()=>(console.log("获取登录用户名称",w.descr),w.descr),u=A({mafactory:"",matMaterial:"",orderno:"",recheckBatchNo:"",pageNumber:1,pageSize:10}),$=g([]),W=g(0),x=g(!1),j=g(!1),F=g([]),P=g(0),B=g(!1),N=g(!1),C=g("add"),ee=ve(()=>C.value==="add"?"新增数据":"编辑数据"),v=g(null),M=g(null),k=g([]),t=A({id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",matMaterial:"",orderno:"",matSpec:"",batch:"",recheckBatchNo:"",chemC:0,chemSi:0,chemMn:0,chemP:0,chemS:0,chemCr:0,chemNi:0,chemMo:0,tensileStrength:0,yieldStrength:0,elongation:0,leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:G(),status:0,isdelete:0}),le={mafactory:[{required:!0,message:"请输入原材料制造商",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],matMaterial:[{required:!0,message:"请输入牌号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],orderno:[{required:!0,message:"请输入入库单号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],matSpec:[{required:!0,message:"请输入规格",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],batch:[{required:!0,message:"请输入炉批号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],recheckBatchNo:[{required:!0,message:"请输入原材料复检批次号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],chemC:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemSi:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemMn:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemP:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemS:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemCr:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemNi:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],chemMo:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],tensileStrength:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],yieldStrength:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],elongation:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],leavefactoryDate:[{required:!0,message:"请输入出厂日期",trigger:"change"}],detectionTime:[{required:!0,message:"请输入入厂日期",trigger:"change"}],contractNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],woNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],ipoNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}]},O=()=>{j.value=!0,J()},te=r=>{u.woNo=r.woNo,t.woNo=r.woNo,j.value=!1,r.ipoNo?(t.ipoNo=r.ipoNo,console.log("设置生产订单号:",t.ipoNo)):f.warning("未找到对应的生产订单号"),r.contractNo?(t.contractNo=r.contractNo,console.log("设置合同号:",t.contractNo),t.ipoNo&&t.ipoNo===t.contractNo&&f.info("生产订单号与合同号相同")):f.warning("未找到对应的合同号")},J=async(r="")=>{B.value=!0;try{const e=await $e({pageNumber:1,pageSize:10,woNo:r});F.value=e.data.page.list,P.value=e.data.page.totalRow}catch(e){console.error("获取合同号列表失败",e),f.error("获取合同号列表失败")}finally{B.value=!1}},m=async()=>{x.value=!0;try{const r=await qe(u);$.value=r.data.page.list,W.value=r.data.page.totalRow}catch(r){console.error("获取数据列表失败",r),f.error("获取数据列表失败")}finally{x.value=!1}},ae=r=>{u.pageSize=r,m()},oe=r=>{u.pageNumber=r,m()},Y=()=>{v.value&&v.value.resetFields(),M.value&&M.value.clearFiles(),k.value=[],Object.assign(t,{id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",matMaterial:"",orderno:"",matSpec:"",batch:"",recheckBatchNo:"",chemC:0,chemSi:0,chemMn:0,chemP:0,chemS:0,chemCr:0,chemNi:0,chemMo:0,tensileStrength:0,yieldStrength:0,elongation:0,leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:G(),status:0,isdelete:0})},re=()=>{u.contractNo="",u.woNo="",u.ipoNo="",u.mafactory="",u.matMaterial="",u.orderno="",u.recheckBatchNo="",u.pageNumber=1,m()},ne=()=>{C.value="add",Y(),t.writer=w.descr||"未知用户",N.value=!0},ie=async r=>{C.value="edit";const e=await Le({id:r.id});Object.assign(t,e.data.ljjjGc),t.writer||(t.writer=w.descr||"未知用户");try{JSON.parse(t.certificate)}catch{if(t.certificate){const s=t.certificate.split("-");t.certificate=JSON.stringify(s.map(h=>({name:h.split("/").pop(),url:`/api/upload/${h}`})))}else t.certificate="[]"}k.value=JSON.parse(t.certificate),N.value=!0},ue=r=>{_e.confirm(`确认删除数据"${r.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ge({id:r.id}),f.success("删除成功"),m()}catch(e){console.error("删除数据失败",e),f.error("删除数据失败")}}).catch(()=>{})},de=()=>{v.value&&v.value.validate(async r=>{if(r)try{const e=new Date,n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),h=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),D=String(e.getMinutes()).padStart(2,"0"),q=String(e.getSeconds()).padStart(2,"0");t.writeTime=`${n}-${s}-${h} ${i}:${D}:${q}`,C.value==="add"?(await Te(t),f.success("新增成功")):(await ze(t),f.success("修改成功")),N.value=!1,m()}catch(e){console.error("保存数据失败",e),f.error("保存数据失败")}})},se=async r=>{const e=new FormData;e.append("file",r.raw);try{const n=await Be(e);if(n.success&&n.data&&n.data.url){const s=I+n.data.url,h=JSON.parse(t.certificate);h.push({name:r.name,url:s}),t.certificate=JSON.stringify(h),k.value.push({name:r.name,url:s}),f.success(`${r.name} 上传成功`)}else throw new Error(n.msg||"文件上传失败")}catch(n){console.error("文件上传失败",n),f.error(`${r.name} 上传失败`),M.value.clearFiles()}},me=r=>{const e=JSON.parse(t.certificate);e.splice(r,1),t.certificate=JSON.stringify(e),k.value.splice(r,1)},E=r=>{window.open(r,"_blank")};return we(()=>{m()}),(r,e)=>{const n=p("el-input"),s=p("el-button"),h=p("el-icon"),i=p("el-table-column"),D=p("el-table"),q=p("el-pagination"),d=p("el-form-item"),R=p("el-date-picker"),pe=p("el-upload"),K=p("el-col"),ce=p("el-row"),ge=p("el-form"),fe=p("el-dialog"),be=je("loading");return V(),S("div",We,[U("div",Fe,[l(n,{modelValue:u.mafactory,"onUpdate:modelValue":e[0]||(e[0]=a=>u.mafactory=a),placeholder:"请输入原材料制造商查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:m,onKeyup:_(m,["enter"])},null,8,["modelValue"]),l(n,{modelValue:u.matMaterial,"onUpdate:modelValue":e[1]||(e[1]=a=>u.matMaterial=a),placeholder:"请输入牌号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:m,onKeyup:_(m,["enter"])},null,8,["modelValue"]),l(n,{modelValue:u.orderno,"onUpdate:modelValue":e[2]||(e[2]=a=>u.orderno=a),placeholder:"请输入入库单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:m,onKeyup:_(m,["enter"])},null,8,["modelValue"]),l(n,{modelValue:u.recheckBatchNo,"onUpdate:modelValue":e[3]||(e[3]=a=>u.recheckBatchNo=a),placeholder:"请输入原材料复检批次号",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:m,onKeyup:_(m,["enter"])},null,8,["modelValue"]),l(s,{type:"primary",onClick:m},{default:o(()=>e[32]||(e[32]=[b("搜索")])),_:1}),l(s,{type:"warning",onClick:re},{default:o(()=>[l(h,null,{default:o(()=>[l(T(Ce))]),_:1}),e[33]||(e[33]=b(" 刷新 "))]),_:1}),l(s,{type:"primary",style:{"margin-left":"auto"},onClick:ne},{default:o(()=>e[34]||(e[34]=[b("新增")])),_:1})]),Me((V(),ke(D,{data:$.value,border:"",style:{width:"100%"}},{default:o(()=>[l(i,{type:"index",label:"序号",width:"80"}),l(i,{prop:"contractNo",label:"合同编号"}),l(i,{prop:"woNo",label:"生产工单号"}),l(i,{prop:"ipoNo",label:"生产订单号"}),l(i,{prop:"writer",label:"录入人"}),l(i,{prop:"writeTime",label:"录入时间"}),l(i,{prop:"mafactory",label:"原材料制造商"}),l(i,{prop:"matMaterial",label:"牌号"}),l(i,{prop:"orderno",label:"入库单号"}),l(i,{prop:"matSpec",label:"规格"}),l(i,{prop:"batch",label:"炉批号"}),l(i,{prop:"recheckBatchNo",label:"原材料复检批次号"}),l(i,{prop:"chemC",label:"化学成分分析-C"}),l(i,{prop:"chemSi",label:"化学成分分析-Si"}),l(i,{prop:"chemMn",label:"化学成分分析-Mn"}),l(i,{prop:"chemP",label:"化学成分分析-P"}),l(i,{prop:"chemS",label:"化学成分分析-S"}),l(i,{prop:"chemCr",label:"化学成分分析-Cr"}),l(i,{prop:"chemNi",label:"化学成分分析-Ni"}),l(i,{prop:"chemMo",label:"化学成分分析-Mo"}),l(i,{prop:"tensileStrength",label:"拉伸试验-抗拉强度"}),l(i,{prop:"yieldStrength",label:"拉伸试验-屈服强度"}),l(i,{prop:"elongation",label:"拉伸试验-断后伸长率"}),l(i,{prop:"leavefactoryDate",label:"原材料出厂检测日期",width:"120"}),l(i,{prop:"detectionTime",label:"原材料入厂检测日期",width:"120"}),l(i,{prop:"certificate",label:"质量证明书"},{default:o(({row:a})=>[(V(!0),S(H,null,Q(JSON.parse(a.certificate||"[]"),(y,L)=>(V(),S("div",{key:L},[l(T(X),{content:y.name,placement:"top"},{default:o(()=>[U("span",{class:"file-link",onClick:Re=>E(y.url,y.name)}," 打开文件 ",8,Pe)]),_:2},1032,["content"])]))),128))]),_:1}),l(i,{label:"操作",width:"200"},{default:o(({row:a})=>[l(s,{type:"primary",size:"small",onClick:y=>ie(a)},{default:o(()=>e[35]||(e[35]=[b("编辑")])),_:2},1032,["onClick"]),l(s,{type:"danger",size:"small",onClick:y=>ue(a)},{default:o(()=>e[36]||(e[36]=[b("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[be,x.value]]),U("div",Oe,[l(q,{"current-page":u.pageNumber,"onUpdate:currentPage":e[4]||(e[4]=a=>u.pageNumber=a),"page-size":u.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>u.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:W.value,onSizeChange:ae,onCurrentChange:oe},null,8,["current-page","page-size","total"])]),l(fe,{title:ee.value,modelValue:N.value,"onUpdate:modelValue":e[30]||(e[30]=a=>N.value=a),width:"800px",onClosed:Y},{footer:o(()=>[l(s,{onClick:e[29]||(e[29]=a=>N.value=!1)},{default:o(()=>e[40]||(e[40]=[b("取消")])),_:1}),l(s,{type:"primary",onClick:de},{default:o(()=>e[41]||(e[41]=[b("确定")])),_:1})]),default:o(()=>[l(ge,{ref_key:"formRef",ref:v,model:t,rules:le,"label-width":"140px"},{default:o(()=>[l(ce,{gutter:20},{default:o(()=>[l(K,{span:12},{default:o(()=>[l(d,{label:"合同编号",prop:"contractNo"},{default:o(()=>[l(n,{modelValue:t.contractNo,"onUpdate:modelValue":e[6]||(e[6]=a=>t.contractNo=a),placeholder:"合同编号",readonly:""},null,8,["modelValue"])]),_:1}),l(d,{label:"生产工单号",prop:"woNo"},{default:o(()=>[l(n,{modelValue:t.woNo,"onUpdate:modelValue":e[7]||(e[7]=a=>t.woNo=a),placeholder:"选择生产工单号",readonly:"",onClick:O},{append:o(()=>[l(s,{onClick:O,size:"small"},{default:o(()=>e[37]||(e[37]=[b("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"生产订单号",prop:"ipoNo"},{default:o(()=>[l(n,{modelValue:t.ipoNo,"onUpdate:modelValue":e[8]||(e[8]=a=>t.ipoNo=a),placeholder:"生产订单号",readonly:""},null,8,["modelValue"])]),_:1}),l(d,{label:"录入人",prop:"writer"},{default:o(()=>[l(n,{modelValue:t.writer,"onUpdate:modelValue":e[9]||(e[9]=a=>t.writer=a),placeholder:"录入人",readonly:""},null,8,["modelValue"])]),_:1}),l(d,{label:"原材料制造商",prop:"mafactory"},{default:o(()=>[l(n,{modelValue:t.mafactory,"onUpdate:modelValue":e[10]||(e[10]=a=>t.mafactory=a),placeholder:"请输入原材料制造商"},null,8,["modelValue"])]),_:1}),l(d,{label:"牌号",prop:"matMaterial"},{default:o(()=>[l(n,{modelValue:t.matMaterial,"onUpdate:modelValue":e[11]||(e[11]=a=>t.matMaterial=a),placeholder:"请输入牌号"},null,8,["modelValue"])]),_:1}),l(d,{label:"入库单号",prop:"orderno"},{default:o(()=>[l(n,{modelValue:t.orderno,"onUpdate:modelValue":e[12]||(e[12]=a=>t.orderno=a),placeholder:"请输入入库单号"},null,8,["modelValue"])]),_:1}),l(d,{label:"规格",prop:"matSpec"},{default:o(()=>[l(n,{modelValue:t.matSpec,"onUpdate:modelValue":e[13]||(e[13]=a=>t.matSpec=a),placeholder:"请输入规格"},null,8,["modelValue"])]),_:1}),l(d,{label:"炉批号",prop:"batch"},{default:o(()=>[l(n,{modelValue:t.batch,"onUpdate:modelValue":e[14]||(e[14]=a=>t.batch=a),placeholder:"请输入炉批号"},null,8,["modelValue"])]),_:1}),l(d,{label:"原材料复检批次号",prop:"recheckBatchNo"},{default:o(()=>[l(n,{modelValue:t.recheckBatchNo,"onUpdate:modelValue":e[15]||(e[15]=a=>t.recheckBatchNo=a),placeholder:"请输入原材料复检批次号"},null,8,["modelValue"])]),_:1}),l(d,{label:"原材料出厂检测日期",prop:"leavefactoryDate"},{default:o(()=>[l(R,{modelValue:t.leavefactoryDate,"onUpdate:modelValue":e[16]||(e[16]=a=>t.leavefactoryDate=a),type:"date",placeholder:"请选择原材料出厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"原材料入厂检测日期",prop:"detectionTime"},{default:o(()=>[l(R,{modelValue:t.detectionTime,"onUpdate:modelValue":e[17]||(e[17]=a=>t.detectionTime=a),type:"date",placeholder:"请选择原材料入厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"质量证明书",prop:"certificate"},{default:o(()=>[l(pe,{ref_key:"certificateUpload",ref:M,"auto-upload":!1,"on-change":se,limit:10,accept:".pdf,.jpg,.jpeg,.png","file-list":[],"show-file-list":!1},{default:o(()=>[l(s,{type:"primary"},{default:o(()=>e[38]||(e[38]=[b("上传文件")])),_:1})]),_:1},512),t.certificate?(V(),S("div",Je,[(V(!0),S(H,null,Q(JSON.parse(t.certificate),(a,y)=>(V(),S("div",{key:y,class:"uploaded-file"},[b(Z(a.name)+" ",1),l(T(X),{content:a.name,placement:"top"},{default:o(()=>[U("span",{class:"file-link",onClick:L=>E(a.url,a.name)},Z(a.name),9,Ye)]),_:2},1032,["content"]),l(s,{type:"danger",size:"mini",onClick:L=>me(y)},{default:o(()=>e[39]||(e[39]=[b("删除")])),_:2},1032,["onClick"])]))),128))])):Ue("",!0)]),_:1})]),_:1}),l(K,{span:12},{default:o(()=>[l(d,{label:"化学成分分析-C",prop:"chemC"},{default:o(()=>[l(n,{modelValue:t.chemC,"onUpdate:modelValue":e[18]||(e[18]=a=>t.chemC=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-C",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-Si",prop:"chemSi"},{default:o(()=>[l(n,{modelValue:t.chemSi,"onUpdate:modelValue":e[19]||(e[19]=a=>t.chemSi=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-Si",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-Mn",prop:"chemMn"},{default:o(()=>[l(n,{modelValue:t.chemMn,"onUpdate:modelValue":e[20]||(e[20]=a=>t.chemMn=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-Mn",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-P",prop:"chemP"},{default:o(()=>[l(n,{modelValue:t.chemP,"onUpdate:modelValue":e[21]||(e[21]=a=>t.chemP=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-P",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-S",prop:"chemS"},{default:o(()=>[l(n,{modelValue:t.chemS,"onUpdate:modelValue":e[22]||(e[22]=a=>t.chemS=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-S",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-Ni",prop:"chemNi"},{default:o(()=>[l(n,{modelValue:t.chemNi,"onUpdate:modelValue":e[23]||(e[23]=a=>t.chemNi=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-Ni",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-Mo",prop:"chemMo"},{default:o(()=>[l(n,{modelValue:t.chemMo,"onUpdate:modelValue":e[24]||(e[24]=a=>t.chemMo=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-Mo",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"化学成分分析-Cr",prop:"chemCr"},{default:o(()=>[l(n,{modelValue:t.chemCr,"onUpdate:modelValue":e[25]||(e[25]=a=>t.chemCr=a),modelModifiers:{number:!0},placeholder:"请输入化学成分分析-Cr",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"拉伸试验-抗拉强度",prop:"tensileStrength"},{default:o(()=>[l(n,{modelValue:t.tensileStrength,"onUpdate:modelValue":e[26]||(e[26]=a=>t.tensileStrength=a),modelModifiers:{number:!0},placeholder:"请输入拉伸试验-抗拉强度",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"拉伸试验-屈服强度",prop:"yieldStrength"},{default:o(()=>[l(n,{modelValue:t.yieldStrength,"onUpdate:modelValue":e[27]||(e[27]=a=>t.yieldStrength=a),modelModifiers:{number:!0},placeholder:"请输入拉伸试验-屈服强度",type:"number"},null,8,["modelValue"])]),_:1}),l(d,{label:"拉伸试验-断后伸长率",prop:"elongation"},{default:o(()=>[l(n,{modelValue:t.elongation,"onUpdate:modelValue":e[28]||(e[28]=a=>t.elongation=a),modelModifiers:{number:!0},placeholder:"请输入拉伸试验-断后伸长率",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(De,{modelValue:j.value,"onUpdate:modelValue":e[31]||(e[31]=a=>j.value=a),onSelect:te,woNoList:F.value,totalWoNo:P.value,loadingWoNo:B.value,onSearch:J},null,8,["modelValue","woNoList","totalWoNo","loadingWoNo"])])}}},Xe=Ne(Ee,[["__scopeId","data-v-5e85b5aa"]]);export{Xe as default};
