import{_ as H,g as P,r as v,s as Z,h as g,o as x,c as J,b as e,w as n,a as E,i as w,E as d,u as X,G as ee,e as L,x as te,a6 as oe,H as le,l as F,p as Q,M as A,A as G}from"./index-DvIhe9Wx.js";import{g as ae,u as ne,a as ie,c as re,f as ue}from"./querentongzhi-X4SMs00W.js";import{C as se}from"./chakanbeiliaodan-BtWLYdX9.js";import"./beiliaodan-Dk2XcVHU.js";const de={class:"chakantongzhi"},pe={class:"pagination-container"},me={__name:"chakantongzhi",props:{noticeid:{type:String,required:!0}},setup(K){const f=P({noticeid:K.noticeid,pageNumber:1,pageSize:10}),N=v([]),S=v(0),V=v(!1),a=v({}),_=v(null),k=P({no:[{required:!0,message:"请输入合同编号",trigger:"blur"}],noticeid:[{required:!0,message:"请输入通知编号",trigger:"blur"}],noticename:[{required:!0,message:"请输入通知名称",trigger:"blur"}],noticebuilddate:[{required:!0,message:"请选择通知创建日期",trigger:"change"}]}),$=(r,l,s)=>{if(!s)return"";const z=new Date(s),U=z.getFullYear(),c=String(z.getMonth()+1).padStart(2,"0"),m=String(z.getDate()).padStart(2,"0");return`${U}-${c}-${m}`},C=async()=>{try{const r=await ae(f);r.success?(N.value=r.data.page.list,S.value=r.data.page.totalRow):d.error(r.msg||"获取通知详情失败")}catch(r){console.error("获取通知详情失败:",r),d.error("获取通知详情失败")}},D=r=>{f.pageSize=r,f.pageNumber=1,C()},B=r=>{f.pageNumber=r,C()},q=async()=>{if(_.value)try{await _.value.validate();const r={...a.value,noticebuilddate:a.value.noticebuilddate?new Date(a.value.noticebuilddate).getTime():null},l=await ne(r);l.success?(d.success("更新成功"),V.value=!1,C()):d.error(l.msg||"更新失败")}catch(r){console.log("表单验证失败:",r),d.warning("请检查并填写必填字段")}};return Z(()=>{C()}),(r,l)=>{const s=g("el-table-column"),z=g("el-table"),U=g("el-pagination"),c=g("el-input"),m=g("el-form-item"),I=g("el-input-number"),M=g("el-date-picker"),h=g("el-form"),i=g("el-button"),t=g("el-dialog");return x(),J("div",de,[e(z,{data:N.value,border:"",style:{width:"100%"}},{default:n(()=>[e(s,{prop:"itemno",label:"产品型号"}),e(s,{prop:"spec",label:"规格"}),e(s,{prop:"itemnum",label:"数量"}),e(s,{prop:"unit",label:"单位"}),e(s,{prop:"noticeid",label:"通知编号"}),e(s,{prop:"noticename",label:"通知名称"}),e(s,{prop:"noticedeliver",label:"通知校验人"}),e(s,{prop:"noticeauther",label:"通知作者"}),e(s,{prop:"noticeinstead",label:"通知替代型号"}),e(s,{prop:"noticedrawno",label:"通知图纸编号"}),e(s,{prop:"noticecomment",label:"通知备注"}),e(s,{prop:"noticeshenhe",label:"通知审核者"}),e(s,{prop:"name",label:"名称"}),e(s,{prop:"noticebuilddate",label:"通知创建日期",formatter:$})]),_:1},8,["data"]),E("div",pe,[e(U,{"current-page":f.pageNumber,"onUpdate:currentPage":l[0]||(l[0]=o=>f.pageNumber=o),"page-size":f.pageSize,"onUpdate:pageSize":l[1]||(l[1]=o=>f.pageSize=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:D,onCurrentChange:B},null,8,["current-page","page-size","total"])]),e(t,{modelValue:V.value,"onUpdate:modelValue":l[17]||(l[17]=o=>V.value=o),title:"编辑通知详情"},{footer:n(()=>[e(i,{onClick:l[16]||(l[16]=o=>V.value=!1)},{default:n(()=>l[18]||(l[18]=[w("取消")])),_:1}),e(i,{type:"primary",onClick:q},{default:n(()=>l[19]||(l[19]=[w("保存")])),_:1})]),default:n(()=>[e(h,{model:a.value,rules:k,ref_key:"editFormRef",ref:_,"label-width":"120px"},{default:n(()=>[e(m,{label:"物料编号",prop:"itemno"},{default:n(()=>[e(c,{modelValue:a.value.itemno,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.itemno=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"规格",prop:"spec"},{default:n(()=>[e(c,{modelValue:a.value.spec,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.spec=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"数量",prop:"itemnum"},{default:n(()=>[e(I,{modelValue:a.value.itemnum,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.itemnum=o),min:0},null,8,["modelValue"])]),_:1}),e(m,{label:"单位",prop:"unit"},{default:n(()=>[e(c,{modelValue:a.value.unit,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.unit=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知编号",prop:"noticeid"},{default:n(()=>[e(c,{modelValue:a.value.noticeid,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.noticeid=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知名称",prop:"noticename"},{default:n(()=>[e(c,{modelValue:a.value.noticename,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.noticename=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知校验人",prop:"noticedeliver"},{default:n(()=>[e(c,{modelValue:a.value.noticedeliver,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.noticedeliver=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知作者",prop:"noticeauther"},{default:n(()=>[e(c,{modelValue:a.value.noticeauther,"onUpdate:modelValue":l[9]||(l[9]=o=>a.value.noticeauther=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知替代型号",prop:"noticeinstead"},{default:n(()=>[e(c,{modelValue:a.value.noticeinstead,"onUpdate:modelValue":l[10]||(l[10]=o=>a.value.noticeinstead=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知图纸编号",prop:"noticedrawno"},{default:n(()=>[e(c,{modelValue:a.value.noticedrawno,"onUpdate:modelValue":l[11]||(l[11]=o=>a.value.noticedrawno=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知备注",prop:"noticecomment"},{default:n(()=>[e(c,{type:"textarea",modelValue:a.value.noticecomment,"onUpdate:modelValue":l[12]||(l[12]=o=>a.value.noticecomment=o),rows:4},null,8,["modelValue"])]),_:1}),e(m,{label:"通知审核者",prop:"noticeshenhe"},{default:n(()=>[e(c,{modelValue:a.value.noticeshenhe,"onUpdate:modelValue":l[13]||(l[13]=o=>a.value.noticeshenhe=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"名称",prop:"name"},{default:n(()=>[e(c,{modelValue:a.value.name,"onUpdate:modelValue":l[14]||(l[14]=o=>a.value.name=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知创建日期",prop:"noticebuilddate"},{default:n(()=>[e(M,{modelValue:a.value.noticebuilddate,"onUpdate:modelValue":l[15]||(l[15]=o=>a.value.noticebuilddate=o),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}},ce=H(me,[["__scopeId","data-v-0b2190a4"]]),ge={class:"querentongzhi-management"},ve={class:"action-bar"},be={class:"pagination-container"},fe={__name:"querentongzhi",setup(K){const p=P({noticeid:"",noticename:"",pageNumber:1,pageSize:10}),f=v([]),N=v(0),S=v(!1);X();const V=v(!1),a=v(""),_=v(!1),k=v(""),$=v(""),C=v(""),D=v(""),B=(i,t,o)=>({10:"录入",20:"确认",30:"通过校验",40:"通过审核"})[o]||o,q=(i,t,o)=>{if(!o)return"";const y=new Date(o),T=y.getFullYear(),b=String(y.getMonth()+1).padStart(2,"0"),Y=String(y.getDate()).padStart(2,"0");return`${T}-${b}-${Y}`},r=async()=>{S.value=!0;try{const i={...p};console.log("请求参数:",i);const t=await ie(i);console.log("后端返回数据:",t),t.success?(f.value=t.data.page.list,N.value=t.data.page.totalRow,console.log("通知列表:",f.value),console.log("总记录数:",N.value)):d.error(t.msg||"获取通知列表失败")}catch(i){console.error("获取通知列表失败:",i),d.error("获取通知列表失败")}finally{S.value=!1}},l=i=>{p.pageSize=i,p.pageNumber=1,console.log("分页大小变更:",p.pageSize),r()},s=i=>{p.pageNumber=i,console.log("当前页变更:",p.pageNumber),r()},z=()=>{p.noticeid="",p.noticename="",p.pageNumber=1,r()},U=i=>{a.value=i.noticeid,A(()=>{V.value=!0})},c=()=>{V.value=!1,a.value=""},m=async i=>{if(!i.noticeid){d.error("通知ID不能为空，请刷新页面重试");return}if(i.noticestatus!==10){d.warning('只有状态为"录入"的通知才能进行确认操作');return}G.confirm(`你确定要确认通知吗？通知ID：${i.noticeid}`,"确认通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{localStorage.getItem("realName");const t={noticeid:i.noticeid};console.log("确认通知请求参数:",t);try{const o=await re(t);o.success?(d.success(o.msg),r()):d.error(o.msg)}catch(o){console.error("确认通知失败:",o),d.error("确认通知失败")}}).catch(()=>{d.info("已取消操作")})},I=async i=>{if(!i.noticeid){d.error("通知ID不能为空，请刷新页面重试");return}if(i.noticestatus!==20){d.warning('只有状态为"确认"的通知才能进行反确认操作');return}G.confirm(`你确定要反确认通知吗？通知ID：${i.noticeid}`,"反确认通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await ue({noticeid:i.noticeid});t.success?(d.success(t.msg),r()):d.error(t.msg)}catch(t){console.error("反确认通知失败:",t),d.error("反确认通知失败")}}).catch(()=>{d.info("已取消操作")})},M=i=>{k.value=i.noticeid,C.value=i.contractno,D.value=i.contractname,A(()=>{_.value=!0})},h=()=>{_.value=!1,k.value="",$.value="",C.value="",D.value=""};return Z(()=>{r()}),(i,t)=>{const o=g("el-input"),y=g("el-button"),T=g("el-icon"),b=g("el-table-column"),Y=g("el-table"),O=g("el-pagination"),j=g("el-dialog"),W=ee("loading");return x(),J("div",ge,[E("div",ve,[e(o,{modelValue:p.noticeid,"onUpdate:modelValue":t[0]||(t[0]=u=>p.noticeid=u),placeholder:"请输入通知ID搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:t[1]||(t[1]=u=>r()),onKeyup:t[2]||(t[2]=L(u=>r(),["enter"]))},null,8,["modelValue"]),e(o,{modelValue:p.noticename,"onUpdate:modelValue":t[3]||(t[3]=u=>p.noticename=u),placeholder:"请输入通知名称搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:t[4]||(t[4]=u=>r()),onKeyup:t[5]||(t[5]=L(u=>r(),["enter"]))},null,8,["modelValue"]),e(y,{type:"primary",onClick:t[6]||(t[6]=u=>r())},{default:n(()=>t[11]||(t[11]=[w("搜索")])),_:1}),e(y,{type:"warning",onClick:z},{default:n(()=>[e(T,null,{default:n(()=>[e(te(oe))]),_:1}),t[12]||(t[12]=w(" 刷新 "))]),_:1})]),le((x(),F(Y,{data:f.value,border:"",style:{width:"100%"}},{default:n(()=>[e(b,{type:"index",label:"序号",width:"80"}),e(b,{prop:"noticeid",label:"通知编号"}),e(b,{prop:"noticename",label:"通知名称"}),e(b,{prop:"noticedeliver",label:"通知校验人"}),e(b,{prop:"noticeshenhe",label:"通知审核人"}),e(b,{prop:"noticeauther",label:"通知作者"}),e(b,{prop:"noticestatus",label:"通知状态",formatter:B}),e(b,{prop:"contractno",label:"合同编号"}),e(b,{prop:"contractname",label:"合同名称"}),e(b,{prop:"noticebuilddate",label:"通知创建日期",formatter:q}),e(b,{label:"操作",width:"420"},{default:n(({row:u})=>[e(y,{type:"success",size:"small",onClick:R=>m(u),disabled:u.noticestatus!==10},{default:n(()=>t[13]||(t[13]=[w("确认通知")])),_:2},1032,["onClick","disabled"]),e(y,{type:"danger",size:"small",onClick:R=>I(u),disabled:u.noticestatus!==20},{default:n(()=>t[14]||(t[14]=[w("反确认通知")])),_:2},1032,["onClick","disabled"]),e(y,{type:"primary",size:"small",onClick:R=>U(u)},{default:n(()=>t[15]||(t[15]=[w("查看通知")])),_:2},1032,["onClick"]),e(y,{type:"info",size:"small",onClick:R=>M(u),disabled:u.noticestatus===10},{default:n(()=>t[16]||(t[16]=[w("查看备料计划")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[W,S.value]]),E("div",be,[e(O,{"current-page":p.pageNumber,"onUpdate:currentPage":t[7]||(t[7]=u=>p.pageNumber=u),"page-size":p.pageSize,"onUpdate:pageSize":t[8]||(t[8]=u=>p.pageSize=u),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:l,onCurrentChange:s},null,8,["current-page","page-size","total"])]),e(j,{modelValue:V.value,"onUpdate:modelValue":t[9]||(t[9]=u=>V.value=u),title:"查看通知详情",width:"80%",top:"5vh","destroy-on-close":"","before-close":c,"append-to-body":"","modal-append-to-body":!0},{default:n(()=>[V.value?(x(),F(ce,{key:0,noticeid:a.value,visible:V.value,onClose:c},null,8,["noticeid","visible"])):Q("",!0)]),_:1},8,["modelValue"]),e(j,{modelValue:_.value,"onUpdate:modelValue":t[10]||(t[10]=u=>_.value=u),title:"查看备料计划",width:"90%",top:"5vh","destroy-on-close":"","before-close":h,"append-to-body":"","modal-append-to-body":!0},{default:n(()=>[_.value?(x(),F(se,{key:0,noticeid:k.value,noticedrawno:$.value,contractno:C.value,contractname:D.value,visible:_.value,onClose:h},null,8,["noticeid","noticedrawno","contractno","contractname","visible"])):Q("",!0)]),_:1},8,["modelValue"])])}}},we=H(fe,[["__scopeId","data-v-d3579d5c"]]);export{we as default};
