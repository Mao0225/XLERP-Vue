import{_ as se,r as y,v as X,g as Z,E as C,h as r,G as ce,o as U,l as H,w as t,a as b,b as e,e as te,i as v,H as fe,q as A,k as ae,c as oe,F as Ce,m as Ne,x as _e,a5 as Fe,f as Te,s as he,p as ue,B as je,a6 as Me,A as pe}from"./index-Bwbtb0V1.js";import{g as Ee,i as Ke,a as He,u as Oe,c as Ye,d as Ae,b as Ge,e as We,f as Je,h as Qe,j as we}from"./bascontract-KulZMAIs.js";import{g as Xe}from"./basitem-BEdq12hI.js";import{g as Ze}from"./hruser-z31-AUu4.js";import{g as et}from"./basorg-D9Q4sOwh.js";import{u as ke}from"./term-BqpDPAMp.js";const tt={class:"search-bar"},lt={class:"pagination-container"},at={__name:"ProductSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup($,{emit:E}){const j=$,w=E,h=y(!1);X(()=>j.modelValue,s=>{h.value=s,s&&c()}),X(h,s=>{w("update:modelValue",s)});const _=Z({itemNo:"",itemName:""}),p=Z({pageNumber:1,pageSize:10,itemNo:"",itemName:""}),V=y([]),K=y(0),k=y(!1),c=async()=>{k.value=!0;try{p.itemNo=_.itemNo,p.itemName=_.itemName;const s=await Xe(p);V.value=s.data.page.list,K.value=s.data.page.totalRow}catch(s){C.error("获取产品列表失败: "+s.message)}finally{k.value=!1}},N=()=>{p.pageNumber=1,c()},I=()=>{_.itemNo="",_.itemName="",p.pageNumber=1,c()},D=s=>{p.pageSize=s,p.pageNumber=1,c()},G=s=>{p.pageNumber=s,c()},O=s=>{R(s)},R=s=>{w("select",s),h.value=!1},Y=()=>{_.itemNo="",_.itemName="",p.pageNumber=1};return(s,u)=>{const P=r("el-input"),B=r("el-col"),z=r("el-button"),a=r("el-row"),o=r("el-table-column"),L=r("el-table"),q=r("el-pagination"),Q=r("el-dialog"),x=ce("loading");return U(),H(Q,{title:"选择产品",modelValue:h.value,"onUpdate:modelValue":u[4]||(u[4]=g=>h.value=g),width:"80%",onClosed:Y},{default:t(()=>[b("div",tt,[e(a,{gutter:20},{default:t(()=>[e(B,{span:8},{default:t(()=>[e(P,{modelValue:_.itemNo,"onUpdate:modelValue":u[0]||(u[0]=g=>_.itemNo=g),placeholder:"请输入产品编号",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{span:8},{default:t(()=>[e(P,{modelValue:_.itemName,"onUpdate:modelValue":u[1]||(u[1]=g=>_.itemName=g),placeholder:"请输入产品名称",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{span:8},{default:t(()=>[e(z,{type:"primary",onClick:N},{default:t(()=>u[5]||(u[5]=[v("搜索")])),_:1}),e(z,{onClick:I},{default:t(()=>u[6]||(u[6]=[v("重置")])),_:1})]),_:1})]),_:1})]),fe((U(),H(L,{data:V.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:O},{default:t(()=>[e(o,{prop:"no",label:"产品编号",width:"120"}),e(o,{prop:"name",label:"产品名称"}),e(o,{prop:"spec",label:"规格型号"}),e(o,{prop:"unit",label:"单位",width:"80"}),e(o,{prop:"planned_price",label:"单价",width:"100"},{default:t(({row:g})=>[v(" ¥"+A(g.planned_price.toFixed(2)),1)]),_:1}),e(o,{prop:"weight",label:"单重",width:"80"}),e(o,{label:"操作",width:"100"},{default:t(({row:g})=>[e(z,{type:"primary",size:"small",onClick:le=>R(g)},{default:t(()=>u[7]||(u[7]=[v(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,k.value]]),b("div",lt,[e(q,{"current-page":p.pageNumber,"onUpdate:currentPage":u[2]||(u[2]=g=>p.pageNumber=g),"page-size":p.pageSize,"onUpdate:pageSize":u[3]||(u[3]=g=>p.pageSize=g),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:K.value,onSizeChange:D,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},ot=se(at,[["__scopeId","data-v-480aed08"]]),nt={class:"search-bar"},st={class:"pagination-container"},dt={__name:"SalesmanSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup($,{emit:E}){const j=$,w=E,h=y(!1);X(()=>j.modelValue,s=>{h.value=s,s&&c()}),X(h,s=>{w("update:modelValue",s)});const _=Z({name:"",no:""}),p=Z({pageNumber:1,pageSize:10,name:"",no:""}),V=y([]),K=y(0),k=y(!1),c=async()=>{k.value=!0;try{p.name=_.name,p.no=_.no;const s=await Ze(p);V.value=s.data.page.list,K.value=s.data.page.totalRow}catch(s){C.error("获取销售员列表失败: "+s.message)}finally{k.value=!1}},N=()=>{p.pageNumber=1,c()},I=()=>{_.name="",_.no="",p.pageNumber=1,c()},D=s=>{p.pageSize=s,p.pageNumber=1,c()},G=s=>{p.pageNumber=s,c()},O=s=>{s.status===1&&R(s)},R=s=>{w("select",s),h.value=!1},Y=()=>{_.name="",_.no="",p.pageNumber=1};return(s,u)=>{const P=r("el-input"),B=r("el-col"),z=r("el-button"),a=r("el-row"),o=r("el-table-column"),L=r("el-table"),q=r("el-pagination"),Q=r("el-dialog"),x=ce("loading");return U(),H(Q,{title:"选择销售员",modelValue:h.value,"onUpdate:modelValue":u[4]||(u[4]=g=>h.value=g),width:"60%",onClosed:Y},{default:t(()=>[b("div",nt,[e(a,{gutter:20},{default:t(()=>[e(B,{span:8},{default:t(()=>[e(P,{modelValue:_.name,"onUpdate:modelValue":u[0]||(u[0]=g=>_.name=g),placeholder:"请输入销售员姓名",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{span:8},{default:t(()=>[e(P,{modelValue:_.no,"onUpdate:modelValue":u[1]||(u[1]=g=>_.no=g),placeholder:"请输入编号",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{span:8},{default:t(()=>[e(z,{type:"primary",onClick:N},{default:t(()=>u[5]||(u[5]=[v("搜索")])),_:1}),e(z,{onClick:I},{default:t(()=>u[6]||(u[6]=[v("重置")])),_:1})]),_:1})]),_:1})]),fe((U(),H(L,{data:V.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:O},{default:t(()=>[e(o,{prop:"no",label:"编号",width:"80"}),e(o,{prop:"name",label:"姓名"}),e(o,{prop:"department",label:"部门"}),e(o,{prop:"sex",label:"性别"}),e(o,{label:"操作",width:"100"},{default:t(({row:g})=>[e(z,{type:"primary",size:"small",onClick:le=>R(g)},{default:t(()=>u[7]||(u[7]=[v(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,k.value]]),b("div",st,[e(q,{"current-page":p.pageNumber,"onUpdate:currentPage":u[2]||(u[2]=g=>p.pageNumber=g),"page-size":p.pageSize,"onUpdate:pageSize":u[3]||(u[3]=g=>p.pageSize=g),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:K.value,onSizeChange:D,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},ut=se(dt,[["__scopeId","data-v-060c8bc6"]]),rt={class:"search-bar"},it={class:"pagination-container"},mt={__name:"CustomerSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup($,{emit:E}){const j=$,w=E,h=y(!1);X(()=>j.modelValue,s=>{h.value=s,s&&c()}),X(h,s=>{w("update:modelValue",s)});const _=Z({no:"",descr:""}),p=Z({pageNumber:1,pageSize:10,no:"",descr:""}),V=y([]),K=y(0),k=y(!1),c=async()=>{k.value=!0;try{p.descr=_.descr,p.no=_.no;const s=await et(p);V.value=s.data.page.list,K.value=s.data.page.totalRow}catch(s){C.error("获取客户列表失败: "+s.message)}finally{k.value=!1}},N=()=>{p.pageNumber=1,c()},I=()=>{_.descr="",_.no="",p.pageNumber=1,c()},D=s=>{p.pageSize=s,p.pageNumber=1,c()},G=s=>{p.pageNumber=s,c()},O=s=>{s.status===1&&R(s)},R=s=>{w("select",s),h.value=!1},Y=()=>{I()};return(s,u)=>{const P=r("el-input"),B=r("el-col"),z=r("el-button"),a=r("el-row"),o=r("el-table-column"),L=r("el-table"),q=r("el-pagination"),Q=r("el-dialog"),x=ce("loading");return U(),H(Q,{title:"选择客户",modelValue:h.value,"onUpdate:modelValue":u[4]||(u[4]=g=>h.value=g),width:"70%",onClosed:Y},{default:t(()=>[b("div",rt,[e(a,{gutter:20},{default:t(()=>[e(B,{span:6},{default:t(()=>[e(P,{modelValue:_.descr,"onUpdate:modelValue":u[0]||(u[0]=g=>_.descr=g),placeholder:"请输入客户名称",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{span:6},{default:t(()=>[e(P,{modelValue:_.no,"onUpdate:modelValue":u[1]||(u[1]=g=>_.no=g),placeholder:"请输入客户编号",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{span:6},{default:t(()=>[e(z,{type:"primary",onClick:N},{default:t(()=>u[5]||(u[5]=[v("搜索")])),_:1}),e(z,{onClick:I},{default:t(()=>u[6]||(u[6]=[v("重置")])),_:1})]),_:1})]),_:1})]),fe((U(),H(L,{data:V.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:O},{default:t(()=>[e(o,{prop:"no",label:"编号",width:"100"}),e(o,{prop:"descr",label:"客户名称"}),e(o,{prop:"contactname",label:"联系人",width:"100"}),e(o,{prop:"phone",label:"联系电话",width:"130"}),e(o,{prop:"province",label:"所在省份"}),e(o,{label:"操作",width:"100"},{default:t(({row:g})=>[e(z,{type:"primary",size:"small",onClick:le=>R(g)},{default:t(()=>u[7]||(u[7]=[v(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,k.value]]),b("div",it,[e(q,{"current-page":p.pageNumber,"onUpdate:currentPage":u[2]||(u[2]=g=>p.pageNumber=g),"page-size":p.pageSize,"onUpdate:pageSize":u[3]||(u[3]=g=>p.pageSize=g),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:K.value,onSizeChange:D,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},pt=se(mt,[["__scopeId","data-v-501560e6"]]),ct={class:"import-result"},ft={class:"result-summary"},gt={class:"stat-item"},_t={class:"stat-value"},bt={class:"stat-item success"},vt={class:"stat-value"},Vt={class:"stat-item error"},yt={class:"stat-value"},wt={class:"stat-item"},Ct={class:"stat-value"},Nt={key:0,class:"failed-details"},ht={class:"failed-list"},kt={class:"error-message"},St={class:"export-actions"},xt={key:1,class:"no-failed"},Ut={class:"dialog-footer"},It={__name:"ImportResultDialog",props:{modelValue:{type:Boolean,default:!1},importData:{type:Object,default:()=>({})}},emits:["update:modelValue","confirm"],setup($,{emit:E}){const j=$,w=E,h=ae({get:()=>j.modelValue,set:k=>w("update:modelValue",k)}),_=ae(()=>{const k=j.importData.totalRows||0,c=j.importData.successCount||0;return k>0?Math.round(c/k*100):0}),p=()=>{const c=["行号,错误信息",...(j.importData.failedRows||[]).map(D=>`${D.rowNumber},"${D.error}"`)].join(`
`),N=new Blob([c],{type:"text/csv;charset=utf-8;"}),I=document.createElement("a");I.href=URL.createObjectURL(N),I.download=`导入失败数据_${new Date().toISOString().slice(0,10)}.csv`,I.click()},V=()=>{h.value=!1},K=()=>{w("confirm"),h.value=!1};return(k,c)=>{const N=r("el-col"),I=r("el-row"),D=r("el-tag"),G=r("el-scrollbar"),O=r("el-icon"),R=r("el-button"),Y=r("el-result"),s=r("el-dialog");return U(),H(s,{modelValue:h.value,"onUpdate:modelValue":c[0]||(c[0]=u=>h.value=u),title:"导入结果",width:"600px","close-on-click-modal":!1,onClosed:V},{footer:t(()=>[b("span",Ut,[e(R,{type:"primary",onClick:K},{default:t(()=>c[7]||(c[7]=[v("确定")])),_:1})])]),default:t(()=>[b("div",ct,[b("div",ft,[e(I,{gutter:20},{default:t(()=>[e(N,{span:6},{default:t(()=>[b("div",gt,[b("div",_t,A($.importData.totalRows||0),1),c[1]||(c[1]=b("div",{class:"stat-label"},"导入总数",-1))])]),_:1}),e(N,{span:6},{default:t(()=>[b("div",bt,[b("div",vt,A($.importData.successCount||0),1),c[2]||(c[2]=b("div",{class:"stat-label"},"成功导入",-1))])]),_:1}),e(N,{span:6},{default:t(()=>[b("div",Vt,[b("div",yt,A($.importData.failedCount||0),1),c[3]||(c[3]=b("div",{class:"stat-label"},"失败数量",-1))])]),_:1}),e(N,{span:6},{default:t(()=>[b("div",wt,[b("div",Ct,A(_.value)+"%",1),c[4]||(c[4]=b("div",{class:"stat-label"},"成功率",-1))])]),_:1})]),_:1})]),$.importData.failedRows&&$.importData.failedRows.length>0?(U(),oe("div",Nt,[c[6]||(c[6]=b("h4",null,"失败详情：",-1)),b("div",ht,[e(G,{"max-height":"300px"},{default:t(()=>[(U(!0),oe(Ce,null,Ne($.importData.failedRows,(u,P)=>(U(),oe("div",{key:P,class:"failed-item"},[e(D,{type:"danger",size:"small"},{default:t(()=>[v("第 "+A(u.rowNumber)+" 行",1)]),_:2},1024),b("span",kt,A(u.error),1)]))),128))]),_:1})]),b("div",St,[e(R,{size:"small",onClick:p},{default:t(()=>[e(O,null,{default:t(()=>[e(_e(Fe))]),_:1}),c[5]||(c[5]=v(" 导出失败数据 "))]),_:1})])])):(U(),oe("div",xt,[e(Y,{icon:"success",title:"导入成功","sub-title":"所有数据都已成功导入"})]))])]),_:1},8,["modelValue"])}}},zt=se(It,[["__scopeId","data-v-8de0f6c2"]]),Rt={class:"contract-form"},$t={style:{display:"flex","justify-content":"center"}},Dt={class:"card-header"},Pt={class:"summary-info"},Bt={class:"summary-info"},Lt={style:{margin:"0 20px"}},qt={__name:"ContractForm",props:{contractNo:{type:String,default:""}},emits:["close"],setup($,{emit:E}){const j=ke(),w=j.term,h=j.terms;console.log("当前区间为就是iscurrent为1的区间",w);const _=Te(),p=ae(()=>_.userId);console.log("userId",p.value);const V=$,K=E,k=y(!1),c=ae(()=>!!V.contractNo),N=y(!1),I=y(-1),D=y(null),G=y(null),O=y(!1),R=y(!1),Y=y(!1),s=y(!1),u=y(!1),P=y(!1),B=y({}),z=y(!1),a=Z({no:"",userid:"",ecpno:"",equipno:"",purchaserHqCode:"",supplierCode:"1000014491",supplierName:"中国电建集团四平线路器材有限公司",term:w,salesmanid:null,salesmanName:"",agent:"",other:`提出异议期限：
结算方式及付款期限：
备品、配件、工具供应办法：
违约责任：
因本合同发生纠纷调解不成是，应在（）人民法院进行诉讼
其他违约事项：`,casingcost:1,transcost:1,destination:"",bank:"",checktype:"",postalcode:"",fax:"",bankcode:"",pressurestage:0,receiver:"",transtype:"",picktype:"",telephone:"",itemsenddate:"",contractSum:0,name:"",customerid:null,customerName:"",legalrepresent:"",taxnum:"",signdate:"",status:10,memo:""});console.log("表格区间",a.term);const o=Z({id:void 0,no:null,poItemId:null,poItemCode:null,poItemNo:null,itemid:null,itemNo:"",itemName:"",itemSpec:"",itemnum:1,itemunit:"个",itemprice:0,itemweight:0,itemmemo:"",itemgrossweight:0,itemsum:0,itemRealPrice:0,itemRealSum:0}),L=y([]),q=(i,l=null)=>L.value.reduce((f,d)=>{const m=d[i]??(l?d[l]:0);return f+(Number(m)||0)},0),Q=ae(()=>q("itemsum")),x=ae(()=>q("itemgrossweight")),g={no:[{required:!0,message:"请输入合同号",trigger:"blur"}],gridno:[{required:!0,message:"请输入电网编号",trigger:"blur"}],name:[{required:!0,message:"请输入工程名称",trigger:"blur"}],salesmanid:[{required:!0,message:"请选择销售员",trigger:"change"}],customerid:[{required:!0,message:"请选择客户",trigger:"change"}],signdate:[{required:!0,message:"请选择签定时间",trigger:"change"}],term:[{required:!0,message:"请选择合同所属期间",trigger:"change"}]},le=async()=>{if(V.contractNo)try{const i=await Ee({contractNo:V.contractNo}),{contractInfo:l,itemList:f}=i.data;Object.assign(a,l||{}),a.status>10&&(z.value=!0),L.value=f||[]}catch{C.error("加载合同数据失败")}finally{k.value=!0}},re=()=>{R.value=!0},ge=i=>{a.salesmanid=i.id,a.salesmanName=i.name},ie=()=>{Y.value=!0},S=i=>{a.customerid=i.id,a.customerName=i.descr,a.fax=i.fax,a.telephone=i.phone,a.postalcode=i.postalcode,a.bank=i.bank,a.bankcode=i.bankcode,a.taxnum=i.taxcode},ee=()=>{const i=document.createElement("input");i.type="file",i.accept=".xls,.xlsx",i.style.display="none",i.addEventListener("change",async l=>{const f=l.target.files[0];if(!f){C.error("未选择文件");return}if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(f.type)&&!f.name.match(/\.(xls|xlsx)$/)){C.error("请选择 Excel 文件 (.xls 或 .xlsx)");return}const m=new FormData;m.append("itemListFile",f);const M=a.no;console.log("导入合同号",M),m.append("contractNo",M);try{const W=await Ke(m);W.code===200&&W.data?(Se(W.data),C.success(`文件导入完成，总计 ${W.data.totalRows} 条，成功 ${W.data.successCount} 条`)):C.error("导入失败："+(W.msg||"未知错误"))}catch(W){console.error("导入错误",W),C.error("导入物料失败")}finally{document.body.removeChild(i)}}),document.body.appendChild(i),i.click()},Se=i=>{B.value=i,P.value=!0},xe=()=>{le()},Ue=()=>{try{const i=`${je}/xlsxTemplates/物料导入示例模板.xlsx`;window.open(i,"_blank")}catch(i){console.error("下载模板失败:",i),C({message:"下载模板失败，请检查网络或联系管理员",type:"error",duration:5*1e3})}},Ie=()=>{N.value=!1,I.value=-1,Object.assign(o,{id:void 0,no:a.no,poItemId:null,poItemCode:null,poItemNo:null,itemid:null,itemNo:"",itemName:"",itemSpec:"",itemnum:1,itemunit:"个",itemprice:0,itemweight:0,itemmemo:"",itemgrossweight:0,itemsum:0,itemRealPrice:0,itemRealSum:0}),s.value=!0},ze=async(i,l)=>{try{const f=await He({itemId:l.id});if(f.success){const{item:d}=f.data;Object.assign(o,{id:d.id,no:d.no,poItemNo:d.poItemNo||"",poItemId:d.poItemId||"",poItemCode:d.poItemCode||"",itemid:d.itemid,itemNo:d.itemNo||"",itemName:d.itemName||"",itemSpec:d.itemSpec||"",itemnum:d.itemnum||1,itemunit:d.itemunit||"个",itemprice:d.itemprice||0,itemweight:d.itemweight||0,itemmemo:d.itemmemo||"",itemgrossweight:d.itemgrossweight||0,itemsum:d.itemsum||0,itemRealPrice:d.itemRealPrice||0,itemRealSum:d.itemRealSum||0}),N.value=!0,I.value=i,s.value=!0}else C.error("获取产品信息失败")}catch{C.error("获取产品信息失败")}},be=()=>{O.value=!0},Re=i=>{Object.assign(o,{itemid:i.id,itemNo:i.no,itemName:i.name,itemSpec:i.spec||"",itemunit:i.unit||"个",itemprice:i.planned_price||0,itemweight:i.weight||0}),ne()},$e=async()=>{if(!o.itemid){C.warning("请选择产品");return}if(!o.itemnum||o.itemnum<=0){C.warning("请输入正确的数量");return}u.value=!0;try{const i={...o};if(N.value)await Oe(i),L.value[I.value]={...i},C.success("产品更新成功");else{const l=await Ye(i);L.value.push({id:l.data.itemId,poItemNo:o.poItemNo,poItemId:o.poItemId,poItemCode:o.poItemCode,itemid:o.itemid,itemNo:o.itemNo,itemName:o.itemName,itemSpec:o.itemSpec,itemnum:o.itemnum,itemunit:o.itemunit,itemprice:o.itemprice,itemsum:o.itemsum,itemweight:o.itemweight,itemgrossweight:o.itemgrossweight,itemRealPrice:o.itemRealPrice,itemRealSum:o.itemRealSum,itemmemo:o.itemmemo}),C.success("产品添加成功")}s.value=!1}catch{C.error(N.value?"更新产品失败":"添加产品失败")}finally{u.value=!1}},De=async(i,l)=>{if(l.id)try{await Ae({itemId:l.id}),C.success("产品删除成功"),L.value.splice(i,1)}catch{C.error("产品删除失败")}else L.value.splice(i,1)},Pe=()=>{D.value&&D.value.validate(async i=>{if(i)try{const l={...a};if(c.value)await Ge(l),C.success("修改成功");else{if(l.userid=p.value,l.status=10,!l.userid){C.error("请选择客户");return}if(!l.term){C.error("请选择区间");return}await We(l),console.log("提交表单数据:",l),C.success("新增成功"),K("close")}}catch{C.error("保存合同失败")}})},ne=()=>{o.itemgrossweight=(o.itemnum*o.itemweight).toFixed(2),o.itemsum=(o.itemnum*o.itemprice).toFixed(2),o.itemRealSum=(o.itemnum*o.itemRealPrice).toFixed(2)};return X(()=>V.contractNo,i=>{i?le():k.value=!0},{immediate:!0}),X(()=>[o.itemnum,o.itemprice,o.itemweight],()=>{ne()}),he(()=>{V.contractNo||(k.value=!0)}),(i,l)=>{const f=r("el-input"),d=r("el-form-item"),m=r("el-col"),M=r("el-row"),W=r("el-date-picker"),J=r("el-button"),F=r("el-option"),de=r("el-select"),ve=r("el-card"),T=r("el-table-column"),Be=r("el-table"),Ve=r("el-form"),me=r("el-input-number"),Le=r("el-dialog");return U(),oe("div",Rt,[k.value?(U(),H(Ve,{key:0,ref_key:"formRef",ref:D,model:a,rules:g,"label-width":"80px",size:"small"},{default:t(()=>[e(ve,{class:"form-card",shadow:"never"},{header:t(()=>l[50]||(l[50]=[b("span",{class:"card-title"},"合同信息",-1)])),default:t(()=>[e(M,{gutter:12},{default:t(()=>[e(m,{span:5},{default:t(()=>[e(d,{label:"器材合同号",prop:"equipno"},{default:t(()=>[e(f,{modelValue:a.equipno,"onUpdate:modelValue":l[0]||(l[0]=n=>a.equipno=n),placeholder:"器材合同号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:5},{default:t(()=>[e(d,{label:"国网经法合同号",prop:"ecpno","label-width":"100px"},{default:t(()=>[e(f,{modelValue:a.ecpno,"onUpdate:modelValue":l[1]||(l[1]=n=>a.ecpno=n),placeholder:"国网经法合同号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:5},{default:t(()=>[e(d,{label:"采购方总部编码",prop:"purchaserHqCode","label-width":"100px"},{default:t(()=>[e(f,{modelValue:a.purchaserHqCode,"onUpdate:modelValue":l[2]||(l[2]=n=>a.purchaserHqCode=n),placeholder:"采购方总部编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"供应商编码",prop:"supplierCode"},{default:t(()=>[e(f,{modelValue:a.supplierCode,"onUpdate:modelValue":l[3]||(l[3]=n=>a.supplierCode=n),placeholder:"供应商编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(d,{label:"供应商名称",prop:"supplierName"},{default:t(()=>[e(f,{modelValue:a.supplierName,"onUpdate:modelValue":l[4]||(l[4]=n=>a.supplierName=n),placeholder:"供应商名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:12},{default:t(()=>[e(m,{span:4},{default:t(()=>[e(d,{label:"厂内合同号",prop:"no","label-width":"90px"},{default:t(()=>[e(f,{modelValue:a.no,"onUpdate:modelValue":l[5]||(l[5]=n=>a.no=n),placeholder:"合同号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"工程名称",prop:"name"},{default:t(()=>[e(f,{modelValue:a.name,"onUpdate:modelValue":l[6]||(l[6]=n=>a.name=n),placeholder:"工程名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"电网编号",prop:"gridno"},{default:t(()=>[e(f,{modelValue:a.gridno,"onUpdate:modelValue":l[7]||(l[7]=n=>a.gridno=n),modelModifiers:{number:!0},placeholder:"电网编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"签定时间",prop:"signdate"},{default:t(()=>[e(W,{modelValue:a.signdate,"onUpdate:modelValue":l[8]||(l[8]=n=>a.signdate=n),type:"date",placeholder:"签定时间","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"销售员",prop:"salesmanid"},{default:t(()=>[e(f,{modelValue:a.salesmanName,"onUpdate:modelValue":l[9]||(l[9]=n=>a.salesmanName=n),placeholder:"选择销售员",readonly:"",onClick:re},{append:t(()=>[e(J,{onClick:re,size:"small"},{default:t(()=>l[51]||(l[51]=[v("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"客户",prop:"customerid"},{default:t(()=>[e(f,{modelValue:a.customerName,"onUpdate:modelValue":l[10]||(l[10]=n=>a.customerName=n),placeholder:"选择客户",readonly:"",onClick:ie},{append:t(()=>[e(J,{onClick:ie,size:"small"},{default:t(()=>l[52]||(l[52]=[v("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:12},{default:t(()=>[e(m,{span:4},{default:t(()=>[e(d,{label:"客户代理人"},{default:t(()=>[e(f,{modelValue:a.agent,"onUpdate:modelValue":l[11]||(l[11]=n=>a.agent=n),placeholder:"客户代理人"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"法定代表人"},{default:t(()=>[e(f,{modelValue:a.legalrepresent,"onUpdate:modelValue":l[12]||(l[12]=n=>a.legalrepresent=n),placeholder:"法定代表人"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"税务号"},{default:t(()=>[e(f,{modelValue:a.taxnum,"onUpdate:modelValue":l[13]||(l[13]=n=>a.taxnum=n),placeholder:"税务号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"交货时间"},{default:t(()=>[e(W,{modelValue:a.itemsenddate,"onUpdate:modelValue":l[14]||(l[14]=n=>a.itemsenddate=n),type:"date",placeholder:"交货时间","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"到货地点"},{default:t(()=>[e(f,{modelValue:a.destination,"onUpdate:modelValue":l[15]||(l[15]=n=>a.destination=n),placeholder:"到货地点"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:4},{default:t(()=>[e(d,{label:"接货人"},{default:t(()=>[e(f,{modelValue:a.receiver,"onUpdate:modelValue":l[16]||(l[16]=n=>a.receiver=n),placeholder:"接货人"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:12},{default:t(()=>[e(m,{span:3},{default:t(()=>[e(d,{label:"运输方式"},{default:t(()=>[e(de,{modelValue:a.transtype,"onUpdate:modelValue":l[17]||(l[17]=n=>a.transtype=n),placeholder:"运输方式",style:{width:"100%"}},{default:t(()=>[e(F,{label:"汽运",value:"汽运"}),e(F,{label:"铁路",value:"铁路"}),e(F,{label:"空运",value:"空运"}),e(F,{label:"海运",value:"海运"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"交提货方式"},{default:t(()=>[e(de,{modelValue:a.picktype,"onUpdate:modelValue":l[18]||(l[18]=n=>a.picktype=n),placeholder:"交提货方式",style:{width:"100%"}},{default:t(()=>[e(F,{label:"自提",value:"自提"}),e(F,{label:"送货",value:"送货"}),e(F,{label:"物流",value:"物流"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"验收方式"},{default:t(()=>[e(f,{modelValue:a.checktype,"onUpdate:modelValue":l[19]||(l[19]=n=>a.checktype=n),placeholder:"验收方式"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"包装费承担"},{default:t(()=>[e(de,{modelValue:a.casingcost,"onUpdate:modelValue":l[20]||(l[20]=n=>a.casingcost=n),placeholder:"包装费承担",style:{width:"100%"}},{default:t(()=>[e(F,{label:"供方",value:1}),e(F,{label:"需方",value:2}),e(F,{label:"各半",value:3}),e(F,{label:"其他",value:400})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"运费承担"},{default:t(()=>[e(de,{modelValue:a.transcost,"onUpdate:modelValue":l[21]||(l[21]=n=>a.transcost=n),placeholder:"运费承担",style:{width:"100%"}},{default:t(()=>[e(F,{label:"供方",value:1}),e(F,{label:"需方",value:2}),e(F,{label:"各半",value:3}),e(F,{label:"其他",value:400})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"电压等级"},{default:t(()=>[e(f,{modelValue:a.pressurestage,"onUpdate:modelValue":l[22]||(l[22]=n=>a.pressurestage=n),modelModifiers:{number:!0},placeholder:"电压等级(KV)",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"客户电话"},{default:t(()=>[e(f,{modelValue:a.telephone,"onUpdate:modelValue":l[23]||(l[23]=n=>a.telephone=n),placeholder:"客户电话"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(d,{label:"客户传真"},{default:t(()=>[e(f,{modelValue:a.fax,"onUpdate:modelValue":l[24]||(l[24]=n=>a.fax=n),placeholder:"客户传真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:12},{default:t(()=>[e(m,{span:4},{default:t(()=>[e(d,{label:"邮政编码"},{default:t(()=>[e(f,{modelValue:a.postalcode,"onUpdate:modelValue":l[25]||(l[25]=n=>a.postalcode=n),placeholder:"邮政编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:5},{default:t(()=>[e(d,{label:"开户银行"},{default:t(()=>[e(f,{modelValue:a.bank,"onUpdate:modelValue":l[26]||(l[26]=n=>a.bank=n),placeholder:"开户银行"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:5},{default:t(()=>[e(d,{label:"账号"},{default:t(()=>[e(f,{modelValue:a.bankcode,"onUpdate:modelValue":l[27]||(l[27]=n=>a.bankcode=n),placeholder:"账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:5},{default:t(()=>[e(d,{label:"期间"},{default:t(()=>[e(de,{modelValue:a.term,"onUpdate:modelValue":l[28]||(l[28]=n=>a.term=n),placeholder:"选择当前期间",size:"small","allow-create":"",filterable:"",style:{width:"100%"}},{default:t(()=>[(U(!0),oe(Ce,null,Ne(_e(h),n=>(U(),H(F,{key:n.id,label:n.term,value:n.term},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(m,{span:10,style:{"text-align":"center"}},{default:t(()=>[e(d,{label:"其他条款"},{default:t(()=>[e(f,{type:"textarea",rows:7,modelValue:a.other,"onUpdate:modelValue":l[29]||(l[29]=n=>a.other=n),placeholder:"其他条款"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10,style:{"text-align":"center"}},{default:t(()=>[e(d,{label:"备注"},{default:t(()=>[e(f,{type:"textarea",rows:7,modelValue:a.memo,"onUpdate:modelValue":l[30]||(l[30]=n=>a.memo=n),placeholder:"备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),b("div",$t,[e(J,{type:"primary",onClick:Pe,disabled:z.value},{default:t(()=>l[53]||(l[53]=[v("保存合同信息")])),_:1},8,["disabled"])])]),_:1}),c.value?(U(),H(ve,{key:0,class:"form-card",shadow:"never"},{header:t(()=>[b("div",Dt,[b("div",Pt,[l[56]||(l[56]=b("span",{class:"card-title"},"产品信息",-1)),e(J,{type:"warning",size:"small",onClick:ee,disabled:z.value},{default:t(()=>l[54]||(l[54]=[v("导入产品")])),_:1},8,["disabled"]),e(J,{type:"primary",size:"small",onClick:Ue},{default:t(()=>l[55]||(l[55]=[v("下载模板")])),_:1})]),b("div",Bt,[b("span",null,"总金额: ¥"+A(Q.value.toFixed(2)),1),b("span",Lt,"总重量: "+A(x.value.toFixed(2))+"kg",1),e(J,{type:"primary",size:"small",onClick:Ie,disabled:z.value},{default:t(()=>l[57]||(l[57]=[v("添加产品")])),_:1},8,["disabled"])])])]),default:t(()=>[e(Be,{data:L.value,border:"",size:"small",style:{width:"100%"}},{default:t(()=>[e(T,{prop:"itemNo",label:"产品编号",width:"100"}),e(T,{prop:"itemName",label:"产品名称","min-width":"80"}),e(T,{prop:"itemSpec",label:"规格型号","min-width":"80"}),e(T,{prop:"poItemNo",label:"采购行项目号",width:"100"}),e(T,{prop:"poItemId",label:"采购行项目ID","min-width":"80"}),e(T,{prop:"poItemCode",label:"国网物料编码","min-width":"80"}),e(T,{prop:"itemnum",label:"数量","min-width":"80"}),e(T,{prop:"itemunit",label:"单位","min-width":"80"}),e(T,{prop:"itemprice",label:"计划单价","min-width":"80"}),e(T,{prop:"itemsum",label:"计划总金额","min-width":"80"}),e(T,{prop:"itemRealPrice",label:"销售单价","min-width":"80"}),e(T,{prop:"itemRealSum",label:"销售总金额","min-width":"80"}),e(T,{prop:"itemweight",label:"单重(kg)","min-width":"80"}),e(T,{prop:"itemgrossweight",label:"总重(kg)","min-width":"80"}),e(T,{prop:"itemmemo",label:"备注","min-width":"80"}),e(T,{label:"操作",width:"150"},{default:t(({row:n,$index:ye})=>[e(J,{type:"primary",size:"small",onClick:qe=>ze(ye,n),disabled:z.value},{default:t(()=>l[58]||(l[58]=[v("编辑")])),_:2},1032,["onClick","disabled"]),e(J,{type:"danger",size:"small",onClick:qe=>De(ye,n),disabled:z.value},{default:t(()=>l[59]||(l[59]=[v("删除")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})):ue("",!0)]),_:1},8,["model"])):ue("",!0),e(Le,{modelValue:s.value,"onUpdate:modelValue":l[45]||(l[45]=n=>s.value=n),title:N.value?"编辑产品":"添加产品",width:"800px","close-on-click-modal":!1},{footer:t(()=>[e(J,{onClick:l[44]||(l[44]=n=>s.value=!1)},{default:t(()=>l[61]||(l[61]=[v("取消")])),_:1}),e(J,{type:"primary",onClick:$e,loading:u.value},{default:t(()=>[v(A(N.value?"确认修改":"确认添加"),1)]),_:1},8,["loading"])]),default:t(()=>[e(Ve,{ref_key:"productFormRef",ref:G,model:o,rules:g,"label-width":"120px",size:"small"},{default:t(()=>[e(M,{gutter:20},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(d,{label:"产品名称",prop:"itemName"},{default:t(()=>[e(f,{modelValue:o.itemName,"onUpdate:modelValue":l[31]||(l[31]=n=>o.itemName=n),placeholder:"点击选择产品",readonly:"",onClick:be},{append:t(()=>[e(J,{onClick:be},{default:t(()=>l[60]||(l[60]=[v("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10},{default:t(()=>[e(d,{label:"国网物料编码",prop:"poItemCode"},{default:t(()=>[e(f,{modelValue:o.poItemCode,"onUpdate:modelValue":l[32]||(l[32]=n=>o.poItemCode=n),placeholder:"请输入国网物料编码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:20},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(d,{label:"采购行项目号",prop:"poItemNo"},{default:t(()=>[e(f,{modelValue:o.poItemNo,"onUpdate:modelValue":l[33]||(l[33]=n=>o.poItemNo=n),placeholder:"请输入采购行项目号"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10},{default:t(()=>[e(d,{label:"采购行项目ID",prop:"poItemId"},{default:t(()=>[e(f,{modelValue:o.poItemId,"onUpdate:modelValue":l[34]||(l[34]=n=>o.poItemId=n),placeholder:"请输入采购行项目ID"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:20},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(d,{label:"数量",prop:"itemnum"},{default:t(()=>[e(me,{modelValue:o.itemnum,"onUpdate:modelValue":l[35]||(l[35]=n=>o.itemnum=n),min:1,style:{width:"100%"},onChange:ne},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10},{default:t(()=>[e(d,{label:"单位",prop:"itemunit"},{default:t(()=>[e(f,{modelValue:o.itemunit,"onUpdate:modelValue":l[36]||(l[36]=n=>o.itemunit=n),placeholder:"请输入单位"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:20},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(d,{label:"销售单价(¥)",prop:"itemRealPrice"},{default:t(()=>[e(me,{modelValue:o.itemRealPrice,"onUpdate:modelValue":l[37]||(l[37]=n=>o.itemRealPrice=n),min:0,precision:2,style:{width:"100%"},onChange:ne},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10},{default:t(()=>[e(d,{label:"销售总金额(¥)"},{default:t(()=>[e(f,{modelValue:o.itemRealSum,"onUpdate:modelValue":l[38]||(l[38]=n=>o.itemRealSum=n),readonly:"",placeholder:"自动计算"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:20},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(d,{label:"单重(kg)",prop:"itemweight"},{default:t(()=>[e(me,{modelValue:o.itemweight,"onUpdate:modelValue":l[39]||(l[39]=n=>o.itemweight=n),min:0,precision:2,style:{width:"100%"},onChange:ne},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10},{default:t(()=>[e(d,{label:"总重(kg)"},{default:t(()=>[e(f,{modelValue:o.itemgrossweight,"onUpdate:modelValue":l[40]||(l[40]=n=>o.itemgrossweight=n),readonly:"",placeholder:"自动计算"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:20},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(d,{label:"计划单价(¥)",prop:"itemprice"},{default:t(()=>[e(me,{modelValue:o.itemprice,"onUpdate:modelValue":l[41]||(l[41]=n=>o.itemprice=n),min:0,precision:2,style:{width:"100%"},onChange:ne},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:10},{default:t(()=>[e(d,{label:"计划总金额(¥)"},{default:t(()=>[e(f,{modelValue:o.itemsum,"onUpdate:modelValue":l[42]||(l[42]=n=>o.itemsum=n),readonly:"",placeholder:"自动计算"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:20},{default:t(()=>[e(d,{label:"备注"},{default:t(()=>[e(f,{modelValue:o.itemmemo,"onUpdate:modelValue":l[43]||(l[43]=n=>o.itemmemo=n),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(ot,{modelValue:O.value,"onUpdate:modelValue":l[46]||(l[46]=n=>O.value=n),onSelect:Re},null,8,["modelValue"]),e(ut,{modelValue:R.value,"onUpdate:modelValue":l[47]||(l[47]=n=>R.value=n),onSelect:ge},null,8,["modelValue"]),e(pt,{modelValue:Y.value,"onUpdate:modelValue":l[48]||(l[48]=n=>Y.value=n),onSelect:S},null,8,["modelValue"]),e(zt,{modelValue:P.value,"onUpdate:modelValue":l[49]||(l[49]=n=>P.value=n),"import-data":B.value,onConfirm:xe},null,8,["modelValue","import-data"])])}}},Ft=se(qt,[["__scopeId","data-v-486b341b"]]),Tt={class:"contract-management"},jt={class:"action-bar"},Mt={class:"pagination-container"},Et={__name:"contractList",setup($){const E=ke(),j=ae(()=>E.currentTerm),w=Z({pageNumber:1,pageSize:10,term:j.value||"",contractNo:"",projectName:""}),h=y([]),_=y(0),p=y(!1),V=async()=>{p.value=!0;try{console.log("getContractListData: queryParams",w);const a=await Je(w);h.value=a.data.page.list,_.value=a.data.page.totalRow}catch(a){console.error("获取合同列表失败",a),C.error("获取合同列表失败")}finally{p.value=!1}};X(()=>E.currentTerm,a=>{console.log("watch: currentTerm changed",a),w.term=a||"",V()},{immediate:!0});const K=a=>{w.pageSize=a,V()},k=a=>{w.pageNumber=a,V()},c=y(!1),N=y(""),I=y(!1),D=()=>{I.value=!1,N.value="",c.value=!0},G=a=>{I.value=!0,N.value=a.no,c.value=!0},O=(a=!1)=>{c.value=!1,V()},R=a=>{pe.confirm(`确认删除合同"${a.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Qe({contractId:a.id}),C.success("删除成功"),V()}catch(o){console.error("删除合同失败",o),C.error("删除合同失败")}}).catch(()=>{})},Y=a=>{pe.confirm(`确认合同"${a.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await we({contractId:a.id,status:20}),C.success("确认成功"),V()}catch(o){console.error("确认合同失败",o),C.error("确认合同失败")}}).catch(()=>{})},s=a=>{pe.confirm(`反确认合同"${a.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await we({contractId:a.id,status:10}),C.success("反确认成功"),V()}catch(o){console.error("反确认合同失败",o),C.error("反确认合同失败")}}).catch(()=>{})},u=()=>{w.contractNo="",w.projectName="",w.pageNumber=1,V()},P=a=>({10:"info",20:"success",30:"warning",40:"danger",50:"danger",60:"primary"})[a]||"info",B=a=>({10:"录入",20:"确认",30:"下计划",40:"生产中",50:"发货",60:"完成"})[a]||"未知",z=a=>{pe.confirm("确定要关闭吗？未保存的内容可能会丢失","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V(),a()}).catch(()=>{})};return he(()=>{E.terms.length||E.fetchTerms(),V()}),(a,o)=>{const L=r("el-input"),q=r("el-button"),Q=r("el-icon"),x=r("el-table-column"),g=r("el-tag"),le=r("el-table"),re=r("el-dialog"),ge=r("el-pagination"),ie=ce("loading");return U(),oe("div",Tt,[b("div",jt,[e(L,{modelValue:w.contractNo,"onUpdate:modelValue":o[0]||(o[0]=S=>w.contractNo=S),placeholder:"请输入合同编号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:V,onKeyup:te(V,["enter"])},null,8,["modelValue"]),e(L,{modelValue:w.projectName,"onUpdate:modelValue":o[1]||(o[1]=S=>w.projectName=S),placeholder:"请输入合同名称查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:V,onKeyup:te(V,["enter"])},null,8,["modelValue"]),e(q,{type:"primary",onClick:V},{default:t(()=>o[5]||(o[5]=[v("搜索")])),_:1}),e(q,{type:"warning",onClick:u},{default:t(()=>[e(Q,null,{default:t(()=>[e(_e(Me))]),_:1}),o[6]||(o[6]=v(" 刷新 "))]),_:1}),e(q,{type:"primary",style:{"margin-left":"auto"},onClick:D},{default:t(()=>o[7]||(o[7]=[v("新增合同")])),_:1})]),fe((U(),H(le,{data:h.value,border:"",style:{width:"100%"}},{default:t(()=>[e(x,{type:"index",label:"序号",width:"80"}),e(x,{prop:"no",label:"厂内合同号",width:"120"}),e(x,{prop:"gridno",label:"电网编号",width:"120"}),e(x,{prop:"ecpno",label:"国网经法合同号",width:"120"}),e(x,{prop:"equipno",label:"器材合同号",width:"120"}),e(x,{prop:"name",label:"工程名称"}),e(x,{prop:"salesmanName",label:"销售员",width:"100"}),e(x,{prop:"customerName",label:"客户名称"}),e(x,{prop:"contractSum",label:"合同金额",width:"120"},{default:t(({row:S})=>{var ee;return[v(" ¥"+A(((ee=S.contractSum)==null?void 0:ee.toFixed(2))??"0.00"),1)]}),_:1}),e(x,{prop:"signDate",label:"签定时间",width:"120"}),e(x,{prop:"term",label:"期间",width:"120"}),e(x,{prop:"status",label:"状态",width:"100"},{default:t(({row:S})=>[e(g,{type:P(S.status)},{default:t(()=>[v(A(B(S.status)),1)]),_:2},1032,["type"])]),_:1}),e(x,{label:"操作",width:"250",fixed:"right"},{default:t(({row:S})=>[e(q,{type:"primary",size:"small",onClick:ee=>G(S)},{default:t(()=>o[8]||(o[8]=[v("编辑")])),_:2},1032,["onClick"]),e(q,{type:"danger",size:"small",onClick:ee=>R(S)},{default:t(()=>o[9]||(o[9]=[v("删除")])),_:2},1032,["onClick"]),S.status===10?(U(),H(q,{key:0,type:"success",size:"small",onClick:ee=>Y(S)},{default:t(()=>o[10]||(o[10]=[v(" 确认 ")])),_:2},1032,["onClick"])):ue("",!0),S.status===20?(U(),H(q,{key:1,type:"warning",size:"small",onClick:ee=>s(S)},{default:t(()=>o[11]||(o[11]=[v(" 反确认 ")])),_:2},1032,["onClick"])):ue("",!0)]),_:1})]),_:1},8,["data"])),[[ie,p.value]]),e(re,{modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=S=>c.value=S),title:I.value?"编辑合同":"新增合同",width:"80%",top:"5vh","destroy-on-close":"","before-close":z},{default:t(()=>[c.value?(U(),H(Ft,{key:0,contractNo:N.value,onClose:O},null,8,["contractNo"])):ue("",!0)]),_:1},8,["modelValue","title"]),b("div",Mt,[e(ge,{"current-page":w.pageNumber,"onUpdate:currentPage":o[3]||(o[3]=S=>w.pageNumber=S),"page-size":w.pageSize,"onUpdate:pageSize":o[4]||(o[4]=S=>w.pageSize=S),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:_.value,onSizeChange:K,onCurrentChange:k},null,8,["current-page","page-size","total"])])])}}},Wt=se(Et,[["__scopeId","data-v-ee1ec02a"]]);export{Wt as default};
