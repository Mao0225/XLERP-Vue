import{_ as A,g as Y,r as v,k as P,v as W,s as G,h as m,o as j,c as q,a as t,b as l,w as i,i as S,q as u,F as X,m as ee,af as le,E as B,u as ne,G as te,e as R,x as ae,a6 as oe,H as ie,l as F,p as K,M as Z}from"./index-Bwbtb0V1.js";import{e as se}from"./querentongzhi-BpnJcUgi.js";import{C as re}from"./chakanshenhetongzhi-C46Cx2OL.js";import{a as ue}from"./beiliaodan-2Bn9qyYh.js";const de={class:"beiliaodan-container"},pe={class:"toolbar"},ce={id:"print-area",class:"print-area"},me={class:"print-header"},ge={class:"print-info mt-4"},be={class:"print-info-block"},he={class:"print-value"},ve={class:"print-value"},fe={class:"print-value"},_e={class:"print-value"},ye={class:"print-value"},Ve={class:"print-value"},ze={class:"print-value"},we={class:"print-value"},xe={class:"print-value"},je={class:"print-value"},Ce={class:"print-value"},Se={class:"print-table-container"},Ne={class:"print-table"},$e={class:"print-footer"},ke={class:"print-date"},Ue={__name:"dayinbeiliaodan",props:{noticeid:{type:String,required:!0},noticedrawno:{type:String,required:!0},contractno:{type:String,required:!0},contractname:{type:String,required:!0}},emits:["close"],setup(L,{emit:p}){const f=L,n=Y({noticeid:f.noticeid,noticedrawno:f.noticedrawno,contractno:f.contractno,contractname:f.contractname,pageNumber:1,pageSize:1e4,zhidingriqi:"",tiliaoshijian:"",jiaohuoshijian:"",bianzhiren:"",jiaoyanren:"",shenheren:"",zhidingbumen:""}),_=v([]),z=v(0),C=P(()=>{const r=new Map;return _.value.forEach(e=>{const c=`${e.sxclitemno}-${e.sxclname}-${e.unit}-${e.sxclshuliang}-${e.sxclcaizhi}`;if(r.has(c)){const s=r.get(c);s.sxcltihuoshuliang+=e.sxcltihuoshuliang||0,s.sxclshijishuliang+=parseFloat(e.sxclshijishuliang)||0}else r.set(c,{...e,sxcltihuoshuliang:e.sxcltihuoshuliang||0,sxclshijishuliang:parseFloat(e.sxclshijishuliang)||0})}),Array.from(r.values())}),y=async()=>{let r=null;try{r=le.service({lock:!0,text:"加载数据中...",background:"rgba(0, 0, 0, 0.7)"});const e=await ue(n);if(e.success){if(_.value=e.data.page.list||[],z.value=e.data.page.totalRow||0,_.value.length>0){const c=_.value[0];n.zhidingriqi=c.zhidingriqi||"",n.tiliaoshijian=c.tiliaoshijian||"",n.jiaohuoshijian=c.jiaohuoshijian||"",n.bianzhiren=c.bianzhiren||"",n.jiaoyanren=c.jiaoyanren||"",n.shenheren=c.shenheren||"",n.zhidingbumen=c.zhidingbumen||""}}else B.error(e.msg||"获取备料计划失败")}catch(e){B.error("获取备料计划失败: "+e.message),console.error("获取备料计划失败",e)}finally{r==null||r.close()}},N=r=>{n.pageNumber=r,y()};W(()=>[f.noticeid,f.noticedrawno],r=>{n.noticeid=r[0],n.noticedrawno=r[1],y()},{immediate:!0}),G(()=>{y()});const $=P(()=>{const r=new Date;return`${r.getFullYear()}-${(r.getMonth()+1).toString().padStart(2,"0")}-${r.getDate().toString().padStart(2,"0")}`}),k=()=>{const r={},e=document.querySelectorAll(".el-pagination, .toolbar, .search-form, .el-table");e.forEach(s=>{r[s.id]=s.style.display,s.style.display="none"});const c=document.documentElement.scrollTop||document.body.scrollTop;window.print(),e.forEach(s=>{s.style.display=r[s.id]||""}),window.scrollTo(0,c)};return(r,e)=>{const c=m("el-button"),s=m("el-input"),g=m("el-form-item"),b=m("el-col"),U=m("el-row"),T=m("el-form"),V=m("el-table-column"),M=m("el-table"),D=m("el-pagination");return j(),q("div",de,[t("div",pe,[l(c,{type:"primary",onClick:k},{default:i(()=>e[11]||(e[11]=[S("打印备料单")])),_:1})]),l(T,{model:n,size:"small","label-width":"80px",class:"search-form"},{default:i(()=>[l(U,{gutter:12},{default:i(()=>[l(b,{span:6},{default:i(()=>[l(g,{label:"通知编号"},{default:i(()=>[l(s,{modelValue:n.noticeid,"onUpdate:modelValue":e[0]||(e[0]=a=>n.noticeid=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"图纸编号"},{default:i(()=>[l(s,{modelValue:n.noticedrawno,"onUpdate:modelValue":e[1]||(e[1]=a=>n.noticedrawno=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"合同编号"},{default:i(()=>[l(s,{modelValue:n.contractno,"onUpdate:modelValue":e[2]||(e[2]=a=>n.contractno=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"工程名称"},{default:i(()=>[l(s,{modelValue:n.contractname,"onUpdate:modelValue":e[3]||(e[3]=a=>n.contractname=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:12},{default:i(()=>[l(b,{span:6},{default:i(()=>[l(g,{label:"制定日期"},{default:i(()=>[l(s,{modelValue:n.zhidingriqi,"onUpdate:modelValue":e[4]||(e[4]=a=>n.zhidingriqi=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"提料时间"},{default:i(()=>[l(s,{modelValue:n.tiliaoshijian,"onUpdate:modelValue":e[5]||(e[5]=a=>n.tiliaoshijian=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"交货时间"},{default:i(()=>[l(s,{modelValue:n.jiaohuoshijian,"onUpdate:modelValue":e[6]||(e[6]=a=>n.jiaohuoshijian=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"编制人"},{default:i(()=>[l(s,{modelValue:n.bianzhiren,"onUpdate:modelValue":e[7]||(e[7]=a=>n.bianzhiren=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:12},{default:i(()=>[l(b,{span:6},{default:i(()=>[l(g,{label:"校验人"},{default:i(()=>[l(s,{modelValue:n.jiaoyanren,"onUpdate:modelValue":e[8]||(e[8]=a=>n.jiaoyanren=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"审核人"},{default:i(()=>[l(s,{modelValue:n.shenheren,"onUpdate:modelValue":e[9]||(e[9]=a=>n.shenheren=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:6},{default:i(()=>[l(g,{label:"制定部门"},{default:i(()=>[l(s,{modelValue:n.zhidingbumen,"onUpdate:modelValue":e[10]||(e[10]=a=>n.zhidingbumen=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l(M,{data:C.value,border:"",size:"small",style:{width:"100%"}},{default:i(()=>[l(V,{label:"序号",width:"60"},{default:i(a=>[S(u((n.pageNumber-1)*n.pageSize+a.$index+1),1)]),_:1}),l(V,{prop:"sxclitemno",label:"所需子材料编码"}),l(V,{prop:"sxclname",label:"所需子材料名称"}),l(V,{prop:"unit",label:"单位"}),l(V,{prop:"sxcltihuoshuliang",label:"计划子材料数量"}),l(V,{prop:"sxclshijishuliang",label:"实际备货数量"}),l(V,{prop:"sxclcaizhi",label:"材质"})]),_:1},8,["data"]),l(D,{onCurrentChange:N,"current-page":n.pageNumber,"page-size":n.pageSize,layout:"total, prev, pager, next",total:z.value},null,8,["current-page","page-size","total"]),t("div",ce,[t("div",me,[e[23]||(e[23]=t("h1",{class:"print-title"},"备料单",-1)),t("div",ge,[t("div",be,[e[12]||(e[12]=t("span",{class:"print-label"},"通知编号：",-1)),t("span",he,u(n.noticeid),1),e[13]||(e[13]=t("span",{class:"print-label"},"图纸编号：",-1)),t("span",ve,u(n.noticedrawno),1),e[14]||(e[14]=t("span",{class:"print-label"},"合同编号：",-1)),t("span",fe,u(n.contractno),1),e[15]||(e[15]=t("span",{class:"print-label"},"工程名称：",-1)),t("span",_e,u(n.contractname),1),e[16]||(e[16]=t("span",{class:"print-label"},"制定日期：",-1)),t("span",ye,u(n.zhidingriqi),1),e[17]||(e[17]=t("span",{class:"print-label"},"提料时间：",-1)),t("span",Ve,u(n.tiliaoshijian),1),e[18]||(e[18]=t("span",{class:"print-label"},"交货时间：",-1)),t("span",ze,u(n.jiaohuoshijian),1),e[19]||(e[19]=t("span",{class:"print-label"},"编制人：",-1)),t("span",we,u(n.bianzhiren),1),e[20]||(e[20]=t("span",{class:"print-label"},"校验人：",-1)),t("span",xe,u(n.jiaoyanren),1),e[21]||(e[21]=t("span",{class:"print-label"},"审核人：",-1)),t("span",je,u(n.shenheren),1),e[22]||(e[22]=t("span",{class:"print-label"},"制定部门：",-1)),t("span",Ce,u(n.zhidingbumen||(_.value.length>0?_.value[0].zhidingbumen:"")),1)])])]),t("div",Se,[t("table",Ne,[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",null,"序号"),t("th",null,"所需子材料编码"),t("th",null,"所需子材料名称"),t("th",null,"单位"),t("th",null,"所需材料数量"),t("th",null,"子材料数量"),t("th",null,"实际备货数量"),t("th",null,"材质")])],-1)),t("tbody",null,[(j(!0),q(X,null,ee(C.value,(a,o)=>(j(),q("tr",{key:o},[t("td",null,u(o+1),1),t("td",null,u(a.sxclitemno),1),t("td",null,u(a.sxclname),1),t("td",null,u(a.unit),1),t("td",null,u(a.sxclshuliang),1),t("td",null,u(a.sxcltihuoshuliang),1),t("td",null,u(a.sxclshijishuliang),1),t("td",null,u(a.sxclcaizhi),1)]))),128))])])]),t("div",$e,[t("div",ke,"打印日期："+u($.value),1)])])])}}},De=A(Ue,[["__scopeId","data-v-3887f172"]]),qe={class:"shenhetongzhi-management"},Be={class:"action-bar"},Te={class:"pagination-container"},Me={__name:"tongzhibeiliaodan",setup(L){const p=Y({noticeid:"",noticename:"",pageNumber:1,pageSize:10}),f=v([]),n=v(0),_=v(!1);ne();const z=v(!1),C=v(""),y=v(!1),N=v(""),$=v(""),k=v(""),r=v(""),e=(a,o,x)=>({10:"录入",20:"确认",30:"通过校验",40:"通过审核"})[x]||x,c=(a,o,x)=>{if(!x)return"";const w=new Date(x),E=w.getFullYear(),h=String(w.getMonth()+1).padStart(2,"0"),I=String(w.getDate()).padStart(2,"0");return`${E}-${h}-${I}`},s=async()=>{_.value=!0;try{const a={...p};console.log("请求参数:",a);const o=await se(a);console.log("后端返回数据:",o),o.success?(f.value=o.data.page.list,n.value=o.data.page.totalRow,console.log("通知列表:",f.value),console.log("总记录数:",n.value)):B.error(o.msg||"获取审核通知列表失败")}catch(a){console.error("获取审核通知列表失败:",a),B.error("获取审核通知列表失败")}finally{_.value=!1}},g=a=>{p.pageSize=a,p.pageNumber=1,console.log("分页大小变更:",p.pageSize),s()},b=a=>{p.pageNumber=a,console.log("当前页变更:",p.pageNumber),s()},U=()=>{p.noticeid="",p.noticename="",p.pageNumber=1,s()},T=a=>{C.value=a.noticeid,Z(()=>{z.value=!0})},V=()=>{z.value=!1,C.value=""},M=a=>{N.value=a.noticeid,$.value=a.noticedrawno||"",k.value=a.contractno,r.value=a.contractname,Z(()=>{y.value=!0})},D=()=>{y.value=!1,N.value="",$.value="",k.value="",r.value=""};return G(()=>{s()}),(a,o)=>{const x=m("el-input"),w=m("el-button"),E=m("el-icon"),h=m("el-table-column"),I=m("el-table"),J=m("el-pagination"),H=m("el-dialog"),O=te("loading");return j(),q("div",qe,[t("div",Be,[l(x,{modelValue:p.noticeid,"onUpdate:modelValue":o[0]||(o[0]=d=>p.noticeid=d),placeholder:"请输入通知ID搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:o[1]||(o[1]=d=>s()),onKeyup:o[2]||(o[2]=R(d=>s(),["enter"]))},null,8,["modelValue"]),l(x,{modelValue:p.noticename,"onUpdate:modelValue":o[3]||(o[3]=d=>p.noticename=d),placeholder:"请输入通知名称搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:o[4]||(o[4]=d=>s()),onKeyup:o[5]||(o[5]=R(d=>s(),["enter"]))},null,8,["modelValue"]),l(w,{type:"primary",onClick:o[6]||(o[6]=d=>s())},{default:i(()=>o[11]||(o[11]=[S("搜索")])),_:1}),l(w,{type:"warning",onClick:U},{default:i(()=>[l(E,null,{default:i(()=>[l(ae(oe))]),_:1}),o[12]||(o[12]=S(" 刷新 "))]),_:1})]),ie((j(),F(I,{data:f.value,border:"",style:{width:"100%"}},{default:i(()=>[l(h,{type:"index",label:"序号",width:"80"}),l(h,{prop:"noticeid",label:"通知编号"}),l(h,{prop:"noticename",label:"通知名称"}),l(h,{prop:"noticedeliver",label:"通知校验人"}),l(h,{prop:"noticeshenhe",label:"通知审核人"}),l(h,{prop:"noticeauther",label:"通知作者"}),l(h,{prop:"noticestatus",label:"通知状态",formatter:e}),l(h,{prop:"contractno",label:"合同编号"}),l(h,{prop:"contractname",label:"合同名称"}),l(h,{prop:"noticebuilddate",label:"通知创建日期",formatter:c}),l(h,{label:"操作",width:"220"},{default:i(({row:d})=>[l(w,{type:"primary",size:"small",onClick:Q=>T(d)},{default:i(()=>o[13]||(o[13]=[S("查看通知")])),_:2},1032,["onClick"]),l(w,{type:"info",size:"small",onClick:Q=>M(d)},{default:i(()=>o[14]||(o[14]=[S("查看备料计划")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,_.value]]),t("div",Te,[l(J,{"current-page":p.pageNumber,"onUpdate:currentPage":o[7]||(o[7]=d=>p.pageNumber=d),"page-size":p.pageSize,"onUpdate:pageSize":o[8]||(o[8]=d=>p.pageSize=d),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:n.value,onSizeChange:g,onCurrentChange:b},null,8,["current-page","page-size","total"])]),l(H,{modelValue:z.value,"onUpdate:modelValue":o[9]||(o[9]=d=>z.value=d),title:"查看通知详情",width:"80%",top:"5vh","destroy-on-close":"","before-close":V,"append-to-body":"","modal-append-to-body":!0},{default:i(()=>[z.value?(j(),F(re,{key:0,noticeid:C.value,visible:z.value,onClose:V},null,8,["noticeid","visible"])):K("",!0)]),_:1},8,["modelValue"]),l(H,{modelValue:y.value,"onUpdate:modelValue":o[10]||(o[10]=d=>y.value=d),title:"查看备料计划",width:"90%",top:"5vh","destroy-on-close":"","before-close":D,"append-to-body":"","modal-append-to-body":!0},{default:i(()=>[y.value?(j(),F(De,{key:0,noticeid:N.value,noticedrawno:$.value,contractno:k.value,contractname:r.value,visible:y.value,onClose:D},null,8,["noticeid","noticedrawno","contractno","contractname","visible"])):K("",!0)]),_:1},8,["modelValue"])])}}},He=A(Me,[["__scopeId","data-v-112f20ac"]]);export{He as default};
