import{_ as H,r as _,k as j,g as W,v as E,h as c,o as z,l as P,w as l,b as e,i as N,a as p,c as A,p as G,E as S,f as K,s as Y,D as J,G as Q,e as q,x as M,a6 as X,H as Z,q as R}from"./index-Bwbtb0V1.js";import{h as ee,i as te,b as le}from"./plshengchangongdan-BS-Hu3DG.js";import{g as ae}from"./department-D3nNq-Av.js";const oe={class:"order-section"},ne={class:"form-section"},se={class:"form-section"},re={class:"form-section"},de={class:"form-section"},ue={class:"form-section"},ie={class:"material-section"},pe={key:0,class:"empty-material"},me={__name:"chakangongdanForm",props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})},depNo:{type:String,default:""}},emits:["update:visible","close"],setup(T,{emit:h}){const V=T,D=h,k=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],b=_([]),U=async()=>{try{const n=await ae();if(!n.success){S.error(n.msg);return}b.value=n.data.options||[]}catch{S.error("加载车间数据失败")}},x=n=>n?b.value.length===0?n:n.split(",").map(r=>{const f=r.trim(),m=b.value.find(g=>g.code===f);return m?m.name:r}).join(","):"",v=j({get:()=>V.visible,set:n=>D("update:visible",n)}),F=j(()=>"查看生产工单详情"),C=_(null),u=_([]),o=W({id:void 0,purchaserHqCode:"",ipoNo:"",supplierCode:"",supplierName:"",contractNo:"",woNo:"",categoryCode:"",subclassCode:"",materialsCode:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",woStatus:1,entityCode:"",processRouteNo:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",writer:"",writetime:""}),y=n=>{const t=k.find(a=>a.id===n);return t?t.value:"未知状态"},w=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},L=async()=>{if(o.woNo)try{const n=await ee({woNo:o.woNo,depNo:V.depNo});u.value=(n.data.itemList||[]).map(t=>({...t,workshopName:x(t.workshopName||t.workshopCode||"")}))}catch{S.error("加载物料列表失败")}},$=()=>{Object.assign(o,{id:void 0,purchaserHqCode:"",ipoNo:"",supplierCode:"",supplierName:"",contractNo:"",woNo:"",categoryCode:"",subclassCode:"",materialsCode:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",woStatus:1,entityCode:"",processRouteNo:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",writer:"",writetime:""}),u.value=[]};E(()=>V.formData,n=>{U(),n&&Object.keys(n).length>0&&(Object.assign(o,n),n.woNo&&L(),n.materialList&&(u.value=n.materialList))},{immediate:!0,deep:!0});const I=()=>{D("close")};return(n,t)=>{const a=c("el-input"),d=c("el-form-item"),r=c("el-col"),f=c("el-row"),m=c("el-form"),g=c("el-table-column"),B=c("el-table"),O=c("el-button"),i=c("el-dialog");return z(),P(i,{title:F.value,modelValue:v.value,"onUpdate:modelValue":t[13]||(t[13]=s=>v.value=s),width:"1400px",onClosed:$},{footer:l(()=>[e(O,{onClick:I},{default:l(()=>t[22]||(t[22]=[N("关闭")])),_:1})]),default:l(()=>[p("div",oe,[t[19]||(t[19]=p("div",{class:"section-header"},[p("h3",null,"生产工单信息")],-1)),e(m,{ref_key:"formRef",ref:C,model:o,"label-width":"120px",size:"small"},{default:l(()=>[p("div",ne,[t[14]||(t[14]=p("div",{class:"section-title"},"基本信息",-1)),e(f,{gutter:10},{default:l(()=>[e(r,{span:8},{default:l(()=>[e(d,{label:"生产订单号"},{default:l(()=>[e(a,{modelValue:o.ipoNo,"onUpdate:modelValue":t[0]||(t[0]=s=>o.ipoNo=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"工单编码"},{default:l(()=>[e(a,{modelValue:o.woNo,"onUpdate:modelValue":t[1]||(t[1]=s=>o.woNo=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"工单状态"},{default:l(()=>[e(a,{value:y(o.woStatus),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1})]),p("div",se,[t[15]||(t[15]=p("div",{class:"section-title"},"供应商信息",-1)),e(f,{gutter:10},{default:l(()=>[e(r,{span:8},{default:l(()=>[e(d,{label:"采购方总部编码"},{default:l(()=>[e(a,{modelValue:o.purchaserHqCode,"onUpdate:modelValue":t[2]||(t[2]=s=>o.purchaserHqCode=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"供应商编码"},{default:l(()=>[e(a,{modelValue:o.supplierCode,"onUpdate:modelValue":t[3]||(t[3]=s=>o.supplierCode=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"供应商名称"},{default:l(()=>[e(a,{modelValue:o.supplierName,"onUpdate:modelValue":t[4]||(t[4]=s=>o.supplierName=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:10},{default:l(()=>[e(r,{span:12},{default:l(()=>[e(d,{label:"合同编号"},{default:l(()=>[e(a,{modelValue:o.contractNo,"onUpdate:modelValue":t[5]||(t[5]=s=>o.contractNo=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",re,[t[16]||(t[16]=p("div",{class:"section-title"},"物料信息",-1)),e(f,{gutter:10},{default:l(()=>[e(r,{span:8},{default:l(()=>[e(d,{label:"品类编码"},{default:l(()=>[e(a,{modelValue:o.categoryCode,"onUpdate:modelValue":t[6]||(t[6]=s=>o.categoryCode=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"种类编码"},{default:l(()=>[e(a,{modelValue:o.subclassCode,"onUpdate:modelValue":t[7]||(t[7]=s=>o.subclassCode=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"厂家物料编码"},{default:l(()=>[e(a,{modelValue:o.materialsCode,"onUpdate:modelValue":t[8]||(t[8]=s=>o.materialsCode=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",de,[t[17]||(t[17]=p("div",{class:"section-title"},"时间计划",-1)),e(f,{gutter:10},{default:l(()=>[e(r,{span:6},{default:l(()=>[e(d,{label:"计划开始日期"},{default:l(()=>[e(a,{value:w(o.planStartDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(r,{span:6},{default:l(()=>[e(d,{label:"计划完成日期"},{default:l(()=>[e(a,{value:w(o.planFinishDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(r,{span:6},{default:l(()=>[e(d,{label:"实际开始日期"},{default:l(()=>[e(a,{value:w(o.actualStartDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(r,{span:6},{default:l(()=>[e(d,{label:"实际完成日期"},{default:l(()=>[e(a,{value:w(o.actualFinishDate),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1})]),p("div",ue,[t[18]||(t[18]=p("div",{class:"section-title"},"其他信息",-1)),e(f,{gutter:10},{default:l(()=>[e(r,{span:8},{default:l(()=>[e(d,{label:"实物ID"},{default:l(()=>[e(a,{modelValue:o.entityCode,"onUpdate:modelValue":t[9]||(t[9]=s=>o.entityCode=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"工艺路线编码"},{default:l(()=>[e(a,{modelValue:o.processRouteNo,"onUpdate:modelValue":t[10]||(t[10]=s=>o.processRouteNo=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"数据来源"},{default:l(()=>[e(a,{modelValue:o.dataSource,"onUpdate:modelValue":t[11]||(t[11]=s=>o.dataSource=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:10},{default:l(()=>[e(r,{span:8},{default:l(()=>[e(d,{label:"录入人"},{default:l(()=>[e(a,{modelValue:o.writer,"onUpdate:modelValue":t[12]||(t[12]=s=>o.writer=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:l(()=>[e(d,{label:"录入时间"},{default:l(()=>[e(a,{value:w(o.writetime),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])]),p("div",ie,[t[21]||(t[21]=p("div",{class:"section-header"},[p("h3",null,"物料信息")],-1)),e(B,{data:u.value,border:"",size:"small",style:{width:"100%"}},{default:l(()=>[e(g,{type:"index",label:"序号",width:"80"}),e(g,{prop:"itemname",label:"物料名称","min-width":"120"}),e(g,{prop:"productModel",label:"规格型号",width:"100"}),e(g,{prop:"amount",label:"数量",width:"80"}),e(g,{prop:"unit",label:"单位",width:"80"}),e(g,{prop:"workshopName",label:"生产车间","min-width":"150"}),e(g,{prop:"memo",label:"备注","min-width":"120"})]),_:1},8,["data"]),u.value.length===0?(z(),A("div",pe,t[20]||(t[20]=[p("p",null,"暂无物料信息",-1)]))):G("",!0)])]),_:1},8,["title","modelValue"])}}},ce=H(me,[["__scopeId","data-v-04274e71"]]),fe={class:"production-workorder-management"},ge={class:"action-bar"},_e={class:"pagination-container"},be={__name:"chakangongdan",setup(T){const h=K(),V={1:{label:"待处理",type:"info"},2:{label:"处理中",type:"warning"},3:{label:"已完成",type:"success"},4:{label:"已取消",type:"danger"},5:{label:"已过期",type:"danger"}},D=t=>{var a;return((a=V[t])==null?void 0:a.label)||"未知状态"},k=t=>{if(!t)return"-";const a=new Date(t);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},b=_(!1),U=_([]),x=_(0);_([]);const v=_(!1),F=_("add"),C=_({}),u=W({ipoNo:"",woNo:"",pageNumber:1,pageSize:10,depNo:h.depNo}),o=async()=>{b.value=!0;try{const t=await te(u);U.value=t.data.page.list||[],x.value=t.data.page.totalRow||0}catch(t){console.error("获取生产工单列表失败:",t),S.error("获取生产工单列表失败")}finally{b.value=!1}},y=()=>{u.pageNumber=1,o()},w=()=>{u.ipoNo="",u.woNo="",u.pageNumber=1,o()},L=t=>{u.pageSize=t,u.pageNumber=1,o()},$=t=>{u.pageNumber=t,o()},I=async t=>{try{const a=await le({id:t.id});C.value=a.data.plshengchangongdan||{},v.value=!0}catch(a){console.error("获取工单详情失败:",a),S.error("获取工单详情失败")}},n=()=>{v.value=!1,C.value={},o()};return Y(()=>{o()}),J(()=>{}),(t,a)=>{const d=c("el-input"),r=c("el-button"),f=c("el-icon"),m=c("el-table-column"),g=c("el-table"),B=c("el-pagination"),O=Q("loading");return z(),A("div",fe,[p("div",ge,[e(d,{modelValue:u.ipoNo,"onUpdate:modelValue":a[0]||(a[0]=i=>u.ipoNo=i),placeholder:"请输入供应商生产订单序号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:y,onKeyup:q(y,["enter"])},null,8,["modelValue"]),e(d,{modelValue:u.woNo,"onUpdate:modelValue":a[1]||(a[1]=i=>u.woNo=i),placeholder:"请输入生产工单编码查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:y,onKeyup:q(y,["enter"])},null,8,["modelValue"]),e(r,{type:"primary",onClick:y},{default:l(()=>a[5]||(a[5]=[N("搜索")])),_:1}),e(r,{type:"warning",onClick:w},{default:l(()=>[e(f,null,{default:l(()=>[e(M(X))]),_:1}),a[6]||(a[6]=N(" 刷新 "))]),_:1})]),Z((z(),P(g,{data:U.value,border:"",style:{width:"100%"}},{default:l(()=>[e(m,{type:"selection",width:"55"}),e(m,{type:"index",label:"序号",width:"80"}),e(m,{prop:"woNo",label:"生产工单号"}),e(m,{prop:"contractNo",label:"合同编号"}),e(m,{prop:"ipoNo",label:"生产订单号"}),e(m,{prop:"planStartDate",label:"计划开始日期",width:"180"},{default:l(({row:i})=>[N(R(k(i.planStartDate)),1)]),_:1}),e(m,{prop:"planFinishDate",label:"计划完成日期",width:"180"},{default:l(({row:i})=>[N(R(k(i.planFinishDate)),1)]),_:1}),e(m,{prop:"woStatus",label:"工单状态",width:"120"},{default:l(({row:i})=>[N(R(D(i.woStatus)),1)]),_:1}),e(m,{prop:"dataSource",label:"数据来源"}),e(m,{label:"操作",width:"200"},{default:l(({row:i})=>[e(r,{type:"primary",size:"small",onClick:s=>I(i)},{default:l(()=>a[7]||(a[7]=[N("查看生产工单详情")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,b.value]]),p("div",_e,[e(B,{"current-page":u.pageNumber,"onUpdate:currentPage":a[2]||(a[2]=i=>u.pageNumber=i),"page-size":u.pageSize,"onUpdate:pageSize":a[3]||(a[3]=i=>u.pageSize=i),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:L,onCurrentChange:$},null,8,["current-page","page-size","total"])]),e(ce,{visible:v.value,"onUpdate:visible":a[4]||(a[4]=i=>v.value=i),type:F.value,"form-data":C.value,"dep-no":M(h).depNo,onCancel:n},null,8,["visible","type","form-data","dep-no"])])}}},Ne=H(be,[["__scopeId","data-v-9f0dce09"]]);export{Ne as default};
