import{_ as q,r as v,k as R,g as P,v as E,h as u,o as D,l as $,w as a,b as e,i as h,a as p,p as j,c as H,f as G,s as W,G as A,e as K,H as Y,q as B,x as J,E as Q}from"./index-DivwvCM9.js";import{h as X,i as Z,e as ee}from"./plshengchandingdan-7tEhKgQA.js";import{g as te}from"./department-Bv9eBxDm.js";const ae={class:"order-section"},le={class:"form-section"},oe={class:"form-section"},ne={class:"form-section"},de={class:"material-section"},se={key:0,class:"empty-material"},re={__name:"chakandingdanForm",props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})},depNo:{type:String,default:""}},emits:["update:visible","close"],setup(M,{emit:C}){const V=M,k=C,w=v([]),m=async()=>{try{const l=await te();if(!l.success){console.error(l.msg);return}w.value=l.data.options||[]}catch{console.error("加载车间数据失败")}},I=l=>l?w.value.length===0?l:l.split(",").map(d=>{const s=d.trim(),f=w.value.find(c=>c.code===s);return f?f.name:d}).join(","):"",U=[{id:1,value:"采购订单"},{id:2,value:"生产订单"},{id:3,value:"销售订单"},{id:4,value:"其他订单"}],S=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],b=R({get:()=>V.visible,set:l=>k("update:visible",l)}),y=v([]),o=P({id:void 0,purchaserHqCode:"",ipoType:"",supplierCode:"",supplierName:"",ipoNo:"",categoryCode:"",subclassCode:"",scheduleCode:"",poItemId:void 0,dataType:void 0,soItemNo:void 0,materialsCode:"",materialsName:"",materialsUnit:"",materialsDesc:"",amount:0,unit:"",productIdGrpNo:"",productIdType:"",productModel:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",plantName:"",workshopName:"",ipoStatus:"",center:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",contractNo:"",contractName:"",writer:""}),g=l=>{const t=U.find(n=>n.id===l);return t?t.value:""},z=l=>{const t=S.find(n=>n.id===l);return t?t.value:""},N=l=>{if(!l)return"";try{const t=new Date(l);return isNaN(t.getTime())?"":t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return""}},T=()=>{Object.assign(o,{id:void 0,purchaserHqCode:"",ipoType:"",supplierCode:"",supplierName:"",ipoNo:"",categoryCode:"",subclassCode:"",scheduleCode:"",poItemId:void 0,dataType:void 0,soItemNo:void 0,materialsCode:"",materialsName:"",materialsUnit:"",materialsDesc:"",amount:0,unit:"",productIdGrpNo:"",productIdType:"",productModel:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",plantName:"",workshopName:"",ipoStatus:"",center:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",contractNo:"",contractName:"",writer:""}),y.value=[]},F=async()=>{if(o.ipoNo)try{const l=await X({ipoNo:o.ipoNo,depNo:V.depNo});y.value=(l.data.itemList||[]).map(t=>({...t,workshopName:I(t.workshopName||t.workshopCode||"")}))}catch(l){console.error("加载物料列表失败",l)}};E(()=>V.formData,l=>{m(),l&&Object.keys(l).length>0&&(Object.assign(o,l),o.ipoNo&&F())},{immediate:!0,deep:!0});const x=()=>{k("close")};return(l,t)=>{const n=u("el-input"),d=u("el-form-item"),s=u("el-col"),f=u("el-row"),c=u("el-form"),_=u("el-table-column"),L=u("el-table"),O=u("el-button"),i=u("el-dialog");return D(),$(i,{title:"查看生产订单",modelValue:b.value,"onUpdate:modelValue":t[9]||(t[9]=r=>b.value=r),width:"1400px",onClosed:T},{footer:a(()=>[e(O,{onClick:x},{default:a(()=>t[16]||(t[16]=[h("关闭")])),_:1})]),default:a(()=>[p("div",ae,[t[13]||(t[13]=p("div",{class:"section-header"},[p("h3",null,"生产订单信息")],-1)),e(c,{model:o,"label-width":"120px",size:"small",class:"readonly-form"},{default:a(()=>[p("div",le,[t[10]||(t[10]=p("div",{class:"section-title"},"基本信息",-1)),e(f,{gutter:10},{default:a(()=>[e(s,{span:8},{default:a(()=>[e(d,{label:"采购方总部编码"},{default:a(()=>[e(n,{modelValue:o.purchaserHqCode,"onUpdate:modelValue":t[0]||(t[0]=r=>o.purchaserHqCode=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:a(()=>[e(d,{label:"订单类型"},{default:a(()=>[e(n,{value:g(o.ipoType),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:a(()=>[e(d,{label:"生产订单号"},{default:a(()=>[e(n,{modelValue:o.ipoNo,"onUpdate:modelValue":t[1]||(t[1]=r=>o.ipoNo=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",oe,[t[11]||(t[11]=p("div",{class:"section-title"},"供应商信息",-1)),e(f,{gutter:10},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(d,{label:"供应商编码"},{default:a(()=>[e(n,{modelValue:o.supplierCode,"onUpdate:modelValue":t[2]||(t[2]=r=>o.supplierCode=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(d,{label:"供应商名称"},{default:a(()=>[e(n,{modelValue:o.supplierName,"onUpdate:modelValue":t[3]||(t[3]=r=>o.supplierName=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:10},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(d,{label:"合同编号"},{default:a(()=>[e(n,{modelValue:o.contractNo,"onUpdate:modelValue":t[4]||(t[4]=r=>o.contractNo=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(d,{label:"合同名称"},{default:a(()=>[e(n,{modelValue:o.contractName,"onUpdate:modelValue":t[5]||(t[5]=r=>o.contractName=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",ne,[t[12]||(t[12]=p("div",{class:"section-title"},"其他信息",-1)),e(f,{gutter:10},{default:a(()=>[e(s,{span:8},{default:a(()=>[e(d,{label:"品类编码"},{default:a(()=>[e(n,{modelValue:o.categoryCode,"onUpdate:modelValue":t[6]||(t[6]=r=>o.categoryCode=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:a(()=>[e(d,{label:"种类编码"},{default:a(()=>[e(n,{modelValue:o.subclassCode,"onUpdate:modelValue":t[7]||(t[7]=r=>o.subclassCode=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:a(()=>[e(d,{label:"生产订单状态"},{default:a(()=>[e(n,{value:z(o.ipoStatus),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:10},{default:a(()=>[e(s,{span:6},{default:a(()=>[e(d,{label:"计划开始日期"},{default:a(()=>[e(n,{value:N(o.planStartDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:6},{default:a(()=>[e(d,{label:"计划完成日期"},{default:a(()=>[e(n,{value:N(o.planFinishDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:6},{default:a(()=>[e(d,{label:"实际开始日期"},{default:a(()=>[e(n,{value:N(o.actualStartDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:6},{default:a(()=>[e(d,{label:"实际完成日期"},{default:a(()=>[e(n,{value:N(o.actualFinishDate),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),o.writer||o.dataSourceCreateTime?(D(),$(f,{key:0,gutter:10},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(d,{label:"创建人"},{default:a(()=>[e(n,{modelValue:o.writer,"onUpdate:modelValue":t[8]||(t[8]=r=>o.writer=r),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(d,{label:"创建时间"},{default:a(()=>[e(n,{value:N(o.dataSourceCreateTime),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1})):j("",!0)])]),_:1},8,["model"])]),p("div",de,[t[15]||(t[15]=p("div",{class:"section-header"},[p("h3",null,"物料信息")],-1)),e(L,{data:y.value,border:"",size:"small",style:{width:"100%"},class:"readonly-table"},{default:a(()=>[e(_,{prop:"itemname",label:"物料名称","min-width":"120"}),e(_,{prop:"productModel",label:"规格型号",width:"100"}),e(_,{prop:"amount",label:"数量",width:"80"}),e(_,{prop:"unit",label:"单位",width:"80"}),e(_,{prop:"workshopName",label:"生产车间","min-width":"150"}),e(_,{prop:"memo",label:"备注","min-width":"120"})]),_:1},8,["data"]),y.value.length===0?(D(),H("div",se,t[14]||(t[14]=[p("p",null,"暂无物料信息",-1)]))):j("",!0)])]),_:1},8,["modelValue"])}}},ie=q(re,[["__scopeId","data-v-cce1df83"]]),ue={class:"production-order-management"},pe={class:"action-bar"},me={class:"pagination-container"},ce={__name:"chakandingdan",setup(M){const C=G();console.log("用户部门信息",C.depNo);const V=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],k=l=>{const t=V.find(n=>n.id===l);return t?t.value:"未知状态"},w=l=>{if(!l)return"";const t=new Date(l);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},m=P({ipoNo:"",pageNumber:1,pageSize:10,depNo:C.depNo}),I=v([]),U=v(0),S=v(!1),b=v(!1),y=v("add"),o=v({}),g=async()=>{S.value=!0;try{const l=await Z(m);I.value=l.data.page.list,U.value=l.data.page.totalRow}catch(l){console.error("获取生产订单列表失败",l),Q.error("获取生产订单列表失败")}finally{S.value=!1}},z=l=>{m.pageSize=l,g()},N=l=>{m.pageNumber=l,g()},T=()=>{m.ipoNo="",m.pageNumber=1,g()},F=async l=>{y.value="edit";const t=await ee({id:l.id});o.value=t.data.plshengchandingdan,b.value=!0},x=()=>{b.value=!1};return W(()=>{g()}),(l,t)=>{const n=u("el-input"),d=u("el-button"),s=u("Refresh"),f=u("el-icon"),c=u("el-table-column"),_=u("el-table"),L=u("el-pagination"),O=A("loading");return D(),H("div",ue,[p("div",pe,[e(n,{modelValue:m.ipoNo,"onUpdate:modelValue":t[0]||(t[0]=i=>m.ipoNo=i),placeholder:"请输入生产订单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:l.getPlshengchandingdanList,onKeyup:K(g,["enter"])},null,8,["modelValue","onClear"]),e(d,{type:"primary",onClick:g},{default:a(()=>t[4]||(t[4]=[h("搜索")])),_:1}),e(d,{type:"warning",onClick:T},{default:a(()=>[e(f,null,{default:a(()=>[e(s)]),_:1}),t[5]||(t[5]=h(" 刷新 "))]),_:1})]),Y((D(),$(_,{data:I.value,border:"",style:{width:"100%"}},{default:a(()=>[e(c,{type:"index",label:"序号",width:"80"}),e(c,{prop:"contractNo",label:"合同编号"}),e(c,{prop:"ipoNo",label:"生产订单号"}),e(c,{prop:"planStartDate",label:"计划开始日期",width:"180"},{default:a(({row:i})=>[h(B(w(i.planStartDate)),1)]),_:1}),e(c,{prop:"planFinishDate",label:"计划完成日期",width:"180"},{default:a(({row:i})=>[h(B(w(i.planFinishDate)),1)]),_:1}),e(c,{prop:"ipoStatus",label:"订单状态",width:"120"},{default:a(({row:i})=>[h(B(k(i.ipoStatus)),1)]),_:1}),e(c,{prop:"writer",label:"录入人名称",width:"100"}),e(c,{prop:"writetime",label:"录入时间",width:"120"}),e(c,{label:"操作",width:"200"},{default:a(({row:i})=>[e(d,{type:"primary",size:"small",onClick:r=>F(i)},{default:a(()=>t[6]||(t[6]=[h("查看详细信息")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,S.value]]),p("div",me,[e(L,{"current-page":m.pageNumber,"onUpdate:currentPage":t[1]||(t[1]=i=>m.pageNumber=i),"page-size":m.pageSize,"onUpdate:pageSize":t[2]||(t[2]=i=>m.pageSize=i),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:U.value,onSizeChange:z,onCurrentChange:N},null,8,["current-page","page-size","total"])]),e(ie,{visible:b.value,"onUpdate:visible":t[3]||(t[3]=i=>b.value=i),type:y.value,"form-data":o.value,"dep-no":J(C).depNo,onClose:x},null,8,["visible","type","form-data","dep-no"])])}}},ve=q(ce,[["__scopeId","data-v-2a5a07be"]]);export{ve as default};
