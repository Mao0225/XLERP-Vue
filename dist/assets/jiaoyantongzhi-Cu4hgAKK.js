import{_ as A,g as q,r as b,s as G,h as c,o as h,c as H,b as e,w as n,a as F,i as w,E as s,u as W,G as X,e as J,x as ee,a6 as te,H as oe,l as R,p as K,M as L,A as Z}from"./index-DivwvCM9.js";import{g as le,u as ae,b as ne,v as ie,d as re}from"./querentongzhi-Di5In1zd.js";import{C as ue}from"./chakanbeiliaodan-syBxtX0M.js";import"./beiliaodan-CYmXQMbF.js";const se={class:"chakantongzhi"},de={class:"pagination-container"},pe={__name:"chakanjiaoyantongzhi",props:{noticeid:{type:String,required:!0}},setup(E){const y=q({noticeid:E.noticeid,pageNumber:1,pageSize:10}),S=b([]),k=b(0),_=b(!1),a=b({}),z=b(null),D=q({no:[{required:!0,message:"请输入合同编号",trigger:"blur"}],noticeid:[{required:!0,message:"请输入通知编号",trigger:"blur"}],noticename:[{required:!0,message:"请输入通知名称",trigger:"blur"}],noticebuilddate:[{required:!0,message:"请选择通知创建日期",trigger:"change"}]}),x=(p,l,u)=>{if(!u)return"";const N=new Date(u),U=N.getFullYear(),g=String(N.getMonth()+1).padStart(2,"0"),m=String(N.getDate()).padStart(2,"0");return`${U}-${g}-${m}`},C=async()=>{try{const p=await le(y);p.success?(S.value=p.data.page.list,k.value=p.data.page.totalRow):s.error(p.msg||"获取通知详情失败")}catch(p){console.error("获取通知详情失败:",p),s.error("获取通知详情失败")}},B=p=>{y.pageSize=p,y.pageNumber=1,C()},Y=p=>{y.pageNumber=p,C()},f=async()=>{if(z.value)try{await z.value.validate();const p={...a.value,noticebuilddate:a.value.noticebuilddate?new Date(a.value.noticebuilddate).getTime():null},l=await ae(p);l.success?(s.success("更新成功"),_.value=!1,C()):s.error(l.msg||"更新失败")}catch(p){console.log("表单验证失败:",p),s.warning("请检查并填写必填字段")}};return G(()=>{C()}),(p,l)=>{const u=c("el-table-column"),N=c("el-table"),U=c("el-pagination"),g=c("el-input"),m=c("el-form-item"),I=c("el-input-number"),$=c("el-date-picker"),i=c("el-form"),t=c("el-button"),v=c("el-dialog");return h(),H("div",se,[e(N,{data:S.value,border:"",style:{width:"100%"}},{default:n(()=>[e(u,{prop:"itemno",label:"产品型号"}),e(u,{prop:"spec",label:"规格"}),e(u,{prop:"itemnum",label:"数量"}),e(u,{prop:"unit",label:"单位"}),e(u,{prop:"noticeid",label:"通知编号"}),e(u,{prop:"noticename",label:"通知名称"}),e(u,{prop:"noticedeliver",label:"通知校验人"}),e(u,{prop:"noticeauther",label:"通知作者"}),e(u,{prop:"noticeinstead",label:"通知替代型号"}),e(u,{prop:"noticedrawno",label:"通知图纸编号"}),e(u,{prop:"noticecomment",label:"通知备注"}),e(u,{prop:"noticeshenhe",label:"通知审核者"}),e(u,{prop:"name",label:"名称"}),e(u,{prop:"noticebuilddate",label:"通知创建日期",formatter:x})]),_:1},8,["data"]),F("div",de,[e(U,{"current-page":y.pageNumber,"onUpdate:currentPage":l[0]||(l[0]=o=>y.pageNumber=o),"page-size":y.pageSize,"onUpdate:pageSize":l[1]||(l[1]=o=>y.pageSize=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:k.value,onSizeChange:B,onCurrentChange:Y},null,8,["current-page","page-size","total"])]),e(v,{modelValue:_.value,"onUpdate:modelValue":l[17]||(l[17]=o=>_.value=o),title:"编辑通知详情"},{footer:n(()=>[e(t,{onClick:l[16]||(l[16]=o=>_.value=!1)},{default:n(()=>l[18]||(l[18]=[w("取消")])),_:1}),e(t,{type:"primary",onClick:f},{default:n(()=>l[19]||(l[19]=[w("保存")])),_:1})]),default:n(()=>[e(i,{model:a.value,rules:D,ref_key:"editFormRef",ref:z,"label-width":"120px"},{default:n(()=>[e(m,{label:"物料编号",prop:"itemno"},{default:n(()=>[e(g,{modelValue:a.value.itemno,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.itemno=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"规格",prop:"spec"},{default:n(()=>[e(g,{modelValue:a.value.spec,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.spec=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"数量",prop:"itemnum"},{default:n(()=>[e(I,{modelValue:a.value.itemnum,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.itemnum=o),min:0},null,8,["modelValue"])]),_:1}),e(m,{label:"单位",prop:"unit"},{default:n(()=>[e(g,{modelValue:a.value.unit,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.unit=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知编号",prop:"noticeid"},{default:n(()=>[e(g,{modelValue:a.value.noticeid,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.noticeid=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知名称",prop:"noticename"},{default:n(()=>[e(g,{modelValue:a.value.noticename,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.noticename=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知校验人",prop:"noticedeliver"},{default:n(()=>[e(g,{modelValue:a.value.noticedeliver,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.noticedeliver=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知作者",prop:"noticeauther"},{default:n(()=>[e(g,{modelValue:a.value.noticeauther,"onUpdate:modelValue":l[9]||(l[9]=o=>a.value.noticeauther=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知替代型号",prop:"noticeinstead"},{default:n(()=>[e(g,{modelValue:a.value.noticeinstead,"onUpdate:modelValue":l[10]||(l[10]=o=>a.value.noticeinstead=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知图纸编号",prop:"noticedrawno"},{default:n(()=>[e(g,{modelValue:a.value.noticedrawno,"onUpdate:modelValue":l[11]||(l[11]=o=>a.value.noticedrawno=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知备注",prop:"noticecomment"},{default:n(()=>[e(g,{type:"textarea",modelValue:a.value.noticecomment,"onUpdate:modelValue":l[12]||(l[12]=o=>a.value.noticecomment=o),rows:4},null,8,["modelValue"])]),_:1}),e(m,{label:"通知审核者",prop:"noticeshenhe"},{default:n(()=>[e(g,{modelValue:a.value.noticeshenhe,"onUpdate:modelValue":l[13]||(l[13]=o=>a.value.noticeshenhe=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"名称",prop:"name"},{default:n(()=>[e(g,{modelValue:a.value.name,"onUpdate:modelValue":l[14]||(l[14]=o=>a.value.name=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"通知创建日期",prop:"noticebuilddate"},{default:n(()=>[e($,{modelValue:a.value.noticebuilddate,"onUpdate:modelValue":l[15]||(l[15]=o=>a.value.noticebuilddate=o),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}},me=A(pe,[["__scopeId","data-v-35b20647"]]),ce={class:"jiaoyantongzhi-management"},ge={class:"action-bar"},ve={class:"pagination-container"},be={__name:"jiaoyantongzhi",setup(E){const d=q({noticeid:"",noticename:"",pageNumber:1,pageSize:10}),y=b([]),S=b(0),k=b(!1);W();const _=b(!1),a=b(""),z=b(!1),D=b(""),x=b(""),C=b(""),B=(i,t,v)=>({10:"录入",20:"确认",30:"通过校验",40:"通过审核"})[v]||v,Y=(i,t,v)=>{if(!v)return"";const o=new Date(v),M=o.getFullYear(),V=String(o.getMonth()+1).padStart(2,"0"),T=String(o.getDate()).padStart(2,"0");return`${M}-${V}-${T}`},f=async()=>{k.value=!0;try{const i={...d};console.log("请求参数:",i);const t=await ne(i);console.log("后端返回数据:",t),t.success?(y.value=t.data.page.list,S.value=t.data.page.totalRow,console.log("通知列表:",y.value),console.log("总记录数:",S.value)):s.error(t.msg||"获取校验通知列表失败")}catch(i){console.error("获取校验通知列表失败:",i),s.error("获取校验通知列表失败")}finally{k.value=!1}},p=i=>{d.pageSize=i,d.pageNumber=1,console.log("分页大小变更:",d.pageSize),f()},l=i=>{d.pageNumber=i,console.log("当前页变更:",d.pageNumber),f()},u=()=>{d.noticeid="",d.noticename="",d.pageNumber=1,f()},N=i=>{a.value=i.noticeid,L(()=>{_.value=!0})},U=()=>{_.value=!1,a.value=""},g=async i=>{if(console.log("校验通知时的 row 对象:",i),!i.noticeid){s.error("通知ID不能为空，请刷新页面重试");return}if(i.noticestatus!==20){s.warning('只有状态为"确认"的通知才能进行校验操作');return}Z.confirm(`你确定要校验通知吗？通知ID：${i.noticeid}`,"校验通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const t=localStorage.getItem("realName"),v={noticeid:i.noticeid,noticedeliver:t};console.log("校验通知请求参数:",v);try{console.log("校验通知请求URL:","/tongzhi/jiaoyantongzhi"),console.log("校验通知请求参数:",v);const o=await ie(v);o.success?(s.success(o.msg),f()):s.error(o.msg)}catch(o){console.error("校验通知失败:",o),s.error("校验通知失败")}}).catch(()=>{s.info("已取消操作")})},m=async i=>{if(!i.noticeid){s.error("通知ID不能为空，请刷新页面重试");return}if(i.noticestatus!==30){s.warning('只有状态为"通过校验"的通知才能进行反校验操作');return}Z.confirm(`你确定要反校验通知吗？通知ID：${i.noticeid}`,"反校验通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await re({noticeid:i.noticeid});t.success?(s.success(t.msg),f()):s.error(t.msg)}catch(t){console.error("反校验通知失败:",t),s.error("反校验通知失败")}}).catch(()=>{s.info("已取消操作")})},I=i=>{D.value=i.noticeid,x.value=i.contractno,C.value=i.contractname,L(()=>{z.value=!0})},$=()=>{z.value=!1,D.value="",x.value="",C.value=""};return G(()=>{f()}),(i,t)=>{const v=c("el-input"),o=c("el-button"),M=c("el-icon"),V=c("el-table-column"),T=c("el-table"),O=c("el-pagination"),P=c("el-dialog"),Q=X("loading");return h(),H("div",ce,[F("div",ge,[e(v,{modelValue:d.noticeid,"onUpdate:modelValue":t[0]||(t[0]=r=>d.noticeid=r),placeholder:"请输入通知ID搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:t[1]||(t[1]=r=>f()),onKeyup:t[2]||(t[2]=J(r=>f(),["enter"]))},null,8,["modelValue"]),e(v,{modelValue:d.noticename,"onUpdate:modelValue":t[3]||(t[3]=r=>d.noticename=r),placeholder:"请输入通知名称搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:t[4]||(t[4]=r=>f()),onKeyup:t[5]||(t[5]=J(r=>f(),["enter"]))},null,8,["modelValue"]),e(o,{type:"primary",onClick:t[6]||(t[6]=r=>f())},{default:n(()=>t[11]||(t[11]=[w("搜索")])),_:1}),e(o,{type:"warning",onClick:u},{default:n(()=>[e(M,null,{default:n(()=>[e(ee(te))]),_:1}),t[12]||(t[12]=w(" 刷新 "))]),_:1})]),oe((h(),R(T,{data:y.value,border:"",style:{width:"100%"}},{default:n(()=>[e(V,{type:"index",label:"序号",width:"80"}),e(V,{prop:"noticeid",label:"通知编号"}),e(V,{prop:"noticename",label:"通知名称"}),e(V,{prop:"noticedeliver",label:"通知校验人"}),e(V,{prop:"noticeshenhe",label:"通知审核人"}),e(V,{prop:"noticeauther",label:"通知作者"}),e(V,{prop:"noticestatus",label:"通知状态",formatter:B}),e(V,{prop:"contractno",label:"合同编号"}),e(V,{prop:"contractname",label:"合同名称"}),e(V,{prop:"noticebuilddate",label:"通知创建日期",formatter:Y}),e(V,{label:"操作",width:"420"},{default:n(({row:r})=>[e(o,{type:"success",size:"small",onClick:j=>g(r),disabled:r.noticestatus!==20},{default:n(()=>t[13]||(t[13]=[w("校验通知")])),_:2},1032,["onClick","disabled"]),e(o,{type:"danger",size:"small",onClick:j=>m(r),disabled:r.noticestatus!==30},{default:n(()=>t[14]||(t[14]=[w("反校验通知")])),_:2},1032,["onClick","disabled"]),e(o,{type:"primary",size:"small",onClick:j=>N(r)},{default:n(()=>t[15]||(t[15]=[w("查看通知")])),_:2},1032,["onClick"]),e(o,{type:"info",size:"small",onClick:j=>I(r),disabled:r.noticestatus==="10"},{default:n(()=>t[16]||(t[16]=[w("查看备料计划")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]]),F("div",ve,[e(O,{"current-page":d.pageNumber,"onUpdate:currentPage":t[7]||(t[7]=r=>d.pageNumber=r),"page-size":d.pageSize,"onUpdate:pageSize":t[8]||(t[8]=r=>d.pageSize=r),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:p,onCurrentChange:l},null,8,["current-page","page-size","total"])]),e(P,{modelValue:_.value,"onUpdate:modelValue":t[9]||(t[9]=r=>_.value=r),title:"查看通知详情",width:"80%",top:"5vh","destroy-on-close":"","before-close":U,"append-to-body":"","modal-append-to-body":!0},{default:n(()=>[_.value?(h(),R(me,{key:0,noticeid:a.value,visible:_.value,onClose:U},null,8,["noticeid","visible"])):K("",!0)]),_:1},8,["modelValue"]),e(P,{modelValue:z.value,"onUpdate:modelValue":t[10]||(t[10]=r=>z.value=r),title:"查看备料计划",width:"90%",top:"5vh","destroy-on-close":"","before-close":$,"append-to-body":"","modal-append-to-body":!0},{default:n(()=>[z.value?(h(),R(ue,{key:0,noticeid:D.value,contractno:x.value,contractname:C.value,visible:z.value,onClose:$},null,8,["noticeid","contractno","contractname","visible"])):K("",!0)]),_:1},8,["modelValue"])])}}},ze=A(be,[["__scopeId","data-v-d95a1424"]]);export{ze as default};
