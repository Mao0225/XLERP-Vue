import{O as J,P as De,Q as Me,R as Te,_ as $e,f as Je,g as Y,r as p,k as Be,s as Fe,h as f,G as Oe,o as w,c as j,a as C,b as t,e as $,w as r,i as m,x as E,a6 as qe,H as ie,l as ue,F as de,m as pe,ai as ce,q as Ye,p as Ee,E as b,A as Ke,B as Ie}from"./index-DivwvCM9.js";import{a as Pe}from"./file-DG1x66KO.js";import{W as Ae}from"./WoNoSelector-BU9BVcDC.js";import{g as He}from"./basorg-CEO7C1K8.js";import"./plshengchangongdan-x5Bc9PHG.js";function Qe(c){return J("/cljxjjLbgx/getpage",c)}function Ge(c){return J("/cljxjjLbgx/get",c)}function Xe(c){return De("/cljxjjLbgx/save",c)}function Ze(c){return Me("/cljxjjLbgx/update",c)}function et(c){return Te("/cljxjjLbgx/delete",c)}function tt(c){return J("/cljxjjLbgx/getWoNoList",c)}function me(c){return J("/Basno/getNewNoNyName",{basname:c})}const at={class:"jxjjLbgx-management"},lt={class:"action-bar"},ot=["onClick"],rt={class:"pagination-container"},nt={key:0,class:"uploaded-files"},st=["onClick"],it={class:"pagination-container"},ut={__name:"jxjjlbgx",setup(c){const ge=Ie,_=Je(),K=()=>(console.log("获取登录用户名称",_.descr),_.descr),u=Y({mafactory:"",orderno:"",matRecheckNo:"",pageNumber:1,pageSize:10}),I=p([]),P=p(0),B=p(!1),x=p(!1),A=p([]),H=p(0),F=p(!1),z=p(!1),Q=p([]),G=p(0),O=p(!1),y=Y({descr:"",type:1,pageNumber:1,pageSize:10}),V=p(!1),h=p("add"),fe=Be(()=>h.value==="add"?"新增数据":"编辑数据"),k=p(null),L=p(null),U=p([]),l=Y({id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",orderno:"",matRecheckNo:"",size:"",singleWireStrength:0,leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:K(),status:0,isdelete:0,basno:""}),be={mafactory:[{required:!0,message:"请选择原材料制造商",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],orderno:[{required:!0,message:"请输入入库单号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],matRecheckNo:[{required:!0,message:"请输入来料检测批测号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],size:[{required:!0,message:"请输入尺寸",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],singleWireStrength:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],leavefactoryDate:[{required:!0,message:"请输入出厂日期",trigger:"change"}],detectionTime:[{required:!0,message:"请输入入厂日期",trigger:"change"}],contractNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],woNo:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],ipoNo:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],basno:[{max:50,message:"请获取单据号",trigger:"blur"}]},X=()=>{z.value=!0,S()},S=async()=>{O.value=!0;try{const o=await He(y);Q.value=o.data.page.list,G.value=o.data.page.totalRow}catch(o){console.error("获取供应商列表失败",o),b.error("获取供应商列表失败")}finally{O.value=!1}},ye=o=>{y.pageSize=o,S()},Ne=o=>{y.pageNumber=o,S()},Z=o=>{l.mafactory=o.descr,l.mafactoryId=o.id,z.value=!1},ve=o=>{Z(o)},W=p(""),ee=()=>{W.value="woNo",x.value=!0,R()},te=()=>{W.value="contractNo",x.value=!0,R()},ae=()=>{W.value="ipoNo",x.value=!0,R()},we=o=>{switch(W.value){case"contractNo":l.contractNo=o.contractNo||"";break;case"woNo":l.woNo=o.woNo||"";break;case"ipoNo":l.ipoNo=o.ipoNo||"";break}x.value=!1},R=async(o="")=>{F.value=!0;try{const e=await tt({pageNumber:1,pageSize:10,woNo:o});A.value=e.data.page.list,H.value=e.data.page.totalRow}catch(e){console.error("获取合同号列表失败",e),b.error("获取合同号列表失败")}finally{F.value=!1}},g=async()=>{B.value=!0;try{const o=await Qe(u);I.value=o.data.page.list,P.value=o.data.page.totalRow}catch(o){console.error("获取数据列表失败",o),b.error("获取数据列表失败")}finally{B.value=!1}},xe=o=>{u.pageSize=o,g()},Ve=o=>{u.pageNumber=o,g()},le=()=>{k.value&&k.value.resetFields(),L.value&&L.value.clearFiles(),U.value=[],Object.assign(l,{id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",mafactoryId:"",orderno:"",matRecheckNo:"",size:"",singleWireStrength:0,leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:K(),status:0,isdelete:0,basno:""})},je=()=>{u.contractNo="",u.woNo="",u.ipoNo="",u.mafactory="",u.orderno="",u.matRecheckNo="",u.pageNumber=1,g()},ke=async()=>{h.value="add",le(),l.writer=_.descr||"未知用户";try{if(D.value)l.basno=D.value,D.value="";else{const o=await me("jxjjlbgx");o.code===200?l.basno=o.data.fullNoNyName:b.warning("获取单据号失败，可手动填写")}}catch(o){console.error("获取单据号异常",o),b.error("获取单据号失败")}V.value=!0},Se=async o=>{h.value="edit";const e=await Ge({id:o.id});Object.assign(l,e.data.jxjjLbgx),l.writer||(l.writer=_.descr||"未知用户");try{JSON.parse(l.certificate)}catch{if(l.certificate){const i=l.certificate.split("-");l.certificate=JSON.stringify(i.map(N=>({name:N.split("/").pop(),url:`/api/upload/${N}`})))}else l.certificate="[]"}U.value=JSON.parse(l.certificate),V.value=!0},Ce=o=>{Ke.confirm(`确认删除数据"${o.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await et({id:o.id}),b.success("删除成功"),g()}catch(e){console.error("删除数据失败",e),b.error("删除数据失败")}}).catch(()=>{})},_e=()=>{k.value&&k.value.validate(async o=>{if(o)try{if(!l.basno){b.error("单据号未生成，请刷新重试");return}const e=new Date,n=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),N=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),M=String(e.getMinutes()).padStart(2,"0"),T=String(e.getSeconds()).padStart(2,"0");if(l.writeTime=`${n}-${i}-${N} ${s}:${M}:${T}`,h.value==="add"){await Xe(l),b.success("新增成功");try{const d=await me("jxjjlbgx");d.code===200&&(D.value=d.data.fullNoNyName)}catch(d){console.error("获取新单据号异常",d)}}else await Ze(l),b.success("修改成功");V.value=!1,g()}catch(e){console.error("保存数据失败",e),b.error("保存数据失败")}})},D=p(""),ze=async o=>{const e=new FormData;e.append("file",o.raw);try{const n=await Pe(e);if(n.success&&n.data&&n.data.url){const i=ge+n.data.url,N=JSON.parse(l.certificate);N.push({name:o.name,url:i}),l.certificate=JSON.stringify(N),U.value.push({name:o.name,url:i}),b.success(`${o.name} 上传成功`)}else throw new Error(n.msg||"文件上传失败")}catch(n){console.error("文件上传失败",n),b.error(`${o.name} 上传失败`),L.value.clearFiles()}},he=o=>{const e=JSON.parse(l.certificate);e.splice(o,1),l.certificate=JSON.stringify(e),U.value.splice(o,1)},oe=o=>{window.open(o,"_blank")};return Fe(()=>{g()}),(o,e)=>{const n=f("el-input"),i=f("el-button"),N=f("el-icon"),s=f("el-table-column"),M=f("el-table"),T=f("el-pagination"),d=f("el-form-item"),re=f("el-date-picker"),Le=f("el-upload"),Ue=f("el-col"),We=f("el-row"),Re=f("el-form"),ne=f("el-dialog"),se=Oe("loading");return w(),j("div",at,[C("div",lt,[t(n,{modelValue:u.mafactory,"onUpdate:modelValue":e[0]||(e[0]=a=>u.mafactory=a),placeholder:"请输入原材料制造商查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:$(g,["enter"])},null,8,["modelValue"]),t(n,{modelValue:u.orderno,"onUpdate:modelValue":e[1]||(e[1]=a=>u.orderno=a),placeholder:"请输入入库单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:$(g,["enter"])},null,8,["modelValue"]),t(n,{modelValue:u.matRecheckNo,"onUpdate:modelValue":e[2]||(e[2]=a=>u.matRecheckNo=a),placeholder:"请输入来料检验批次号",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:$(g,["enter"])},null,8,["modelValue"]),t(i,{type:"primary",onClick:g},{default:r(()=>e[24]||(e[24]=[m("搜索")])),_:1}),t(i,{type:"warning",onClick:je},{default:r(()=>[t(N,null,{default:r(()=>[t(E(qe))]),_:1}),e[25]||(e[25]=m(" 刷新 "))]),_:1}),t(i,{type:"primary",style:{"margin-left":"auto"},onClick:ke},{default:r(()=>e[26]||(e[26]=[m("新增")])),_:1})]),ie((w(),ue(M,{data:I.value,border:"",style:{width:"100%"}},{default:r(()=>[t(s,{type:"index",label:"序号",width:"80"}),t(s,{prop:"basno",label:"单据号"}),t(s,{prop:"contractNo",label:"合同编号"}),t(s,{prop:"woNo",label:"生产工单号"}),t(s,{prop:"ipoNo",label:"生产订单号"}),t(s,{prop:"writer",label:"录入人"}),t(s,{prop:"writeTime",label:"录入时间"}),t(s,{prop:"mafactory",label:"原材料制造商"}),t(s,{prop:"orderno",label:"入库单号"}),t(s,{prop:"matRecheckNo",label:"来料检验批次号"}),t(s,{prop:"size",label:"尺寸"}),t(s,{prop:"singleWireStrength",label:"力学性能-单丝强度"}),t(s,{prop:"leavefactoryDate",label:"原材料出厂检测日期",width:"120"}),t(s,{prop:"detectionTime",label:"原材料入厂检测日期",width:"120"}),t(s,{prop:"certificate",label:"质量证明书"},{default:r(({row:a})=>[(w(!0),j(de,null,pe(JSON.parse(a.certificate||"[]"),(v,q)=>(w(),j("div",{key:q},[t(E(ce),{content:v.name,placement:"top"},{default:r(()=>[C("span",{class:"file-link",onClick:dt=>oe(v.url,v.name)},"打开文件",8,ot)]),_:2},1032,["content"])]))),128))]),_:1}),t(s,{label:"操作",width:"200"},{default:r(({row:a})=>[t(i,{type:"primary",size:"small",onClick:v=>Se(a)},{default:r(()=>e[27]||(e[27]=[m("编辑")])),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:v=>Ce(a)},{default:r(()=>e[28]||(e[28]=[m("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,B.value]]),C("div",rt,[t(T,{"current-page":u.pageNumber,"onUpdate:currentPage":e[3]||(e[3]=a=>u.pageNumber=a),"page-size":u.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>u.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:P.value,onSizeChange:xe,onCurrentChange:Ve},null,8,["current-page","page-size","total"])]),t(ne,{title:fe.value,modelValue:V.value,"onUpdate:modelValue":e[18]||(e[18]=a=>V.value=a),width:"800px",onClosed:le},{footer:r(()=>[t(i,{onClick:e[17]||(e[17]=a=>V.value=!1)},{default:r(()=>e[35]||(e[35]=[m("取消")])),_:1}),t(i,{type:"primary",onClick:_e},{default:r(()=>e[36]||(e[36]=[m("确定")])),_:1})]),default:r(()=>[t(Re,{ref_key:"formRef",ref:k,model:l,rules:be,"label-width":"140px"},{default:r(()=>[t(We,{gutter:20},{default:r(()=>[t(Ue,{span:12},{default:r(()=>[t(d,{label:"合同编号",prop:"contractNo"},{default:r(()=>[t(n,{modelValue:l.contractNo,"onUpdate:modelValue":e[5]||(e[5]=a=>l.contractNo=a),placeholder:"选择合同编号",readonly:"",onClick:te},{append:r(()=>[t(i,{onClick:te,size:"small"},{default:r(()=>e[29]||(e[29]=[m("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"生产工单号",prop:"woNo"},{default:r(()=>[t(n,{modelValue:l.woNo,"onUpdate:modelValue":e[6]||(e[6]=a=>l.woNo=a),placeholder:"选择生产工单号",readonly:"",onClick:ee},{append:r(()=>[t(i,{onClick:ee,size:"small"},{default:r(()=>e[30]||(e[30]=[m("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"生产订单号",prop:"ipoNo"},{default:r(()=>[t(n,{modelValue:l.ipoNo,"onUpdate:modelValue":e[7]||(e[7]=a=>l.ipoNo=a),placeholder:"选择生产订单号",readonly:"",onClick:ae},{append:r(()=>[t(i,{onClick:ae,size:"small"},{default:r(()=>e[31]||(e[31]=[m("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"录入人",prop:"writer"},{default:r(()=>[t(n,{modelValue:l.writer,"onUpdate:modelValue":e[8]||(e[8]=a=>l.writer=a),placeholder:"录入人",readonly:""},null,8,["modelValue"])]),_:1}),t(d,{label:"单据号",prop:"basno"},{default:r(()=>[t(n,{modelValue:l.basno,"onUpdate:modelValue":e[9]||(e[9]=a=>l.basno=a),placeholder:"自动生成",readonly:""},null,8,["modelValue"])]),_:1}),t(d,{label:"原材料制造商",prop:"mafactory"},{default:r(()=>[t(n,{modelValue:l.mafactory,"onUpdate:modelValue":e[10]||(e[10]=a=>l.mafactory=a),placeholder:"选择原材料制造商",readonly:"",onClick:X},{append:r(()=>[t(i,{onClick:X,size:"small"},{default:r(()=>e[32]||(e[32]=[m("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"入库单号",prop:"orderno"},{default:r(()=>[t(n,{modelValue:l.orderno,"onUpdate:modelValue":e[11]||(e[11]=a=>l.orderno=a),placeholder:"请输入入库单号"},null,8,["modelValue"])]),_:1}),t(d,{label:"来料检验批次号",prop:"matRecheckNo"},{default:r(()=>[t(n,{modelValue:l.matRecheckNo,"onUpdate:modelValue":e[12]||(e[12]=a=>l.matRecheckNo=a),placeholder:"请输入来料检验批次号"},null,8,["modelValue"])]),_:1}),t(d,{label:"尺寸",prop:"size"},{default:r(()=>[t(n,{modelValue:l.size,"onUpdate:modelValue":e[13]||(e[13]=a=>l.size=a),placeholder:"请输入尺寸"},null,8,["modelValue"])]),_:1}),t(d,{label:"力学性能-单丝强度",prop:"singleWireStrength"},{default:r(()=>[t(n,{modelValue:l.singleWireStrength,"onUpdate:modelValue":e[14]||(e[14]=a=>l.singleWireStrength=a),modelModifiers:{number:!0},placeholder:"请输入力学性能-单丝强度",type:"number"},null,8,["modelValue"])]),_:1}),t(d,{label:"原材料出厂检测日期",prop:"leavefactoryDate"},{default:r(()=>[t(re,{modelValue:l.leavefactoryDate,"onUpdate:modelValue":e[15]||(e[15]=a=>l.leavefactoryDate=a),type:"date",placeholder:"请选择原材料出厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(d,{label:"原材料入厂检测日期",prop:"detectionTime"},{default:r(()=>[t(re,{modelValue:l.detectionTime,"onUpdate:modelValue":e[16]||(e[16]=a=>l.detectionTime=a),type:"date",placeholder:"请选择原材料入厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(d,{label:"质量证明书",prop:"certificate"},{default:r(()=>[t(Le,{ref_key:"certificateUpload",ref:L,"auto-upload":!1,"on-change":ze,limit:10,accept:".pdf,.jpg,.jpeg,.png","file-list":[],"show-file-list":!1},{default:r(()=>[t(i,{type:"primary"},{default:r(()=>e[33]||(e[33]=[m("上传文件")])),_:1})]),_:1},512),l.certificate?(w(),j("div",nt,[(w(!0),j(de,null,pe(JSON.parse(l.certificate),(a,v)=>(w(),j("div",{key:v,class:"uploaded-file"},[t(E(ce),{content:a.name,placement:"top"},{default:r(()=>[C("span",{class:"file-link",onClick:q=>oe(a.url,a.name)},Ye(a.name),9,st)]),_:2},1032,["content"]),t(i,{type:"danger",size:"mini",onClick:q=>he(v)},{default:r(()=>e[34]||(e[34]=[m("删除")])),_:2},1032,["onClick"])]))),128))])):Ee("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(Ae,{modelValue:x.value,"onUpdate:modelValue":e[19]||(e[19]=a=>x.value=a),onSelect:we,woNoList:A.value,totalWoNo:H.value,loadingWoNo:F.value,onSearch:R},null,8,["modelValue","woNoList","totalWoNo","loadingWoNo"]),t(ne,{title:"选择原材料制造商",modelValue:z.value,"onUpdate:modelValue":e[23]||(e[23]=a=>z.value=a),width:"600px"},{default:r(()=>[t(n,{modelValue:y.descr,"onUpdate:modelValue":e[20]||(e[20]=a=>y.descr=a),placeholder:"请输入供应商名称查询",style:{"margin-bottom":"10px"},clearable:"",onClear:S,onKeyup:$(S,["enter"])},null,8,["modelValue"]),ie((w(),ue(M,{data:Q.value,border:"",style:{width:"100%"},onRowClick:ve},{default:r(()=>[t(s,{prop:"no",label:"供应商编号"}),t(s,{prop:"descr",label:"供应商名称"}),t(s,{prop:"contactname",label:"联系人"}),t(s,{prop:"phone",label:"联系电话"}),t(s,{label:"操作"},{default:r(({row:a})=>[t(i,{type:"primary",size:"small",onClick:v=>Z(a)},{default:r(()=>e[37]||(e[37]=[m("选择")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,O.value]]),C("div",it,[t(T,{"current-page":y.pageNumber,"onUpdate:currentPage":e[21]||(e[21]=a=>y.pageNumber=a),"page-size":y.pageSize,"onUpdate:pageSize":e[22]||(e[22]=a=>y.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:G.value,onSizeChange:ye,onCurrentChange:Ne},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])])}}},bt=$e(ut,[["__scopeId","data-v-56483764"]]);export{bt as default};
