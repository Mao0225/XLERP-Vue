import{_ as Y,g as J,r as d,u as O,s as Q,h as p,G as W,o as f,c as X,a as I,b as o,e as T,w as u,i as v,x as ee,a6 as te,H as oe,l as B,p as U,E as i,M,A as E}from"./index-DvIhe9Wx.js";import{e as ne,s as ae,h as le}from"./querentongzhi-X4SMs00W.js";import{C as ie}from"./chakanshenhetongzhi-C7ZcvpM-.js";import{C as se}from"./chakanbeiliaodan-BtWLYdX9.js";import"./beiliaodan-Dk2XcVHU.js";const re={class:"shenhetongzhi-management"},ce={class:"action-bar"},ue={class:"pagination-container"},de={__name:"shenhetongzhi",setup(pe){const a=J({noticeid:"",noticename:"",pageNumber:1,pageSize:10}),b=d([]),h=d(0),y=d(!1);O();const m=d(!1),C=d(""),g=d(!1),N=d(""),w=d(""),z=d(""),_=d(""),H=(t,e,r)=>({10:"录入",20:"确认",30:"通过校验",40:"通过审核"})[r]||r,R=(t,e,r)=>{if(!r)return"";const l=new Date(r),V=l.getFullYear(),s=String(l.getMonth()+1).padStart(2,"0"),k=String(l.getDate()).padStart(2,"0");return`${V}-${s}-${k}`},c=async()=>{y.value=!0;try{const t={...a};console.log("请求参数:",t);const e=await ne(t);console.log("后端返回数据:",e),e.success?(b.value=e.data.page.list,h.value=e.data.page.totalRow,console.log("通知列表:",b.value),console.log("总记录数:",h.value)):i.error(e.msg||"获取审核通知列表失败")}catch(t){console.error("获取审核通知列表失败:",t),i.error("获取审核通知列表失败")}finally{y.value=!1}},K=t=>{a.pageSize=t,a.pageNumber=1,console.log("分页大小变更:",a.pageSize),c()},L=t=>{a.pageNumber=t,console.log("当前页变更:",a.pageNumber),c()},P=()=>{a.noticeid="",a.noticename="",a.pageNumber=1,c()},Z=t=>{C.value=t.noticeid,M(()=>{m.value=!0})},S=()=>{m.value=!1,C.value=""},A=async t=>{if(console.log("审核通知时的 row 对象:",t),!t.noticeid){i.error("通知ID不能为空，请刷新页面重试");return}if(t.noticestatus!==30){i.warning('只有状态为"通过校验"的通知才能进行审核操作');return}E.confirm(`你确定要审核通知吗？通知ID：${t.noticeid}`,"审核通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=localStorage.getItem("realName"),r={noticeid:t.noticeid,noticeshenhe:e};console.log("审核通知请求参数:",r);try{console.log("审核通知请求URL:","/tongzhi/shenhetongzhi"),console.log("审核通知请求参数:",r);const l=await ae(r);l.success?(i.success(l.msg),c()):i.error(l.msg)}catch(l){console.error("审核通知失败:",l),i.error("审核通知失败")}}).catch(()=>{i.info("已取消操作")})},j=async t=>{if(!t.noticeid){i.error("通知ID不能为空，请刷新页面重试");return}if(t.noticestatus!==40){i.warning('只有状态为"通过审核"的通知才能进行反审核操作');return}E.confirm(`你确定要反审核通知吗？通知ID：${t.noticeid}`,"反审核通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await le({noticeid:t.noticeid});e.success?(i.success(e.msg),c()):i.error(e.msg)}catch(e){console.error("反审核通知失败:",e),i.error("反审核通知失败")}}).catch(()=>{i.info("已取消操作")})},q=t=>{N.value=t.noticeid,w.value=t.noticedrawno||"",z.value=t.contractno,_.value=t.contractname,M(()=>{g.value=!0})},$=()=>{g.value=!1,N.value="",w.value="",z.value="",_.value=""};return Q(()=>{c()}),(t,e)=>{const r=p("el-input"),l=p("el-button"),V=p("el-icon"),s=p("el-table-column"),k=p("el-table"),F=p("el-pagination"),D=p("el-dialog"),G=W("loading");return f(),X("div",re,[I("div",ce,[o(r,{modelValue:a.noticeid,"onUpdate:modelValue":e[0]||(e[0]=n=>a.noticeid=n),placeholder:"请输入通知ID搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:e[1]||(e[1]=n=>c()),onKeyup:e[2]||(e[2]=T(n=>c(),["enter"]))},null,8,["modelValue"]),o(r,{modelValue:a.noticename,"onUpdate:modelValue":e[3]||(e[3]=n=>a.noticename=n),placeholder:"请输入通知名称搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:e[4]||(e[4]=n=>c()),onKeyup:e[5]||(e[5]=T(n=>c(),["enter"]))},null,8,["modelValue"]),o(l,{type:"primary",onClick:e[6]||(e[6]=n=>c())},{default:u(()=>e[11]||(e[11]=[v("搜索")])),_:1}),o(l,{type:"warning",onClick:P},{default:u(()=>[o(V,null,{default:u(()=>[o(ee(te))]),_:1}),e[12]||(e[12]=v(" 刷新 "))]),_:1})]),oe((f(),B(k,{data:b.value,border:"",style:{width:"100%"}},{default:u(()=>[o(s,{type:"index",label:"序号",width:"80"}),o(s,{prop:"noticeid",label:"通知编号"}),o(s,{prop:"noticename",label:"通知名称"}),o(s,{prop:"noticedeliver",label:"通知校验人"}),o(s,{prop:"noticeshenhe",label:"通知审核人"}),o(s,{prop:"noticeauther",label:"通知作者"}),o(s,{prop:"noticestatus",label:"通知状态",formatter:H}),o(s,{prop:"contractno",label:"合同编号"}),o(s,{prop:"contractname",label:"合同名称"}),o(s,{prop:"noticebuilddate",label:"通知创建日期",formatter:R}),o(s,{label:"操作",width:"420"},{default:u(({row:n})=>[o(l,{type:"success",size:"small",onClick:x=>A(n),disabled:n.noticestatus!==30},{default:u(()=>e[13]||(e[13]=[v("审核通知")])),_:2},1032,["onClick","disabled"]),o(l,{type:"danger",size:"small",onClick:x=>j(n),disabled:n.noticestatus!==40},{default:u(()=>e[14]||(e[14]=[v("反审核通知")])),_:2},1032,["onClick","disabled"]),o(l,{type:"primary",size:"small",onClick:x=>Z(n)},{default:u(()=>e[15]||(e[15]=[v("查看通知")])),_:2},1032,["onClick"]),o(l,{type:"info",size:"small",onClick:x=>q(n)},{default:u(()=>e[16]||(e[16]=[v("查看备料计划")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,y.value]]),I("div",ue,[o(F,{"current-page":a.pageNumber,"onUpdate:currentPage":e[7]||(e[7]=n=>a.pageNumber=n),"page-size":a.pageSize,"onUpdate:pageSize":e[8]||(e[8]=n=>a.pageSize=n),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:h.value,onSizeChange:K,onCurrentChange:L},null,8,["current-page","page-size","total"])]),o(D,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=n=>m.value=n),title:"查看通知详情",width:"80%",top:"5vh","destroy-on-close":"","before-close":S,"append-to-body":"","modal-append-to-body":!0},{default:u(()=>[m.value?(f(),B(ie,{key:0,noticeid:C.value,visible:m.value,onClose:S},null,8,["noticeid","visible"])):U("",!0)]),_:1},8,["modelValue"]),o(D,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=n=>g.value=n),title:"查看备料计划",width:"90%",top:"5vh","destroy-on-close":"","before-close":$,"append-to-body":"","modal-append-to-body":!0},{default:u(()=>[g.value?(f(),B(se,{key:0,noticeid:N.value,noticedrawno:w.value,contractno:z.value,contractname:_.value,visible:g.value,onClose:$},null,8,["noticeid","noticedrawno","contractno","contractname","visible"])):U("",!0)]),_:1},8,["modelValue"])])}}},he=Y(de,[["__scopeId","data-v-a41f0ba6"]]);export{he as default};
