import{_ as E,k as ae,g as W,v as A,h as b,o as S,l as $,w as l,b as e,i as _,a as c,p as R,f as te,r as V,s as oe,G as ne,c as de,e as F,H as ue,q as L,x as re,E as T}from"./index-Bwbtb0V1.js";import{a as se,e as ie,b as pe}from"./plpaichanjihua-Dut_nnxx.js";import{T as me,c as fe}from"./TuzhiInfoDialog-eiI5naJ0.js";import{g as ve}from"./department-D3nNq-Av.js";const ce={class:"plan-section"},ge={class:"form-section"},be={class:"form-section"},Ve={class:"form-section"},ye={class:"form-section"},_e={class:"form-section"},Ce={__name:"chakanjihuaForm",props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})}},emits:["update:visible","close"],setup(H,{emit:I}){const z=H,x=I,P=[{id:1,value:"生产计划"},{id:2,value:"采购计划"},{id:3,value:"销售计划"},{id:4,value:"其他计划"}],h=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],k=ae({get:()=>z.visible,set:f=>x("update:visible",f)}),t=W({id:void 0,purchaserHqCode:"",supplierCode:"",supplierName:"",poItemId:void 0,scheduleCode:"",gdItemId:void 0,woNo:"",ipoNo:"",contractNo:"",itemname:"",productModel:"",amount:"",unit:"",workshopName:"",provCoCode:"",provCoName:"",planPeriod:"",actualPeriod:"",schedule:"",dueDate:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",categoryCode:"",subclassCode:"",remark:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",type:"",status:"",flag:"",writer:"",isdelete:0}),p=f=>{const a=P.find(d=>d.id===f);return a?a.value:""},j=f=>{const a=h.find(d=>d.id===f);return a?a.value:""},y=f=>{if(!f)return"";try{const a=new Date(f);return isNaN(a.getTime())?"":a.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return""}},D=()=>{Object.assign(t,{id:void 0,purchaserHqCode:"",supplierCode:"",supplierName:"",poItemId:void 0,scheduleCode:"",gdItemId:void 0,woNo:"",ipoNo:"",contractNo:"",itemname:"",productModel:"",amount:"",unit:"",workshopName:"",provCoCode:"",provCoName:"",planPeriod:"",actualPeriod:"",schedule:"",dueDate:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",categoryCode:"",subclassCode:"",remark:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",type:"",status:"",flag:"",writer:"",isdelete:0})};A(()=>z.formData,f=>{f&&Object.keys(f).length>0&&Object.assign(t,f)},{immediate:!0,deep:!0});const w=()=>{x("close")};return(f,a)=>{const d=b("el-input"),r=b("el-form-item"),s=b("el-col"),v=b("el-row"),O=b("el-form"),U=b("el-button"),M=b("el-dialog");return S(),$(M,{title:"查看排产计划",modelValue:k.value,"onUpdate:modelValue":a[22]||(a[22]=n=>k.value=n),width:"1400px",onClosed:D},{footer:l(()=>[e(U,{onClick:w},{default:l(()=>a[29]||(a[29]=[_("关闭")])),_:1})]),default:l(()=>[c("div",ce,[a[28]||(a[28]=c("div",{class:"section-header"},[c("h3",null,"排产计划信息")],-1)),e(O,{model:t,"label-width":"120px",size:"small",class:"readonly-form"},{default:l(()=>[c("div",ge,[a[23]||(a[23]=c("div",{class:"section-title"},"基本信息",-1)),e(v,{gutter:10},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"采购方总部编码"},{default:l(()=>[e(d,{modelValue:t.purchaserHqCode,"onUpdate:modelValue":a[0]||(a[0]=n=>t.purchaserHqCode=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"计划类型"},{default:l(()=>[e(d,{value:p(t.type),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"排产计划编码"},{default:l(()=>[e(d,{modelValue:t.scheduleCode,"onUpdate:modelValue":a[1]||(a[1]=n=>t.scheduleCode=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:10},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"生产工单号"},{default:l(()=>[e(d,{modelValue:t.woNo,"onUpdate:modelValue":a[2]||(a[2]=n=>t.woNo=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"厂内合同号"},{default:l(()=>[e(d,{modelValue:t.contractNo,"onUpdate:modelValue":a[3]||(a[3]=n=>t.contractNo=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"生产订单号"},{default:l(()=>[e(d,{modelValue:t.ipoNo,"onUpdate:modelValue":a[4]||(a[4]=n=>t.ipoNo=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",be,[a[24]||(a[24]=c("div",{class:"section-title"},"物料信息",-1)),e(v,{gutter:10},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"物料名称"},{default:l(()=>[e(d,{modelValue:t.itemname,"onUpdate:modelValue":a[5]||(a[5]=n=>t.itemname=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"规格型号"},{default:l(()=>[e(d,{modelValue:t.productModel,"onUpdate:modelValue":a[6]||(a[6]=n=>t.productModel=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"数量"},{default:l(()=>[e(d,{modelValue:t.amount,"onUpdate:modelValue":a[7]||(a[7]=n=>t.amount=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:10},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"单位"},{default:l(()=>[e(d,{modelValue:t.unit,"onUpdate:modelValue":a[8]||(a[8]=n=>t.unit=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"生产车间"},{default:l(()=>[e(d,{modelValue:t.workshopName,"onUpdate:modelValue":a[9]||(a[9]=n=>t.workshopName=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",Ve,[a[25]||(a[25]=c("div",{class:"section-title"},"供应商信息",-1)),e(v,{gutter:10},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(r,{label:"供应商编码"},{default:l(()=>[e(d,{modelValue:t.supplierCode,"onUpdate:modelValue":a[10]||(a[10]=n=>t.supplierCode=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(r,{label:"供应商名称"},{default:l(()=>[e(d,{modelValue:t.supplierName,"onUpdate:modelValue":a[11]||(a[11]=n=>t.supplierName=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:10},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(r,{label:"省公司编码"},{default:l(()=>[e(d,{modelValue:t.provCoCode,"onUpdate:modelValue":a[12]||(a[12]=n=>t.provCoCode=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(r,{label:"省公司名称"},{default:l(()=>[e(d,{modelValue:t.provCoName,"onUpdate:modelValue":a[13]||(a[13]=n=>t.provCoName=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",ye,[a[26]||(a[26]=c("div",{class:"section-title"},"进度信息",-1)),e(v,{gutter:10},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"计划工期"},{default:l(()=>[e(d,{modelValue:t.planPeriod,"onUpdate:modelValue":a[14]||(a[14]=n=>t.planPeriod=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"实际工期"},{default:l(()=>[e(d,{modelValue:t.actualPeriod,"onUpdate:modelValue":a[15]||(a[15]=n=>t.actualPeriod=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"交付日期"},{default:l(()=>[e(d,{value:y(t.dueDate),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:10},{default:l(()=>[e(s,{span:6},{default:l(()=>[e(r,{label:"计划开始日期"},{default:l(()=>[e(d,{value:y(t.planStartDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:6},{default:l(()=>[e(r,{label:"计划完成日期"},{default:l(()=>[e(d,{value:y(t.planFinishDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:6},{default:l(()=>[e(r,{label:"实际开始日期"},{default:l(()=>[e(d,{value:y(t.actualStartDate),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:6},{default:l(()=>[e(r,{label:"实际完成日期"},{default:l(()=>[e(d,{value:y(t.actualFinishDate),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:10},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(r,{label:"进度"},{default:l(()=>[e(d,{modelValue:t.schedule,"onUpdate:modelValue":a[16]||(a[16]=n=>t.schedule=n),type:"textarea",rows:3,readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),c("div",_e,[a[27]||(a[27]=c("div",{class:"section-title"},"其他信息",-1)),e(v,{gutter:10},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"品类编码"},{default:l(()=>[e(d,{modelValue:t.categoryCode,"onUpdate:modelValue":a[17]||(a[17]=n=>t.categoryCode=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"种类编码"},{default:l(()=>[e(d,{modelValue:t.subclassCode,"onUpdate:modelValue":a[18]||(a[18]=n=>t.subclassCode=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"计划状态"},{default:l(()=>[e(d,{value:j(t.status),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:10},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(r,{label:"数据来源"},{default:l(()=>[e(d,{modelValue:t.dataSource,"onUpdate:modelValue":a[19]||(a[19]=n=>t.dataSource=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(r,{label:"来源创建时间"},{default:l(()=>[e(d,{value:y(t.dataSourceCreateTime),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),t.writer?(S(),$(v,{key:0,gutter:10},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(r,{label:"录入人"},{default:l(()=>[e(d,{modelValue:t.writer,"onUpdate:modelValue":a[20]||(a[20]=n=>t.writer=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):R("",!0),t.remark?(S(),$(v,{key:1,gutter:10},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(r,{label:"备注"},{default:l(()=>[e(d,{modelValue:t.remark,"onUpdate:modelValue":a[21]||(a[21]=n=>t.remark=n),type:"textarea",rows:3,readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):R("",!0)])]),_:1},8,["model"])])]),_:1},8,["modelValue"])}}},we=E(Ce,[["__scopeId","data-v-82cf999d"]]),Ne={class:"production-plan-management"},he={class:"action-bar"},ke={class:"pagination-container"},De={__name:"chakanjihua",setup(H){const I=te(),z=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],x=u=>{const o=z.find(N=>N.id===u);return o?o.value:"未知状态"},P=u=>{if(!u)return"";const o=new Date(u);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`},h=V(!1),k=V({}),t=async u=>{if(!u){T.error("暂未选择图纸");return}try{const o=await se({tuzhiId:u});console.log("获取图纸信息响应:",o),o.success?(k.value=o.data.tuzhiInfo,h.value=!0):T.error("获取图纸信息失败: "+o.msg)}catch(o){console.error("获取图纸信息失败:",o),T.error("获取图纸信息失败")}},p=W({contractNo:"",woNo:"",ipoNo:"",scheduleCode:"",pageNumber:1,pageSize:10,depNo:I.depNo}),j=V([]),y=V(0),D=V(!1),w=V(!1),f=V("add"),a=V({}),d=V(!1),r=V(""),s=V(""),v=()=>{console.log("关闭备料计划弹窗"),d.value=!1,s.value="",r.value=""},O=u=>{console.log("查看备料计划，row:",u),s.value=u.contractNo,r.value=u.gdItemId||"",d.value=!0},U=V([]),M=async()=>{try{const u=await ve();if(!u.success){console.error(u.msg);return}U.value=u.data.options||[]}catch{console.error("加载车间数据失败")}},n=u=>u?U.value.length===0?u:u.split(",").map(C=>{const q=C.trim(),B=U.value.find(m=>m.code===q);return B?B.name:C}).join(","):"",g=async()=>{D.value=!0;try{const u=await ie(p);console.log("获取排产计划列表响应:",u),j.value=u.data.page.list.map(o=>({...o,workshopName:n(o.workshopName)})),y.value=u.data.page.totalRow}catch(u){console.error("获取排产计划列表失败:",u),T.error("获取排产计划列表失败")}finally{D.value=!1}},G=u=>{p.pageSize=u,g()},J=u=>{p.pageNumber=u,g()},Y=()=>{p.contractNo="",p.woNo="",p.ipoNo="",p.scheduleCode="",p.pageNumber=1,g()},Q=async u=>{const o=await pe({id:u.id});a.value=o.data.plpaichanjihua,w.value=!0},X=()=>{console.log("表单取消"),w.value=!1};return A(w,(u,o)=>{o&&!u&&g()}),oe(()=>{console.log("页面初始化，加载排产计划列表"),M(),g()}),(u,o)=>{const N=b("el-input"),C=b("el-button"),q=b("Refresh"),B=b("el-icon"),m=b("el-table-column"),Z=b("el-table"),ee=b("el-pagination"),le=ne("loading");return S(),de("div",Ne,[c("div",he,[e(N,{modelValue:p.scheduleCode,"onUpdate:modelValue":o[0]||(o[0]=i=>p.scheduleCode=i),placeholder:"请输入排产计划号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:F(g,["enter"])},null,8,["modelValue"]),e(N,{modelValue:p.ipoNo,"onUpdate:modelValue":o[1]||(o[1]=i=>p.ipoNo=i),placeholder:"请输入生产订单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:F(g,["enter"])},null,8,["modelValue"]),e(N,{modelValue:p.woNo,"onUpdate:modelValue":o[2]||(o[2]=i=>p.woNo=i),placeholder:"请输入生产工单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:F(g,["enter"])},null,8,["modelValue"]),e(N,{modelValue:p.contractNo,"onUpdate:modelValue":o[3]||(o[3]=i=>p.contractNo=i),placeholder:"请输入厂内合同号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:g,onKeyup:F(g,["enter"])},null,8,["modelValue"]),e(C,{type:"primary",onClick:g},{default:l(()=>o[11]||(o[11]=[_("搜索")])),_:1}),e(C,{type:"warning",onClick:Y},{default:l(()=>[e(B,null,{default:l(()=>[e(q)]),_:1}),o[12]||(o[12]=_(" 刷新 "))]),_:1})]),ue((S(),$(Z,{data:j.value,border:"",style:{width:"100%"}},{default:l(()=>[e(m,{type:"index",label:"序号","min-width":"80"}),e(m,{prop:"scheduleCode",label:"排产计划号","min-width":"200"}),e(m,{prop:"contractNo",label:"合同编号","min-width":"120"}),e(m,{prop:"itemName",label:"物料名称","min-width":"150"}),e(m,{prop:"itemNo",label:"物料编号","min-width":"120"}),e(m,{prop:"spec",label:"物料型号","min-width":"120"}),e(m,{prop:"workshopName",label:"生产车间","min-width":"150"}),e(m,{prop:"conamount",label:"合同订货数","min-width":"100"}),e(m,{prop:"ddamount",label:"关联订单货数","min-width":"120"}),e(m,{prop:"gdamount",label:"关联工单货数","min-width":"120"}),e(m,{prop:"planStartDate",label:"计划开始日期","min-width":"180"},{default:l(({row:i})=>[_(L(P(i.planStartDate)),1)]),_:1}),e(m,{prop:"planFinishDate",label:"计划完成日期","min-width":"180"},{default:l(({row:i})=>[_(L(P(i.planFinishDate)),1)]),_:1}),e(m,{prop:"status",label:"计划状态","min-width":"120"},{default:l(({row:i})=>[_(L(x(i.status)),1)]),_:1}),e(m,{prop:"writer",label:"录入人","min-width":"100"}),e(m,{prop:"writetime",label:"录入时间","min-width":"120"}),e(m,{label:"操作","min-width":"350",fixed:"right"},{default:l(({row:i})=>[e(C,{type:"primary",size:"small",onClick:K=>Q(i)},{default:l(()=>o[13]||(o[13]=[_("查看排产计划详情")])),_:2},1032,["onClick"]),e(C,{type:"warning",size:"small",onClick:K=>t(i.noticetuzhiid)},{default:l(()=>o[14]||(o[14]=[_("查看图纸")])),_:2},1032,["onClick"]),e(C,{type:"info",size:"small",onClick:K=>O(i)},{default:l(()=>o[15]||(o[15]=[_("查看备料计划")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,D.value]]),c("div",ke,[e(ee,{"current-page":p.pageNumber,"onUpdate:currentPage":o[4]||(o[4]=i=>p.pageNumber=i),"page-size":p.pageSize,"onUpdate:pageSize":o[5]||(o[5]=i=>p.pageSize=i),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next,Jumper",total:y.value,onSizeChange:G,onCurrentChange:J},null,8,["current-page","page-size","total"])]),e(me,{visible:h.value,"onUpdate:visible":[o[6]||(o[6]=i=>h.value=i),o[7]||(o[7]=i=>h.value=i)],"tuzhi-info":k.value},null,8,["visible","tuzhi-info"]),e(we,{visible:w.value,"onUpdate:visible":o[8]||(o[8]=i=>w.value=i),type:f.value,"form-data":a.value,"dep-no":re(I).depNo,onCancel:X},null,8,["visible","type","form-data","dep-no"]),e(fe,{visible:d.value,"onUpdate:visible":[o[9]||(o[9]=i=>d.value=i),o[10]||(o[10]=i=>d.value=i)],contractno:s.value,gdItemId:r.value,onCancel:v},null,8,["visible","contractno","gdItemId"])])}}},xe=E(De,[["__scopeId","data-v-e4467324"]]);export{xe as default};
