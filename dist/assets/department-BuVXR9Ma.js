import{_ as L,g as x,r as c,k as P,s as G,h as m,G as H,o as w,c as O,a as k,b as t,e as J,w as n,i as p,H as Q,l as W,E as r,A as X}from"./index-Bwbtb0V1.js";import{a as Y,b as Z,d as ee,c as te,u as ae}from"./department-D3nNq-Av.js";const oe={class:"department-management"},le={class:"action-bar"},ne={class:"pagination-container"},se={__name:"department",setup(re){const s=x({departmentName:"",pageNumber:1,pageSize:10}),y=c([]),_=c(0),C=c(!1),g=c(!1),b=c("add"),z=P(()=>b.value==="add"?"新增部门":"编辑部门"),f=c(null),o=x({id:void 0,no:"",name:"",memo:"",type:"0",flag:0,status:0}),N={no:[{required:!0,message:"请输入部门编号",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],memo:[{max:200,message:"备注长度不能超过 200 个字符",trigger:"blur"}]},d=async()=>{C.value=!0;try{const l={...s};console.log("请求参数:",l);const e=await Y(l);console.log("后端返回数据:",e),e.success?(y.value=e.data.page.list,_.value=e.data.page.totalRow,console.log("部门列表:",y.value),console.log("总记录数:",_.value)):r.error(e.msg||"获取部门列表失败")}catch(l){console.error("获取部门列表失败:",l),r.error("获取部门列表失败")}finally{C.value=!1}},B=l=>{s.pageSize=l,s.pageNumber=1,console.log("分页大小变更:",s.pageSize),d()},D=l=>{s.pageNumber=l,console.log("当前页变更:",s.pageNumber),d()},S=()=>{f.value&&f.value.resetFields(),o.id=void 0,o.no="",o.name="",o.memo="",o.type="0",o.flag=0,o.status=0},U=()=>{b.value="add",g.value=!0},$=async l=>{b.value="edit";try{const e=await Z({id:l.id});console.log("获取部门信息:",e),e.success?(Object.assign(o,e.data.basDepartment),g.value=!0):r.error(e.msg||"获取部门信息失败")}catch(e){console.error("获取部门信息失败:",e),r.error("获取部门信息失败")}},R=l=>{X.confirm(`确认删除部门"${l.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ee({id:l.id});e.success?(r.success("删除成功"),d()):r.error(e.msg||"删除部门失败")}catch(e){console.error("删除部门失败:",e),r.error("删除部门失败")}}).catch(()=>{})},E=()=>{s.departmentName="",s.pageNumber=1,d()},T=()=>{f.value&&f.value.validate(async l=>{if(l)try{const e={...o};if(console.log("提交表单数据:",e),b.value==="add"){const i=await te(e);i.success?r.success("新增成功"):r.error(i.msg||"新增部门失败")}else{const i=await ae(e);i.success?r.success("修改成功"):r.error(i.msg||"修改部门失败")}g.value=!1,d()}catch(e){console.error("保存部门失败:",e),r.error("保存部门失败")}})};return G(()=>{d()}),(l,e)=>{const i=m("el-input"),u=m("el-button"),F=m("Refresh"),q=m("el-icon"),v=m("el-table-column"),M=m("el-table"),h=m("el-pagination"),V=m("el-form-item"),j=m("el-form"),A=m("el-dialog"),I=H("loading");return w(),O("div",oe,[k("div",le,[t(i,{modelValue:s.departmentName,"onUpdate:modelValue":e[0]||(e[0]=a=>s.departmentName=a),placeholder:"请输入部门名称搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:e[1]||(e[1]=a=>d()),onKeyup:e[2]||(e[2]=J(a=>d(),["enter"]))},null,8,["modelValue"]),t(u,{type:"primary",onClick:e[3]||(e[3]=a=>d())},{default:n(()=>e[11]||(e[11]=[p("搜索")])),_:1}),t(u,{type:"warning",onClick:E},{default:n(()=>[t(q,null,{default:n(()=>[t(F)]),_:1}),e[12]||(e[12]=p(" 刷新 "))]),_:1}),t(u,{type:"primary",style:{"margin-left":"auto"},onClick:U},{default:n(()=>e[13]||(e[13]=[p("新增部门")])),_:1})]),Q((w(),W(M,{data:y.value,border:"",style:{width:"100%"}},{default:n(()=>[t(v,{type:"index",label:"序号",width:"80"}),t(v,{prop:"no",label:"部门编号"}),t(v,{prop:"name",label:"部门名称"}),t(v,{prop:"memo",label:"备注"}),t(v,{label:"操作",width:"180"},{default:n(({row:a})=>[t(u,{type:"primary",size:"small",onClick:K=>$(a)},{default:n(()=>e[14]||(e[14]=[p("编辑")])),_:2},1032,["onClick"]),t(u,{type:"danger",size:"small",onClick:K=>R(a)},{default:n(()=>e[15]||(e[15]=[p("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,C.value]]),k("div",ne,[t(h,{"current-page":s.pageNumber,"onUpdate:currentPage":e[4]||(e[4]=a=>s.pageNumber=a),"page-size":s.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>s.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:_.value,onSizeChange:B,onCurrentChange:D},null,8,["current-page","page-size","total"])]),t(A,{title:z.value,modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=a=>g.value=a),width:"500px",onClosed:S},{footer:n(()=>[t(u,{onClick:e[9]||(e[9]=a=>g.value=!1)},{default:n(()=>e[16]||(e[16]=[p("取消")])),_:1}),t(u,{type:"primary",onClick:T},{default:n(()=>e[17]||(e[17]=[p("确定")])),_:1})]),default:n(()=>[t(j,{ref_key:"formRef",ref:f,model:o,rules:N,"label-width":"80px"},{default:n(()=>[t(V,{label:"部门编号",prop:"no"},{default:n(()=>[t(i,{modelValue:o.no,"onUpdate:modelValue":e[6]||(e[6]=a=>o.no=a),placeholder:"请输入部门编号"},null,8,["modelValue"])]),_:1}),t(V,{label:"部门名称",prop:"name"},{default:n(()=>[t(i,{modelValue:o.name,"onUpdate:modelValue":e[7]||(e[7]=a=>o.name=a),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),t(V,{label:"备注",prop:"memo"},{default:n(()=>[t(i,{modelValue:o.memo,"onUpdate:modelValue":e[8]||(e[8]=a=>o.memo=a),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},de=L(se,[["__scopeId","data-v-c51a6eb7"]]);export{de as default};
