import{_ as le,f as he,g as W,k as Q,r as z,s as te,h as b,G as me,o as T,c as O,a as S,b as e,e as oe,w as l,i as x,x as pe,a6 as ce,H as ge,l as X,F as ze,m as we,q as Z,E as $,B as xe,v as re,af as ne,p as ee,A as Ue}from"./index-Bwbtb0V1.js";import{u as Ce,g as Ne}from"./tongzhi-CcYQq5I0.js";import{g as ke}from"./bascontract-KulZMAIs.js";import{g as Se}from"./tuzhi-XIzDD3YS.js";import{g as De,s as qe}from"./beiliaodan-2Bn9qyYh.js";import{u as fe}from"./term-BqpDPAMp.js";const je={class:"tuzhi-management"},Ye={class:"action-bar"},Me=["onClick"],$e={class:"pagination-container"},Te={__name:"tongzhituzhi",emits:["selectTuzhi"],setup(G,{emit:P}){const k=P,f=he(),v=W({pageNumber:1,pageSize:10,tuzhimingcheng:""});Q(()=>({username:f.username||"未登录"}));const B=z([]),U=z(0),n=z(!1),D=async()=>{n.value=!0;try{const h=await Se(v);B.value=h.data.page.list,U.value=h.data.page.totalRow}catch(h){console.error("获取图纸列表失败",h),$.error("获取图纸列表失败")}finally{n.value=!1}},d=h=>{v.pageSize=h,D()},C=h=>{v.pageNumber=h,D()},q=h=>{console.log("选中的图纸:",h),$.success(`已选择图纸: ${h.tuzhimingcheng}`),k("selectTuzhi",h)},M=(h,w)=>{const F=h.startsWith("http")?h:xe+h,y=w.split(".").pop().toLowerCase();if(["jpg","jpeg","png","pdf"].includes(y))window.open(F,"_blank");else{const r=document.createElement("a");r.href=F,r.download=w,r.style.display="none",document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r)},100)}},s=()=>{v.tuzhimingcheng="",v.pageNumber=1,D()};return te(()=>{D()}),(h,w)=>{const F=b("el-input"),y=b("el-button"),o=b("el-icon"),r=b("el-table-column"),m=b("el-table"),_=b("el-pagination"),j=me("loading");return T(),O("div",je,[S("div",Ye,[e(F,{modelValue:v.tuzhimingcheng,"onUpdate:modelValue":w[0]||(w[0]=N=>v.tuzhimingcheng=N),placeholder:"请输入图纸名称搜索",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:D,onKeyup:oe(D,["enter"])},null,8,["modelValue"]),e(y,{type:"primary",onClick:D},{default:l(()=>w[3]||(w[3]=[x("搜索")])),_:1}),e(y,{type:"warning",onClick:s},{default:l(()=>[e(o,null,{default:l(()=>[e(pe(ce))]),_:1}),w[4]||(w[4]=x(" 刷新 "))]),_:1})]),ge((T(),X(m,{data:B.value,border:"",style:{width:"100%"}},{default:l(()=>[e(r,{type:"index",label:"序号",width:"80"}),e(r,{prop:"tuzhibianhao",label:"图纸编号"}),e(r,{prop:"tuzhimingcheng",label:"图纸名称"}),e(r,{prop:"tuzhizuozhe",label:"图纸作者"}),e(r,{prop:"chuangzuoriqi",label:"创作日期"}),e(r,{prop:"tuzhimiaoshu",label:"图纸描述"}),e(r,{label:"图纸文件"},{default:l(({row:N})=>[(T(!0),O(ze,null,we(JSON.parse(N.tuzhiurl||"[]"),(g,A)=>(T(),O("div",{key:A},[S("span",{class:"file-link",onClick:K=>M(g.url,g.name)},Z(g.name),9,Me)]))),128))]),_:1}),e(r,{prop:"memo",label:"备注"}),e(r,{prop:"writer",label:"录入者"}),e(r,{label:"操作",width:"100"},{default:l(({row:N})=>[e(y,{type:"primary",size:"small",onClick:g=>q(N)},{default:l(()=>w[5]||(w[5]=[x("选择")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,n.value]]),S("div",$e,[e(_,{"current-page":v.pageNumber,"onUpdate:currentPage":w[1]||(w[1]=N=>v.pageNumber=N),"page-size":v.pageSize,"onUpdate:pageSize":w[2]||(w[2]=N=>v.pageSize=N),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:U.value,onSizeChange:d,onCurrentChange:C},null,8,["current-page","page-size","total"])])])}}},Fe=le(Te,[["__scopeId","data-v-994c7397"]]),Ie={class:"beiliaodan-container"},Be={class:"dialog-footer"},Ee={__name:"beiliaodan",props:{noticeid:{type:String,required:!0},noticedrawno:{type:String,required:!0},contractno:{type:String,required:!0},contractname:{type:String,required:!0}},emits:["close"],setup(G,{emit:P}){const k=G,f=W({noticeid:k.noticeid,noticedrawno:k.noticedrawno,contractno:k.contractno,contractname:k.contractname,pageNumber:1,pageSize:10}),v=z([]),B=z(0),U=z(!1),n=W({}),D=z(null),d=z(-1),C={sxclshuliang:[{required:!0,message:"请输入所需材料数量",trigger:"blur"}],sxclshijishuliang:[{required:!0,message:"请输入实际备料数量",trigger:"blur"}],sxclcaizhi:[{required:!0,message:"请输入材质",trigger:"blur"}],zhidingbumen:[{required:!0,message:"请输入制定部门",trigger:"blur"}],zhidingriqi:[{required:!0,message:"请选择制定日期",trigger:"change"}],tiliaoshijian:[{required:!0,message:"请选择提料时间",trigger:"change"}],jiaohuoshijian:[{required:!0,message:"请选择交货时间",trigger:"change"}],bianzhiren:[{required:!0,message:"请输入编制人",trigger:"blur"}],jiaoyanren:[{required:!0,message:"请输入校验人",trigger:"blur"}],shenheren:[{required:!0,message:"请输入审核人",trigger:"blur"}]},q=()=>{n.dinghuotaoshu&&n.sxclshuliang&&(n.sxcltihuoshuliang=n.dinghuotaoshu*n.sxclshuliang)},M=async()=>{let y=null;try{y=ne.service({lock:!0,text:"加载数据中...",background:"rgba(0, 0, 0, 0.7)"});const o=await De(f);o.success?(v.value=o.data.page.list||[],B.value=o.data.page.totalRow||0):$.error(o.msg||"获取备料计划失败")}catch(o){$.error("获取备料计划失败: "+o.message),console.error("获取备料计划失败",o)}finally{y==null||y.close()}},s=y=>{f.pageSize=y,M()},h=y=>{f.pageNumber=y,M()},w=y=>{Object.assign(n,y),(!n.bianzhiren||n.bianzhiren.trim()==="")&&(n.bianzhiren=localStorage.getItem("realName")),(!n.zhidingbumen||n.zhidingbumen.trim()==="")&&(n.zhidingbumen="研究所"),q(),d.value=v.value.findIndex(o=>o.id===y.id),U.value=!0},F=async()=>{D.value.validate(async y=>{if(y){let o=null;try{o=ne.service({lock:!0,text:"保存中...",background:"rgba(0, 0, 0, 0.7)"});const r={...n,noticeid:k.noticeid,noticedrawno:k.noticedrawno},m=await qe(r);m.success?($.success("保存成功"),U.value=!1,M()):$.error(m.msg||"保存失败")}catch(r){$.error("保存失败: "+r.message),console.error("保存失败",r)}finally{o==null||o.close()}}else return $.error("请检查表单信息"),!1})};return re(()=>[k.noticeid,k.noticedrawno],y=>{f.noticeid=y[0],f.noticedrawno=y[1],M()},{immediate:!0}),te(()=>{M()}),(y,o)=>{const r=b("el-input"),m=b("el-form-item"),_=b("el-col"),j=b("el-row"),N=b("el-form"),g=b("el-table-column"),A=b("el-button"),K=b("el-table"),H=b("el-pagination"),I=b("el-date-picker"),J=b("el-dialog");return T(),O("div",Ie,[e(N,{model:f,size:"small","label-width":"80px",class:"search-form"},{default:l(()=>[e(j,{gutter:12},{default:l(()=>[e(_,{span:6},{default:l(()=>[e(m,{label:"通知编号"},{default:l(()=>[e(r,{modelValue:f.noticeid,"onUpdate:modelValue":o[0]||(o[0]=u=>f.noticeid=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"图纸编号"},{default:l(()=>[e(r,{modelValue:f.noticedrawno,"onUpdate:modelValue":o[1]||(o[1]=u=>f.noticedrawno=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"合同编号"},{default:l(()=>[e(r,{modelValue:f.contractno,"onUpdate:modelValue":o[2]||(o[2]=u=>f.contractno=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"工程名称"},{default:l(()=>[e(r,{modelValue:f.contractname,"onUpdate:modelValue":o[3]||(o[3]=u=>f.contractname=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(K,{data:v.value,border:"",size:"small",style:{width:"100%"}},{default:l(()=>[e(g,{prop:"itemno",label:"订货产品编码"}),e(g,{prop:"spec",label:"订货产品型号"}),e(g,{prop:"name",label:"订货产品名称"}),e(g,{prop:"unit",label:"订货产品单位"}),e(g,{prop:"dinghuotaoshu",label:"订货套数"}),e(g,{prop:"sxclitemno",label:"所需子材料编码"}),e(g,{prop:"sxclname",label:"所需子材料名称"}),e(g,{prop:"unit",label:"单位"}),e(g,{prop:"sxclshuliang",label:"所需材料数量"}),e(g,{prop:"sxcltihuoshuliang",label:"子材料数量"}),e(g,{prop:"sxclshijishuliang",label:"实际备货数量"}),e(g,{prop:"sxclcaizhi",label:"材质"}),e(g,{prop:"zhidingbumen",label:"制定部门"}),e(g,{prop:"zhidingriqi",label:"制定日期"}),e(g,{prop:"tiliaoshijian",label:"提料时间"}),e(g,{prop:"jiaohuoshijian",label:"交货时间"}),e(g,{prop:"memo",label:"备注"}),e(g,{prop:"bianzhiren",label:"编制人"}),e(g,{prop:"jiaoyanren",label:"校验人"}),e(g,{prop:"shenheren",label:"审核人"}),e(g,{label:"操作",width:"100",fixed:"right"},{default:l(u=>[e(A,{size:"small",type:"primary",onClick:E=>w(u.row)},{default:l(()=>o[24]||(o[24]=[x("编辑")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(H,{onSizeChange:s,onCurrentChange:h,"current-page":f.pageNumber,"page-sizes":[10,20,50,100],"page-size":f.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:B.value},null,8,["current-page","page-size","total"]),e(J,{modelValue:U.value,"onUpdate:modelValue":o[23]||(o[23]=u=>U.value=u),title:"编辑备料计划",width:"70%"},{footer:l(()=>[S("div",Be,[e(A,{onClick:o[22]||(o[22]=u=>U.value=!1)},{default:l(()=>o[25]||(o[25]=[x("取消")])),_:1}),e(A,{type:"primary",onClick:F},{default:l(()=>o[26]||(o[26]=[x("保存")])),_:1})])]),default:l(()=>[e(N,{ref_key:"editFormRef",ref:D,model:n,rules:C,"label-width":"100px",size:"small"},{default:l(()=>[e(j,{gutter:12},{default:l(()=>[e(_,{span:6},{default:l(()=>[e(m,{label:"合同编号"},{default:l(()=>[e(r,{modelValue:n.contractno,"onUpdate:modelValue":o[4]||(o[4]=u=>n.contractno=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"工程名称"},{default:l(()=>[e(r,{modelValue:n.contractname,"onUpdate:modelValue":o[5]||(o[5]=u=>n.contractname=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"通知编号"},{default:l(()=>[e(r,{modelValue:n.noticeid,"onUpdate:modelValue":o[6]||(o[6]=u=>n.noticeid=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"订货物料编码"},{default:l(()=>[e(r,{modelValue:n.itemno,"onUpdate:modelValue":o[7]||(o[7]=u=>n.itemno=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:12},{default:l(()=>[e(_,{span:6},{default:l(()=>[e(m,{label:"所需子材料编码"},{default:l(()=>[e(r,{modelValue:n.sxclitemno,"onUpdate:modelValue":o[8]||(o[8]=u=>n.sxclitemno=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"所需材料名称"},{default:l(()=>[e(r,{modelValue:n.sxclname,"onUpdate:modelValue":o[9]||(o[9]=u=>n.sxclname=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"单位"},{default:l(()=>[e(r,{modelValue:n.unit,"onUpdate:modelValue":o[10]||(o[10]=u=>n.unit=u),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"订货套数"},{default:l(()=>[e(r,{modelValue:n.dinghuotaoshu,"onUpdate:modelValue":o[11]||(o[11]=u=>n.dinghuotaoshu=u),modelModifiers:{number:!0},readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:12},{default:l(()=>[e(_,{span:6},{default:l(()=>[e(m,{label:"所需材料数量",prop:"sxclshuliang"},{default:l(()=>[e(r,{modelValue:n.sxclshuliang,"onUpdate:modelValue":o[12]||(o[12]=u=>n.sxclshuliang=u),modelModifiers:{number:!0},onChange:q},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"计划提货数量",prop:"sxcltihuoshuliang"},{default:l(()=>[e(r,{modelValue:n.sxcltihuoshuliang,"onUpdate:modelValue":o[13]||(o[13]=u=>n.sxcltihuoshuliang=u),modelModifiers:{number:!0},readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"实际提货数量",prop:"sxclshijishuliang"},{default:l(()=>[e(r,{modelValue:n.sxclshijishuliang,"onUpdate:modelValue":o[14]||(o[14]=u=>n.sxclshijishuliang=u)},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"材质",prop:"sxclcaizhi"},{default:l(()=>[e(r,{modelValue:n.sxclcaizhi,"onUpdate:modelValue":o[15]||(o[15]=u=>n.sxclcaizhi=u)},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"制定部门",prop:"zhidingbumen"},{default:l(()=>[e(r,{modelValue:n.zhidingbumen,"onUpdate:modelValue":o[16]||(o[16]=u=>n.zhidingbumen=u)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:12},{default:l(()=>[e(_,{span:6},{default:l(()=>[e(m,{label:"制定日期",prop:"zhidingriqi"},{default:l(()=>[e(I,{modelValue:n.zhidingriqi,"onUpdate:modelValue":o[17]||(o[17]=u=>n.zhidingriqi=u),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"提料时间",prop:"tiliaoshijian"},{default:l(()=>[e(I,{modelValue:n.tiliaoshijian,"onUpdate:modelValue":o[18]||(o[18]=u=>n.tiliaoshijian=u),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"交货时间",prop:"jiaohuoshijian"},{default:l(()=>[e(I,{modelValue:n.jiaohuoshijian,"onUpdate:modelValue":o[19]||(o[19]=u=>n.jiaohuoshijian=u),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:l(()=>[e(m,{label:"编制人",prop:"bianzhiren"},{default:l(()=>[e(r,{modelValue:n.bianzhiren,"onUpdate:modelValue":o[20]||(o[20]=u=>n.bianzhiren=u)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:12},{default:l(()=>[e(_,{span:12},{default:l(()=>[e(m,{label:"备注",prop:"memo"},{default:l(()=>[e(r,{type:"textarea",rows:3,modelValue:n.memo,"onUpdate:modelValue":o[21]||(o[21]=u=>n.memo=u)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Le=le(Ee,[["__scopeId","data-v-fff3075d"]]),Re={class:"contract-form"},Pe={style:{display:"flex","justify-content":"center"}},Ae={class:"card-header"},Oe={class:"summary-info"},Ke={style:{margin:"0 20px"}},We={key:0,class:"empty-product"},Ge={class:"dialog-footer"},He={__name:"TongzhiForm",props:{contractNo:{type:String,default:""}},emits:["close"],setup(G,{emit:P}){const k=fe(),f=k.term;k.terms,console.log("当前区间为就是iscurrent为1的区间",f);const v=G,B=P,U=z(!1),n=Q(()=>!!v.contractNo),D=z(null),d=W({no:"",userid:"",term:f,salesmanid:null,salesmanName:"",agent:"",other:`提出异议期限：
结算方式及付款期限：
备品、配件、工具供应办法：
违约责任：
因本合同发生纠纷调解不成是，应在（）人民法院进行诉讼
其他违约事项：`,casingcost:1,transcost:1,destination:"",bank:"",checktype:"",postalcode:"",fax:"",bankcode:"",pressurestage:0,receiver:"",transtype:"",picktype:"",telephone:"",itemsenddate:"",contractSum:0,name:"",customerid:null,customerName:"",legalrepresent:"",taxnum:"",signdate:""}),C=z([]),q=z(!1),M=z(null),s=W({itemNo:"",itemName:"",itemSpec:"",itemnum:0,itemunit:"",noticeid:"",noticedrawno:"",noticeinstead:"",noticename:"",noticecomment:"",noticeauther:"",noticebuilddate:""}),h=z(-1),w={noticeid:[{required:!0,message:"请输入通知编号",trigger:"blur"}],noticedrawno:[{required:!0,message:"请选择图纸编号",trigger:"blur"}],noticeinstead:[{required:!0,message:"请输入替代型号",trigger:"blur"}],noticename:[{required:!0,message:"请输入通知名称",trigger:"blur"}],noticecomment:[{required:!0,message:"请输入通知备注",trigger:"blur"}],noticeauther:[{required:!0,message:"请输入通知作者",trigger:"blur"}],noticebuilddate:[{required:!0,message:"请选择通知制定日期",trigger:"change"}]},F=(V,t=null)=>C.value.reduce((i,p)=>{const c=p[V]??(t?p[t]:0);return i+(Number(c)||0)},0),y=Q(()=>F("itemsum")),o=Q(()=>F("itemgrossweight")),r={no:[{required:!0,message:"请输入合同号",trigger:"blur"}],gridno:[{required:!0,message:"请输入电网编号",trigger:"blur"}],name:[{required:!0,message:"请输入工程名称",trigger:"blur"}],salesmanid:[{required:!0,message:"请选择销售员",trigger:"change"}],customerid:[{required:!0,message:"请选择客户",trigger:"change"}],signdate:[{required:!0,message:"请选择签定时间",trigger:"change"}],term:[{required:!0,message:"请选择合同所属期间",trigger:"change"}]},m=(V,t,i)=>{if(!i)return"";const p=new Date(i),c=p.getFullYear(),L=String(p.getMonth()+1).padStart(2,"0"),R=String(p.getDate()).padStart(2,"0");return`${c}-${L}-${R}`},_=async()=>{if(v.contractNo)try{const V=await ke({contractNo:v.contractNo}),{contractInfo:t,itemList:i}=V.data;Object.assign(d,t||{}),C.value=i||[]}catch(V){$.error("加载合同数据失败"),console.error("加载合同数据失败",V)}finally{U.value=!0}},j=V=>({1:"供方",2:"需方",3:"各半",400:"其他"})[V]||V,N=V=>({1:"供方",2:"需方",3:"各半",400:"其他"})[V]||V,g=()=>{B("close")},A=()=>{const V=new Date,t=V.getFullYear(),i=String(V.getMonth()+1).padStart(2,"0"),p=String(V.getDate()).padStart(2,"0");return`${t}-${i}-${p}`},K=async V=>{console.log("打开编辑对话框",V),Object.assign(s,V),(!s.noticeid||s.noticeid==="N/A")&&(s.noticeid=v.contractNo),(!s.noticename||s.noticename==="N/A")&&(s.noticename=d.name),(!s.noticeauther||s.noticeauther.trim()===""||s.noticeauther==="N/A")&&(s.noticeauther=localStorage.getItem("realName")),s.noticebuilddate||(s.noticebuilddate=A()),h.value=C.value.findIndex(t=>t.id===V.id),q.value=!0,console.log("对话框状态:",q.value)},H=async()=>{M.value.validate(async V=>{if(V){let t=null;try{t=ne.service({lock:!0,text:"正在保存产品信息...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});const i={...C.value[h.value],...s,noticestatus:10};await Ce(i),Object.assign(C.value[h.value],i),$.success("产品信息更新成功"),q.value=!1}catch(i){$.error("更新产品信息失败: "+i.message),console.error("更新产品信息失败",i)}finally{t&&t.close()}}else return $.error("请检查表单信息"),!1})},I=z(!1),J=()=>{I.value=!0},u=V=>{s.noticedrawno=V.tuzhibianhao,s.noticetuzhiid=V.id,I.value=!1},E=z(!1),ue=z(""),de=z(""),be=V=>{ue.value=V.noticeid,de.value=V.noticedrawno,E.value=!0};return re(()=>v.contractNo,V=>{V?_():U.value=!0},{immediate:!0}),te(()=>{v.contractNo||(U.value=!0)}),(V,t)=>{const i=b("el-input"),p=b("el-form-item"),c=b("el-col"),L=b("el-row"),R=b("el-button"),ie=b("el-card"),Y=b("el-table-column"),Ve=b("el-table"),se=b("el-form"),_e=b("el-input-number"),ye=b("el-date-picker"),ae=b("el-dialog");return T(),O("div",Re,[U.value?(T(),X(se,{key:0,ref_key:"formRef",ref:D,model:d,rules:r,"label-width":"80px",size:"small"},{default:l(()=>[e(ie,{class:"form-card",shadow:"never"},{header:l(()=>t[44]||(t[44]=[S("span",{class:"card-title"},"合同信息",-1)])),default:l(()=>[e(L,{gutter:12},{default:l(()=>[e(c,{span:3},{default:l(()=>[e(p,{label:"合同号"},{default:l(()=>[e(i,{modelValue:d.no,"onUpdate:modelValue":t[0]||(t[0]=a=>d.no=a),placeholder:"合同号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:l(()=>[e(p,{label:"工程名称"},{default:l(()=>[e(i,{modelValue:d.name,"onUpdate:modelValue":t[1]||(t[1]=a=>d.name=a),placeholder:"工程名称",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"电网编号"},{default:l(()=>[e(i,{modelValue:d.gridno,"onUpdate:modelValue":t[2]||(t[2]=a=>d.gridno=a),modelModifiers:{number:!0},placeholder:"电网编号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"签定时间"},{default:l(()=>[e(i,{modelValue:d.signdate,"onUpdate:modelValue":t[3]||(t[3]=a=>d.signdate=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"销售员"},{default:l(()=>[e(i,{modelValue:d.salesmanName,"onUpdate:modelValue":t[4]||(t[4]=a=>d.salesmanName=a),placeholder:"销售员",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"客户"},{default:l(()=>[e(i,{modelValue:d.customerName,"onUpdate:modelValue":t[5]||(t[5]=a=>d.customerName=a),placeholder:"客户",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{gutter:12},{default:l(()=>[e(c,{span:4},{default:l(()=>[e(p,{label:"客户代理人"},{default:l(()=>[e(i,{modelValue:d.agent,"onUpdate:modelValue":t[6]||(t[6]=a=>d.agent=a),placeholder:"客户代理人",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"法定代表人"},{default:l(()=>[e(i,{modelValue:d.legalrepresent,"onUpdate:modelValue":t[7]||(t[7]=a=>d.legalrepresent=a),placeholder:"法定代表人",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"税务号"},{default:l(()=>[e(i,{modelValue:d.taxnum,"onUpdate:modelValue":t[8]||(t[8]=a=>d.taxnum=a),placeholder:"税务号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"交货时间"},{default:l(()=>[e(i,{modelValue:d.itemsenddate,"onUpdate:modelValue":t[9]||(t[9]=a=>d.itemsenddate=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"到货地点"},{default:l(()=>[e(i,{modelValue:d.destination,"onUpdate:modelValue":t[10]||(t[10]=a=>d.destination=a),placeholder:"到货地点",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"接货人"},{default:l(()=>[e(i,{modelValue:d.receiver,"onUpdate:modelValue":t[11]||(t[11]=a=>d.receiver=a),placeholder:"接货人",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{gutter:12},{default:l(()=>[e(c,{span:3},{default:l(()=>[e(p,{label:"运输方式"},{default:l(()=>[e(i,{modelValue:d.transtype,"onUpdate:modelValue":t[12]||(t[12]=a=>d.transtype=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"交提货方式"},{default:l(()=>[e(i,{modelValue:d.picktype,"onUpdate:modelValue":t[13]||(t[13]=a=>d.picktype=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"验收方式"},{default:l(()=>[e(i,{modelValue:d.checktype,"onUpdate:modelValue":t[14]||(t[14]=a=>d.checktype=a),placeholder:"验收方式",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"包装费承担"},{default:l(()=>[e(i,{value:j(d.casingcost),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"运费承担"},{default:l(()=>[e(i,{value:N(d.transcost),readonly:""},null,8,["value"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"电压等级"},{default:l(()=>[e(i,{modelValue:d.pressurestage,"onUpdate:modelValue":t[15]||(t[15]=a=>d.pressurestage=a),modelModifiers:{number:!0},placeholder:"电压等级(KV)",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"客户电话"},{default:l(()=>[e(i,{modelValue:d.telephone,"onUpdate:modelValue":t[16]||(t[16]=a=>d.telephone=a),placeholder:"客户电话",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:3},{default:l(()=>[e(p,{label:"客户传真"},{default:l(()=>[e(i,{modelValue:d.fax,"onUpdate:modelValue":t[17]||(t[17]=a=>d.fax=a),placeholder:"客户传真",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{gutter:12},{default:l(()=>[e(c,{span:4},{default:l(()=>[e(p,{label:"邮政编码"},{default:l(()=>[e(i,{modelValue:d.postalcode,"onUpdate:modelValue":t[18]||(t[18]=a=>d.postalcode=a),placeholder:"邮政编码",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:5},{default:l(()=>[e(p,{label:"开户银行"},{default:l(()=>[e(i,{modelValue:d.bank,"onUpdate:modelValue":t[19]||(t[19]=a=>d.bank=a),placeholder:"开户银行",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:5},{default:l(()=>[e(p,{label:"账号"},{default:l(()=>[e(i,{modelValue:d.bankcode,"onUpdate:modelValue":t[20]||(t[20]=a=>d.bankcode=a),placeholder:"账号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:5},{default:l(()=>[e(p,{label:"期间"},{default:l(()=>[e(i,{modelValue:d.term,"onUpdate:modelValue":t[21]||(t[21]=a=>d.term=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,null,{default:l(()=>[e(c,{span:10,style:{"text-align":"center"}},{default:l(()=>[e(p,{label:"其他条款"},{default:l(()=>[e(i,{type:"textarea",rows:7,modelValue:d.other,"onUpdate:modelValue":t[22]||(t[22]=a=>d.other=a),placeholder:"其他条款",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:10,style:{"text-align":"center"}},{default:l(()=>[e(p,{label:"备注"},{default:l(()=>[e(i,{type:"textarea",rows:7,modelValue:d.memo,"onUpdate:modelValue":t[23]||(t[23]=a=>d.memo=a),placeholder:"备注",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S("div",Pe,[e(R,{type:"primary",onClick:g},{default:l(()=>t[45]||(t[45]=[x("关闭")])),_:1})])]),_:1}),n.value?(T(),X(ie,{key:0,class:"form-card",shadow:"never"},{header:l(()=>[S("div",Ae,[t[46]||(t[46]=S("span",{class:"card-title"},"产品信息",-1)),S("div",Oe,[S("span",null,"总金额: ¥"+Z(y.value.toFixed(2)),1),S("span",Ke,"总重量: "+Z(o.value.toFixed(2))+"kg",1)])])]),default:l(()=>[e(Ve,{data:C.value,border:"",size:"small",style:{width:"100%"}},{default:l(()=>[e(Y,{prop:"noticeid",label:"通知编号","min-width":"60"}),e(Y,{prop:"id",label:"产品id",width:"30"}),e(Y,{prop:"itemNo",label:"产品编号",width:"120"}),e(Y,{prop:"itemName",label:"产品名称","min-width":"50"}),e(Y,{prop:"itemSpec",label:"规格型号","min-width":"30"}),e(Y,{prop:"itemnum",label:"数量","min-width":"30"}),e(Y,{prop:"itemunit",label:"单位","min-width":"20"}),e(Y,{prop:"noticedrawno",label:"图纸编号","min-width":"50"}),e(Y,{prop:"noticeinstead",label:"替代型号","min-width":"30"}),e(Y,{prop:"noticename",label:"通知名称","min-width":"60"}),e(Y,{prop:"noticeauther",label:"作者","min-width":"60"}),e(Y,{prop:"noticebuilddate",label:"日期","min-width":"60",formatter:m}),e(Y,{prop:"noticecomment",label:"通知备注","min-width":"60"}),e(Y,{label:"操作",width:"200"},{default:l(a=>[e(R,{size:"small",type:"primary",onClick:ve=>K(a.row)},{default:l(()=>t[47]||(t[47]=[x("制定通知")])),_:2},1032,["onClick"]),e(R,{size:"small",type:"success",onClick:ve=>be(a.row)},{default:l(()=>t[48]||(t[48]=[x("制定备料计划")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),C.value.length===0?(T(),O("div",We,t[49]||(t[49]=[S("p",null,"暂无产品信息",-1)]))):ee("",!0)]),_:1})):ee("",!0)]),_:1},8,["model"])):ee("",!0),e(ae,{modelValue:q.value,"onUpdate:modelValue":t[38]||(t[38]=a=>q.value=a),title:"编辑产品信息",width:"80%"},{footer:l(()=>[S("div",Ge,[e(R,{onClick:t[37]||(t[37]=a=>q.value=!1)},{default:l(()=>t[51]||(t[51]=[x("取消")])),_:1}),e(R,{type:"primary",onClick:H},{default:l(()=>t[52]||(t[52]=[x("保存")])),_:1})])]),default:l(()=>[e(se,{ref_key:"editFormRef",ref:M,model:s,rules:w,"label-width":"80px",size:"small"},{default:l(()=>[e(L,{gutter:12},{default:l(()=>[e(c,{span:4},{default:l(()=>[e(p,{label:"产品编号",prop:"itemNo"},{default:l(()=>[e(i,{modelValue:s.itemNo,"onUpdate:modelValue":t[24]||(t[24]=a=>s.itemNo=a),placeholder:"产品编号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"产品名称",prop:"itemName"},{default:l(()=>[e(i,{modelValue:s.itemName,"onUpdate:modelValue":t[25]||(t[25]=a=>s.itemName=a),placeholder:"产品名称",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"规格型号",prop:"itemSpec"},{default:l(()=>[e(i,{modelValue:s.itemSpec,"onUpdate:modelValue":t[26]||(t[26]=a=>s.itemSpec=a),placeholder:"规格型号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"数量",prop:"itemnum"},{default:l(()=>[e(_e,{modelValue:s.itemnum,"onUpdate:modelValue":t[27]||(t[27]=a=>s.itemnum=a),modelModifiers:{number:!0},placeholder:"数量",min:1,readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"单位",prop:"itemunit"},{default:l(()=>[e(i,{modelValue:s.itemunit,"onUpdate:modelValue":t[28]||(t[28]=a=>s.itemunit=a),placeholder:"单位",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{gutter:12},{default:l(()=>[e(c,{span:4},{default:l(()=>[e(p,{label:"通知编号",prop:"noticeid"},{default:l(()=>[e(i,{modelValue:s.noticeid,"onUpdate:modelValue":t[29]||(t[29]=a=>s.noticeid=a),placeholder:"通知编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"图纸ID",prop:"noticetuzhiid"},{default:l(()=>[e(i,{modelValue:s.noticetuzhiid,"onUpdate:modelValue":t[30]||(t[30]=a=>s.noticetuzhiid=a),placeholder:"图纸ID",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"图纸编号",prop:"noticedrawno"},{default:l(()=>[e(i,{modelValue:s.noticedrawno,"onUpdate:modelValue":t[31]||(t[31]=a=>s.noticedrawno=a),placeholder:"图纸编号"},null,8,["modelValue"]),e(R,{type:"primary",size:"small",onClick:J},{default:l(()=>t[50]||(t[50]=[x("选择图纸")])),_:1})]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"替代型号",prop:"noticeinstead"},{default:l(()=>[e(i,{modelValue:s.noticeinstead,"onUpdate:modelValue":t[32]||(t[32]=a=>s.noticeinstead=a),placeholder:"替代型号"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"通知名称",prop:"noticename"},{default:l(()=>[e(i,{modelValue:s.noticename,"onUpdate:modelValue":t[33]||(t[33]=a=>s.noticename=a),placeholder:"通知名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"通知作者",prop:"noticeauther"},{default:l(()=>[e(i,{modelValue:s.noticeauther,"onUpdate:modelValue":t[34]||(t[34]=a=>s.noticeauther=a),placeholder:"通知作者"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:4},{default:l(()=>[e(p,{label:"通知制定日期",prop:"noticebuilddate"},{default:l(()=>[e(ye,{modelValue:s.noticebuilddate,"onUpdate:modelValue":t[35]||(t[35]=a=>s.noticebuilddate=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{gutter:12},{default:l(()=>[e(c,{span:5},{default:l(()=>[e(p,{label:"通知备注",prop:"noticecomment"},{default:l(()=>[e(i,{modelValue:s.noticecomment,"onUpdate:modelValue":t[36]||(t[36]=a=>s.noticecomment=a),type:"textarea",rows:3,placeholder:"通知备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(ae,{modelValue:I.value,"onUpdate:modelValue":t[40]||(t[40]=a=>I.value=a),title:"选择图纸",width:"80%"},{footer:l(()=>[e(R,{onClick:t[39]||(t[39]=a=>I.value=!1)},{default:l(()=>t[53]||(t[53]=[x("关闭")])),_:1})]),default:l(()=>[e(Fe,{onSelectTuzhi:u})]),_:1},8,["modelValue"]),e(ae,{modelValue:E.value,"onUpdate:modelValue":t[43]||(t[43]=a=>E.value=a),title:"备料计划单",width:"90%"},{footer:l(()=>[e(R,{onClick:t[42]||(t[42]=a=>E.value=!1)},{default:l(()=>t[54]||(t[54]=[x("关闭")])),_:1})]),default:l(()=>[e(Le,{noticeid:ue.value,noticedrawno:de.value,contractno:d.no,contractname:d.name,onClose:t[41]||(t[41]=a=>E.value=!1)},null,8,["noticeid","noticedrawno","contractno","contractname"])]),_:1},8,["modelValue"])])}}},Je=le(He,[["__scopeId","data-v-4907edaf"]]),Qe={class:"contract-management"},Xe={class:"action-bar"},Ze={class:"pagination-container"},el={__name:"tongzhilist",setup(G){const P=fe(),k=Q(()=>P.currentTerm),f=W({pageNumber:1,pageSize:10,term:k.value||"",contractNo:"",projectName:""}),v=z([]),B=z(0),U=z(!1),n=async()=>{U.value=!0;try{console.log("getContractListData: queryParams",f);const r=await Ne(f);v.value=r.data.page.list,B.value=r.data.page.totalRow}catch(r){console.error("获取合同列表失败",r),$.error("获取合同列表失败")}finally{U.value=!1}};re(()=>P.currentTerm,r=>{console.log("watch: currentTerm changed",r),f.term=r||"",n()},{immediate:!0});const D=r=>{f.pageSize=r,n()},d=r=>{f.pageNumber=r,n()},C=z(!1),q=z(""),M=z(!1),s=r=>{M.value=!0,q.value=r.no,C.value=!0},h=(r=!1)=>{C.value=!1,r&&n()},w=()=>{f.contractNo="",f.projectName="",f.pageNumber=1,n()},F=r=>({10:"info",20:"success",30:"warning",40:"danger",50:"danger",60:"primary"})[r]||"info",y=r=>({10:"录入",20:"确认",30:"下计划",40:"生产中",50:"发货",60:"完成"})[r]||"未知",o=r=>{Ue.confirm("确定要关闭吗？未保存的内容可能会丢失","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{n(),r()}).catch(()=>{})};return te(()=>{P.terms.length||P.fetchTerms(),n()}),(r,m)=>{const _=b("el-input"),j=b("el-button"),N=b("el-icon"),g=b("el-table-column"),A=b("el-tag"),K=b("el-table"),H=b("el-dialog"),I=b("el-pagination"),J=me("loading");return T(),O("div",Qe,[S("div",Xe,[e(_,{modelValue:f.contractNo,"onUpdate:modelValue":m[0]||(m[0]=u=>f.contractNo=u),placeholder:"请输入合同编号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:n,onKeyup:oe(n,["enter"])},null,8,["modelValue"]),e(_,{modelValue:f.projectName,"onUpdate:modelValue":m[1]||(m[1]=u=>f.projectName=u),placeholder:"请输入合同名称查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:n,onKeyup:oe(n,["enter"])},null,8,["modelValue"]),e(j,{type:"primary",onClick:n},{default:l(()=>m[5]||(m[5]=[x("搜索")])),_:1}),e(j,{type:"warning",onClick:w},{default:l(()=>[e(N,null,{default:l(()=>[e(pe(ce))]),_:1}),m[6]||(m[6]=x(" 刷新 "))]),_:1})]),ge((T(),X(K,{data:v.value,border:"",style:{width:"100%"}},{default:l(()=>[e(g,{type:"index",label:"序号",width:"80"}),e(g,{prop:"no",label:"合同号",width:"120"}),e(g,{prop:"gridno",label:"电网编号",width:"120"}),e(g,{prop:"name",label:"工程名称"}),e(g,{prop:"salesmanName",label:"销售员",width:"100"}),e(g,{prop:"customerName",label:"客户名称"}),e(g,{prop:"contractSum",label:"合同金额",width:"120"},{default:l(({row:u})=>{var E;return[x(" ¥"+Z(((E=u.contractSum)==null?void 0:E.toFixed(2))??"0.00"),1)]}),_:1}),e(g,{prop:"signDate",label:"签定时间",width:"120"}),e(g,{prop:"term",label:"期间",width:"120"}),e(g,{prop:"status",label:"合同状态",width:"100"},{default:l(({row:u})=>[e(A,{type:F(u.status)},{default:l(()=>[x(Z(y(u.status)),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"操作",width:"150",fixed:"right"},{default:l(({row:u})=>[e(j,{type:"primary",size:"small",onClick:E=>s(u)},{default:l(()=>m[7]||(m[7]=[x("制定通知")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,U.value]]),e(H,{modelValue:C.value,"onUpdate:modelValue":m[2]||(m[2]=u=>C.value=u),title:M.value?"制定通知":"新增合同",width:"80%",top:"5vh","destroy-on-close":"","before-close":o},{default:l(()=>[C.value?(T(),X(Je,{key:0,contractNo:q.value,onClose:h},null,8,["contractNo"])):ee("",!0)]),_:1},8,["modelValue","title"]),S("div",Ze,[e(I,{"current-page":f.pageNumber,"onUpdate:currentPage":m[3]||(m[3]=u=>f.pageNumber=u),"page-size":f.pageSize,"onUpdate:pageSize":m[4]||(m[4]=u=>f.pageSize=u),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:B.value,onSizeChange:D,onCurrentChange:d},null,8,["current-page","page-size","total"])])])}}},ul=le(el,[["__scopeId","data-v-2f6d683b"]]);export{ul as default};
