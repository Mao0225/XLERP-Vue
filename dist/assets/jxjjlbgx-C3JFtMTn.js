import{O as $,P as be,Q as Ne,R as ye,_ as ve,f as we,g as A,r as g,k as xe,s as Ve,h as c,G as je,o as v,c as x,a as C,b as t,e as R,w as r,i as b,x as T,a6 as _e,H as Se,l as ke,F as H,m as G,ai as Q,q as he,p as Ce,E as f,A as Le,B as Ue}from"./index-DvIhe9Wx.js";import{a as ze}from"./file-dcKrrYHU.js";import{W as We}from"./WoNoSelector-Ccp7to0E.js";import"./plshengchangongdan-xXUNx7N2.js";function De(p){return $("/cljxjjLbgx/getpage",p)}function Re(p){return $("/cljxjjLbgx/get",p)}function Te(p){return be("/cljxjjLbgx/save",p)}function $e(p){return Ne("/cljxjjLbgx/update",p)}function Je(p){return ye("/cljxjjLbgx/delete",p)}function Fe(p){return $("/cljxjjLbgx/getWoNoList",p)}const qe={class:"jxjjLbgx-management"},Oe={class:"action-bar"},Me=["onClick"],Be={class:"pagination-container"},Ye={key:0,class:"uploaded-files"},Ee=["onClick"],Ke={__name:"jxjjlbgx",setup(p){const X=Ue,j=we(),J=()=>(console.log("获取登录用户名称",j.descr),j.descr),i=A({mafactory:"",orderno:"",matRecheckNo:"",pageNumber:1,pageSize:10}),F=g([]),q=g(0),L=g(!1),_=g(!1),O=g([]),M=g(0),U=g(!1),w=g(!1),S=g("add"),Z=xe(()=>S.value==="add"?"新增数据":"编辑数据"),V=g(null),k=g(null),h=g([]),o=A({id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",orderno:"",matRecheckNo:"",size:"",singleWireStrength:0,leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:J(),status:0,isdelete:0}),I={mafactory:[{required:!0,message:"请输入原材料制造商",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],orderno:[{required:!0,message:"请输入入库单号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],matRecheckNo:[{required:!0,message:"请输入来料检测批测号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],size:[{required:!0,message:"请输入尺寸",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],singleWireStrength:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],leavefactoryDate:[{required:!0,message:"请输入出厂日期",trigger:"change"}],detectionTime:[{required:!0,message:"请输入入厂日期",trigger:"change"}],contractNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],woNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],ipoNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}]},B=()=>{_.value=!0,Y()},ee=a=>{i.woNo=a.woNo,o.woNo=a.woNo,_.value=!1,a.ipoNo?(o.ipoNo=a.ipoNo,console.log("设置生产订单号:",o.ipoNo)):f.warning("未找到对应的生产订单号"),a.contractNo?(o.contractNo=a.contractNo,console.log("设置合同号:",o.contractNo),o.ipoNo&&o.ipoNo===o.contractNo&&f.info("生产订单号与合同号相同")):f.warning("未找到对应的合同号")},Y=async(a="")=>{U.value=!0;try{const e=await Fe({pageNumber:1,pageSize:10,woNo:a});O.value=e.data.page.list,M.value=e.data.page.totalRow}catch(e){console.error("获取合同号列表失败",e),f.error("获取合同号列表失败")}finally{U.value=!1}},u=async()=>{L.value=!0;try{const a=await De(i);F.value=a.data.page.list,q.value=a.data.page.totalRow}catch(a){console.error("获取数据列表失败",a),f.error("获取数据列表失败")}finally{L.value=!1}},te=a=>{i.pageSize=a,u()},oe=a=>{i.pageNumber=a,u()},E=()=>{V.value&&V.value.resetFields(),k.value&&k.value.clearFiles(),h.value=[],Object.assign(o,{id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",orderno:"",matRecheckNo:"",size:"",singleWireStrength:0,leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:J(),status:0,isdelete:0})},le=()=>{i.contractNo="",i.woNo="",i.ipoNo="",i.mafactory="",i.orderno="",i.matRecheckNo="",i.pageNumber=1,u()},ae=()=>{S.value="add",E(),o.writer=j.descr||"未知用户",w.value=!0},re=async a=>{S.value="edit";const e=await Re({id:a.id});Object.assign(o,e.data.jxjjLbgx),o.writer||(o.writer=j.descr||"未知用户");try{JSON.parse(o.certificate)}catch{if(o.certificate){const s=o.certificate.split("-");o.certificate=JSON.stringify(s.map(N=>({name:N.split("/").pop(),url:`/api/upload/${N}`})))}else o.certificate="[]"}h.value=JSON.parse(o.certificate),w.value=!0},ne=a=>{Le.confirm(`确认删除数据"${a.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Je({id:a.id}),f.success("删除成功"),u()}catch(e){console.error("删除数据失败",e),f.error("删除数据失败")}}).catch(()=>{})},ie=()=>{V.value&&V.value.validate(async a=>{if(a)try{const e=new Date,n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),N=String(e.getDate()).padStart(2,"0"),d=String(e.getHours()).padStart(2,"0"),z=String(e.getMinutes()).padStart(2,"0"),W=String(e.getSeconds()).padStart(2,"0");o.writeTime=`${n}-${s}-${N} ${d}:${z}:${W}`,S.value==="add"?(await Te(o),f.success("新增成功")):(await $e(o),f.success("修改成功")),w.value=!1,u()}catch(e){console.error("保存数据失败",e),f.error("保存数据失败")}})},se=async a=>{const e=new FormData;e.append("file",a.raw);try{const n=await ze(e);if(n.success&&n.data&&n.data.url){const s=X+n.data.url,N=JSON.parse(o.certificate);N.push({name:a.name,url:s}),o.certificate=JSON.stringify(N),h.value.push({name:a.name,url:s}),f.success(`${a.name} 上传成功`)}else throw new Error(n.msg||"文件上传失败")}catch(n){console.error("文件上传失败",n),f.error(`${a.name} 上传失败`),k.value.clearFiles()}},de=a=>{const e=JSON.parse(o.certificate);e.splice(a,1),o.certificate=JSON.stringify(e),h.value.splice(a,1)},K=a=>{window.open(a,"_blank")};return Ve(()=>{u()}),(a,e)=>{const n=c("el-input"),s=c("el-button"),N=c("el-icon"),d=c("el-table-column"),z=c("el-table"),W=c("el-pagination"),m=c("el-form-item"),P=c("el-date-picker"),ue=c("el-upload"),ce=c("el-col"),pe=c("el-row"),me=c("el-form"),ge=c("el-dialog"),fe=je("loading");return v(),x("div",qe,[C("div",Oe,[t(n,{modelValue:i.mafactory,"onUpdate:modelValue":e[0]||(e[0]=l=>i.mafactory=l),placeholder:"请输入原材料制造商查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:u,onKeyup:R(u,["enter"])},null,8,["modelValue"]),t(n,{modelValue:i.orderno,"onUpdate:modelValue":e[1]||(e[1]=l=>i.orderno=l),placeholder:"请输入入库单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:u,onKeyup:R(u,["enter"])},null,8,["modelValue"]),t(n,{modelValue:i.matRecheckNo,"onUpdate:modelValue":e[2]||(e[2]=l=>i.matRecheckNo=l),placeholder:"请输入来料检验批次号",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:u,onKeyup:R(u,["enter"])},null,8,["modelValue"]),t(s,{type:"primary",onClick:u},{default:r(()=>e[19]||(e[19]=[b("搜索")])),_:1}),t(s,{type:"warning",onClick:le},{default:r(()=>[t(N,null,{default:r(()=>[t(T(_e))]),_:1}),e[20]||(e[20]=b(" 刷新 "))]),_:1}),t(s,{type:"primary",style:{"margin-left":"auto"},onClick:ae},{default:r(()=>e[21]||(e[21]=[b("新增")])),_:1})]),Se((v(),ke(z,{data:F.value,border:"",style:{width:"100%"}},{default:r(()=>[t(d,{type:"index",label:"序号",width:"80"}),t(d,{prop:"contractNo",label:"合同编号"}),t(d,{prop:"woNo",label:"生产工单号"}),t(d,{prop:"ipoNo",label:"生产订单号"}),t(d,{prop:"writer",label:"录入人"}),t(d,{prop:"writeTime",label:"录入时间"}),t(d,{prop:"mafactory",label:"原材料制造商"}),t(d,{prop:"orderno",label:"入库单号"}),t(d,{prop:"matRecheckNo",label:"来料检验批次号"}),t(d,{prop:"size",label:"尺寸"}),t(d,{prop:"singleWireStrength",label:"力学性能-单丝强度"}),t(d,{prop:"leavefactoryDate",label:"原材料出厂检测日期",width:"120"}),t(d,{prop:"detectionTime",label:"原材料入厂检测日期",width:"120"}),t(d,{prop:"certificate",label:"质量证明书"},{default:r(({row:l})=>[(v(!0),x(H,null,G(JSON.parse(l.certificate||"[]"),(y,D)=>(v(),x("div",{key:D},[t(T(Q),{content:y.name,placement:"top"},{default:r(()=>[C("span",{class:"file-link",onClick:Pe=>K(y.url,y.name)},"打开文件",8,Me)]),_:2},1032,["content"])]))),128))]),_:1}),t(d,{label:"操作",width:"200"},{default:r(({row:l})=>[t(s,{type:"primary",size:"small",onClick:y=>re(l)},{default:r(()=>e[22]||(e[22]=[b("编辑")])),_:2},1032,["onClick"]),t(s,{type:"danger",size:"small",onClick:y=>ne(l)},{default:r(()=>e[23]||(e[23]=[b("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,L.value]]),C("div",Be,[t(W,{"current-page":i.pageNumber,"onUpdate:currentPage":e[3]||(e[3]=l=>i.pageNumber=l),"page-size":i.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>i.pageSize=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:q.value,onSizeChange:te,onCurrentChange:oe},null,8,["current-page","page-size","total"])]),t(ge,{title:Z.value,modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=l=>w.value=l),width:"800px",onClosed:E},{footer:r(()=>[t(s,{onClick:e[16]||(e[16]=l=>w.value=!1)},{default:r(()=>e[27]||(e[27]=[b("取消")])),_:1}),t(s,{type:"primary",onClick:ie},{default:r(()=>e[28]||(e[28]=[b("确定")])),_:1})]),default:r(()=>[t(me,{ref_key:"formRef",ref:V,model:o,rules:I,"label-width":"140px"},{default:r(()=>[t(pe,{gutter:20},{default:r(()=>[t(ce,{span:12},{default:r(()=>[t(m,{label:"合同编号",prop:"contractNo"},{default:r(()=>[t(n,{modelValue:o.contractNo,"onUpdate:modelValue":e[5]||(e[5]=l=>o.contractNo=l),placeholder:"合同编号",readonly:""},null,8,["modelValue"])]),_:1}),t(m,{label:"生产工单号",prop:"woNo"},{default:r(()=>[t(n,{modelValue:o.woNo,"onUpdate:modelValue":e[6]||(e[6]=l=>o.woNo=l),placeholder:"选择生产工单号",readonly:"",onClick:B},{append:r(()=>[t(s,{onClick:B,size:"small"},{default:r(()=>e[24]||(e[24]=[b("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"生产订单号",prop:"ipoNo"},{default:r(()=>[t(n,{modelValue:o.ipoNo,"onUpdate:modelValue":e[7]||(e[7]=l=>o.ipoNo=l),placeholder:"生产订单号",readonly:""},null,8,["modelValue"])]),_:1}),t(m,{label:"录入人",prop:"writer"},{default:r(()=>[t(n,{modelValue:o.writer,"onUpdate:modelValue":e[8]||(e[8]=l=>o.writer=l),placeholder:"录入人",readonly:""},null,8,["modelValue"])]),_:1}),t(m,{label:"原材料制造商",prop:"mafactory"},{default:r(()=>[t(n,{modelValue:o.mafactory,"onUpdate:modelValue":e[9]||(e[9]=l=>o.mafactory=l),placeholder:"请输入原材料制造商"},null,8,["modelValue"])]),_:1}),t(m,{label:"入库单号",prop:"orderno"},{default:r(()=>[t(n,{modelValue:o.orderno,"onUpdate:modelValue":e[10]||(e[10]=l=>o.orderno=l),placeholder:"请输入入库单号"},null,8,["modelValue"])]),_:1}),t(m,{label:"来料检验批次号",prop:"matRecheckNo"},{default:r(()=>[t(n,{modelValue:o.matRecheckNo,"onUpdate:modelValue":e[11]||(e[11]=l=>o.matRecheckNo=l),placeholder:"请输入来料检验批次号"},null,8,["modelValue"])]),_:1}),t(m,{label:"尺寸",prop:"size"},{default:r(()=>[t(n,{modelValue:o.size,"onUpdate:modelValue":e[12]||(e[12]=l=>o.size=l),placeholder:"请输入尺寸"},null,8,["modelValue"])]),_:1}),t(m,{label:"力学性能-单丝强度",prop:"singleWireStrength"},{default:r(()=>[t(n,{modelValue:o.singleWireStrength,"onUpdate:modelValue":e[13]||(e[13]=l=>o.singleWireStrength=l),modelModifiers:{number:!0},placeholder:"请输入力学性能-单丝强度",type:"number"},null,8,["modelValue"])]),_:1}),t(m,{label:"原材料出厂检测日期",prop:"leavefactoryDate"},{default:r(()=>[t(P,{modelValue:o.leavefactoryDate,"onUpdate:modelValue":e[14]||(e[14]=l=>o.leavefactoryDate=l),type:"date",placeholder:"请选择原材料出厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(m,{label:"原材料入厂检测日期",prop:"detectionTime"},{default:r(()=>[t(P,{modelValue:o.detectionTime,"onUpdate:modelValue":e[15]||(e[15]=l=>o.detectionTime=l),type:"date",placeholder:"请选择原材料入厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(m,{label:"质量证明书",prop:"certificate"},{default:r(()=>[t(ue,{ref_key:"certificateUpload",ref:k,"auto-upload":!1,"on-change":se,limit:10,accept:".pdf,.jpg,.jpeg,.png","file-list":[],"show-file-list":!1},{default:r(()=>[t(s,{type:"primary"},{default:r(()=>e[25]||(e[25]=[b("上传文件")])),_:1})]),_:1},512),o.certificate?(v(),x("div",Ye,[(v(!0),x(H,null,G(JSON.parse(o.certificate),(l,y)=>(v(),x("div",{key:y,class:"uploaded-file"},[t(T(Q),{content:l.name,placement:"top"},{default:r(()=>[C("span",{class:"file-link",onClick:D=>K(l.url,l.name)},he(l.name),9,Ee)]),_:2},1032,["content"]),t(s,{type:"danger",size:"mini",onClick:D=>de(y)},{default:r(()=>e[26]||(e[26]=[b("删除")])),_:2},1032,["onClick"])]))),128))])):Ce("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(We,{modelValue:_.value,"onUpdate:modelValue":e[18]||(e[18]=l=>_.value=l),onSelect:ee,woNoList:O.value,totalWoNo:M.value,loadingWoNo:U.value,onSearch:Y},null,8,["modelValue","woNoList","totalWoNo","loadingWoNo"])])}}},Xe=ve(Ke,[["__scopeId","data-v-2cc13430"]]);export{Xe as default};
