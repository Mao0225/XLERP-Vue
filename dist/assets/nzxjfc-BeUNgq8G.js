import{O as W,P as Ne,Q as ye,R as be,_ as ve,f as we,g as P,r as g,k as Ve,s as _e,h as p,G as ke,o as v,c as V,a as h,b as t,e as F,w as r,i as N,x as $,a6 as xe,H as Se,l as Ce,F as A,m as H,ai as G,q as ze,p as he,E as f,A as Fe,B as Ue}from"./index-DvIhe9Wx.js";import{a as Re}from"./file-dcKrrYHU.js";import{W as je}from"./WoNoSelector-Ccp7to0E.js";import"./plshengchangongdan-xXUNx7N2.js";function De(m){return W("/clnzxjFc/getpage",m)}function Te(m){return W("/clnzxjFc/get",m)}function $e(m){return Ne("/clnzxjFc/save",m)}function We(m){return ye("/clnzxjFc/update",m)}function qe(m){return be("/clnzxjFc/delete",m)}function Le(m){return W("/clnzxjFc/getWoNoList",m)}const Oe={class:"nzxjFc-management"},Qe={class:"action-bar"},Be=["onClick"],Je={class:"pagination-container"},Me={key:0,class:"uploaded-files"},Ye=["onClick"],Ee={__name:"nzxjfc",setup(m){const X=Ue,k=we(),q=()=>(console.log("获取登录用户名称",k.descr),k.descr),i=P({mafactory:"",maQuality:"",orderno:"",matRecheckNo:"",pageNumber:1,pageSize:10}),L=g([]),O=g(0),U=g(!1),x=g(!1),Q=g([]),B=g(0),R=g(!1),w=g(!1),S=g("add"),Z=Ve(()=>S.value==="add"?"新增数据":"编辑数据"),_=g(null),C=g(null),z=g([]),l=P({id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",maQuality:"",orderno:"",matRecheckNo:"",sampleNumber:"",testResult:"",leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:q(),status:0,isdelete:0}),I={mafactory:[{required:!0,message:"请输入原材料制造商",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],maQuality:[{required:!0,message:"请输入辅材类型",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],orderno:[{required:!0,message:"请输入入库单号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],matRecheckNo:[{required:!0,message:"请输入来料检测批测号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],sampleNumber:[{required:!0,message:"请输入样品编号",trigger:"blur"}],testResult:[{required:!0,message:"请输入检测结果",trigger:"blur"}],leavefactoryDate:[{required:!0,message:"请输入出厂日期",trigger:"change"}],detectionTime:[{required:!0,message:"请输入入厂日期",trigger:"change"}],contractNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],woNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}],ipoNo:[{required:!0,message:"长度不能超过50个字符",trigger:"blur"}]},J=()=>{x.value=!0,M()},ee=o=>{i.woNo=o.woNo,l.woNo=o.woNo,x.value=!1,o.ipoNo?(l.ipoNo=o.ipoNo,console.log("设置生产订单号:",l.ipoNo)):f.warning("未找到对应的生产订单号"),o.contractNo?(l.contractNo=o.contractNo,console.log("设置合同号:",l.contractNo),l.ipoNo&&l.ipoNo===l.contractNo&&f.info("生产订单号与合同号相同")):f.warning("未找到对应的合同号")},M=async(o="")=>{R.value=!0;try{const e=await Le({pageNumber:1,pageSize:10,woNo:o});Q.value=e.data.page.list,B.value=e.data.page.totalRow}catch(e){console.error("获取合同号列表失败",e),f.error("获取合同号列表失败")}finally{R.value=!1}},d=async()=>{U.value=!0;try{const o=await De(i);L.value=o.data.page.list,O.value=o.data.page.totalRow}catch(o){console.error("获取数据列表失败",o),f.error("获取数据列表失败")}finally{U.value=!1}},te=o=>{i.pageSize=o,d()},le=o=>{i.pageNumber=o,d()},Y=()=>{_.value&&_.value.resetFields(),C.value&&C.value.clearFiles(),z.value=[],Object.assign(l,{id:void 0,contractNo:"",woNo:"",ipoNo:"",mafactory:"",maQuality:"",orderno:"",matRecheckNo:"",sampleNumber:"",testResult:"",leavefactoryDate:"",detectionTime:"",certificate:"[]",writeTime:"",writer:q(),status:0,isdelete:0})},ae=()=>{i.contractNo="",i.woNo="",i.ipoNo="",i.mafactory="",i.maQuality="",i.orderno="",i.matRecheckNo="",i.pageNumber=1,d()},oe=()=>{S.value="add",Y(),l.writer=k.descr||"未知用户",w.value=!0},re=async o=>{S.value="edit";const e=await Te({id:o.id});Object.assign(l,e.data.nzxjFc),l.writer||(l.writer=k.descr||"未知用户");try{JSON.parse(l.certificate)}catch{if(l.certificate){const u=l.certificate.split("-");l.certificate=JSON.stringify(u.map(y=>({name:y.split("/").pop(),url:`/api/upload/${y}`})))}else l.certificate="[]"}z.value=JSON.parse(l.certificate),w.value=!0},ne=o=>{Fe.confirm(`确认删除数据"${o.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await qe({id:o.id}),f.success("删除成功"),d()}catch(e){console.error("删除数据失败",e),f.error("删除数据失败")}}).catch(()=>{})},ie=()=>{_.value&&_.value.validate(async o=>{if(o)try{const e=new Date,n=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),j=String(e.getMinutes()).padStart(2,"0"),D=String(e.getSeconds()).padStart(2,"0");l.writeTime=`${n}-${u}-${y} ${s}:${j}:${D}`,S.value==="add"?(await $e(l),f.success("新增成功")):(await We(l),f.success("修改成功")),w.value=!1,d()}catch(e){console.error("保存数据失败",e),f.error("保存数据失败")}})},se=async o=>{const e=new FormData;e.append("file",o.raw);try{const n=await Re(e);if(n.success&&n.data&&n.data.url){const u=X+n.data.url,y=JSON.parse(l.certificate);y.push({name:o.name,url:u}),l.certificate=JSON.stringify(y),z.value.push({name:o.name,url:u}),f.success(`${o.name} 上传成功`)}else throw new Error(n.msg||"文件上传失败")}catch(n){console.error("文件上传失败",n),f.error(`${o.name} 上传失败`),C.value.clearFiles()}},ue=o=>{const e=JSON.parse(l.certificate);e.splice(o,1),l.certificate=JSON.stringify(e),z.value.splice(o,1)},E=o=>{window.open(o,"_blank")};return _e(()=>{d()}),(o,e)=>{const n=p("el-input"),u=p("el-button"),y=p("el-icon"),s=p("el-table-column"),j=p("el-table"),D=p("el-pagination"),c=p("el-form-item"),K=p("el-date-picker"),de=p("el-upload"),ce=p("el-col"),pe=p("el-row"),me=p("el-form"),ge=p("el-dialog"),fe=ke("loading");return v(),V("div",Oe,[h("div",Qe,[t(n,{modelValue:i.mafactory,"onUpdate:modelValue":e[0]||(e[0]=a=>i.mafactory=a),placeholder:"请输入原材料制造商查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:d,onKeyup:F(d,["enter"])},null,8,["modelValue"]),t(n,{modelValue:i.maQuality,"onUpdate:modelValue":e[1]||(e[1]=a=>i.maQuality=a),placeholder:"请输入辅材类型",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:d,onKeyup:F(d,["enter"])},null,8,["modelValue"]),t(n,{modelValue:i.orderno,"onUpdate:modelValue":e[2]||(e[2]=a=>i.orderno=a),placeholder:"请输入入库单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:d,onKeyup:F(d,["enter"])},null,8,["modelValue"]),t(n,{modelValue:i.matRecheckNo,"onUpdate:modelValue":e[3]||(e[3]=a=>i.matRecheckNo=a),placeholder:"请输入来料检验批次号",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:d,onKeyup:F(d,["enter"])},null,8,["modelValue"]),t(u,{type:"primary",onClick:d},{default:r(()=>e[21]||(e[21]=[N("搜索")])),_:1}),t(u,{type:"warning",onClick:ae},{default:r(()=>[t(y,null,{default:r(()=>[t($(xe))]),_:1}),e[22]||(e[22]=N(" 刷新 "))]),_:1}),t(u,{type:"primary",style:{"margin-left":"auto"},onClick:oe},{default:r(()=>e[23]||(e[23]=[N("新增")])),_:1})]),Se((v(),Ce(j,{data:L.value,border:"",style:{width:"100%"}},{default:r(()=>[t(s,{type:"index",label:"序号",width:"80"}),t(s,{prop:"contractNo",label:"合同编号"}),t(s,{prop:"woNo",label:"生产工单号"}),t(s,{prop:"ipoNo",label:"生产订单号"}),t(s,{prop:"writer",label:"录入人"}),t(s,{prop:"writeTime",label:"录入时间"}),t(s,{prop:"mafactory",label:"原材料制造商"}),t(s,{prop:"maQuality",label:"辅材类型"}),t(s,{prop:"orderno",label:"入库单号"}),t(s,{prop:"matRecheckNo",label:"来料检验批次号"}),t(s,{prop:"sampleNumber",label:"样品编号"}),t(s,{prop:"testResult",label:"检测结果"}),t(s,{prop:"leavefactoryDate",label:"原材料出厂检测日期",width:"120"}),t(s,{prop:"detectionTime",label:"原材料入厂检测日期",width:"120"}),t(s,{prop:"certificate",label:"质量证明书"},{default:r(({row:a})=>[(v(!0),V(A,null,H(JSON.parse(a.certificate||"[]"),(b,T)=>(v(),V("div",{key:T},[t($(G),{content:b.name,placement:"top"},{default:r(()=>[h("span",{class:"file-link",onClick:Ke=>E(b.url,b.name)}," 打开文件 ",8,Be)]),_:2},1032,["content"])]))),128))]),_:1}),t(s,{label:"操作",width:"200"},{default:r(({row:a})=>[t(u,{type:"primary",size:"small",onClick:b=>re(a)},{default:r(()=>e[24]||(e[24]=[N("编辑")])),_:2},1032,["onClick"]),t(u,{type:"danger",size:"small",onClick:b=>ne(a)},{default:r(()=>e[25]||(e[25]=[N("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,U.value]]),h("div",Je,[t(D,{"current-page":i.pageNumber,"onUpdate:currentPage":e[4]||(e[4]=a=>i.pageNumber=a),"page-size":i.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>i.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:O.value,onSizeChange:te,onCurrentChange:le},null,8,["current-page","page-size","total"])]),t(ge,{title:Z.value,modelValue:w.value,"onUpdate:modelValue":e[19]||(e[19]=a=>w.value=a),width:"800px",onClosed:Y},{footer:r(()=>[t(u,{onClick:e[18]||(e[18]=a=>w.value=!1)},{default:r(()=>e[29]||(e[29]=[N("取消")])),_:1}),t(u,{type:"primary",onClick:ie},{default:r(()=>e[30]||(e[30]=[N("确定")])),_:1})]),default:r(()=>[t(me,{ref_key:"formRef",ref:_,model:l,rules:I,"label-width":"140px"},{default:r(()=>[t(pe,{gutter:20},{default:r(()=>[t(ce,{span:12},{default:r(()=>[t(c,{label:"合同编号",prop:"contractNo"},{default:r(()=>[t(n,{modelValue:l.contractNo,"onUpdate:modelValue":e[6]||(e[6]=a=>l.contractNo=a),placeholder:"合同编号",readonly:""},null,8,["modelValue"])]),_:1}),t(c,{label:"生产工单号",prop:"woNo"},{default:r(()=>[t(n,{modelValue:l.woNo,"onUpdate:modelValue":e[7]||(e[7]=a=>l.woNo=a),placeholder:"选择生产工单号",readonly:"",onClick:J},{append:r(()=>[t(u,{onClick:J,size:"small"},{default:r(()=>e[26]||(e[26]=[N("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"生产订单号",prop:"ipoNo"},{default:r(()=>[t(n,{modelValue:l.ipoNo,"onUpdate:modelValue":e[8]||(e[8]=a=>l.ipoNo=a),placeholder:"生产订单号",readonly:""},null,8,["modelValue"])]),_:1}),t(c,{label:"录入人",prop:"writer"},{default:r(()=>[t(n,{modelValue:l.writer,"onUpdate:modelValue":e[9]||(e[9]=a=>l.writer=a),placeholder:"录入人",readonly:""},null,8,["modelValue"])]),_:1}),t(c,{label:"原材料制造商",prop:"mafactory"},{default:r(()=>[t(n,{modelValue:l.mafactory,"onUpdate:modelValue":e[10]||(e[10]=a=>l.mafactory=a),placeholder:"请输入原材料制造商"},null,8,["modelValue"])]),_:1}),t(c,{label:"辅材类型",prop:"maQuality"},{default:r(()=>[t(n,{modelValue:l.maQuality,"onUpdate:modelValue":e[11]||(e[11]=a=>l.maQuality=a),placeholder:"请输入辅材类型"},null,8,["modelValue"])]),_:1}),t(c,{label:"入库单号",prop:"orderno"},{default:r(()=>[t(n,{modelValue:l.orderno,"onUpdate:modelValue":e[12]||(e[12]=a=>l.orderno=a),placeholder:"请输入入库单号"},null,8,["modelValue"])]),_:1}),t(c,{label:"来料检验批次号",prop:"matRecheckNo"},{default:r(()=>[t(n,{modelValue:l.matRecheckNo,"onUpdate:modelValue":e[13]||(e[13]=a=>l.matRecheckNo=a),placeholder:"请输入来料检验批次号"},null,8,["modelValue"])]),_:1}),t(c,{label:"样品编号",prop:"sampleNumber"},{default:r(()=>[t(n,{modelValue:l.sampleNumber,"onUpdate:modelValue":e[14]||(e[14]=a=>l.sampleNumber=a),placeholder:"请输入样品编号"},null,8,["modelValue"])]),_:1}),t(c,{label:"检测结果",prop:"testResult"},{default:r(()=>[t(n,{modelValue:l.testResult,"onUpdate:modelValue":e[15]||(e[15]=a=>l.testResult=a),placeholder:"请输入检测结果"},null,8,["modelValue"])]),_:1}),t(c,{label:"原材料出厂检测日期",prop:"leavefactoryDate"},{default:r(()=>[t(K,{modelValue:l.leavefactoryDate,"onUpdate:modelValue":e[16]||(e[16]=a=>l.leavefactoryDate=a),type:"date",placeholder:"请选择原材料出厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(c,{label:"原材料入厂检测日期",prop:"detectionTime"},{default:r(()=>[t(K,{modelValue:l.detectionTime,"onUpdate:modelValue":e[17]||(e[17]=a=>l.detectionTime=a),type:"date",placeholder:"请选择原材料入厂检测日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(c,{label:"质量证明书",prop:"certificate"},{default:r(()=>[t(de,{ref_key:"certificateUpload",ref:C,"auto-upload":!1,"on-change":se,limit:10,accept:".pdf,.jpg,.jpeg,.png","file-list":[],"show-file-list":!1},{default:r(()=>[t(u,{type:"primary"},{default:r(()=>e[27]||(e[27]=[N("上传文件")])),_:1})]),_:1},512),l.certificate?(v(),V("div",Me,[(v(!0),V(A,null,H(JSON.parse(l.certificate),(a,b)=>(v(),V("div",{key:b,class:"uploaded-file"},[t($(G),{content:a.name,placement:"top"},{default:r(()=>[h("span",{class:"file-link",onClick:T=>E(a.url,a.name)},ze(a.name),9,Ye)]),_:2},1032,["content"]),t(u,{type:"danger",size:"mini",onClick:T=>ue(b)},{default:r(()=>e[28]||(e[28]=[N("删除")])),_:2},1032,["onClick"])]))),128))])):he("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(je,{modelValue:x.value,"onUpdate:modelValue":e[20]||(e[20]=a=>x.value=a),onSelect:ee,woNoList:Q.value,totalWoNo:B.value,loadingWoNo:R.value,onSearch:M},null,8,["modelValue","woNoList","totalWoNo","loadingWoNo"])])}}},Xe=ve(Ee,[["__scopeId","data-v-1e5d2b23"]]);export{Xe as default};
