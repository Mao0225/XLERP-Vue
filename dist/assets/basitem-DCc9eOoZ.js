import{_ as Q,k as $,h as i,o as f,l as S,w as a,a as d,b as l,i as g,q as U,c as w,F as B,m as z,x as be,a5 as ve,g as H,r as k,s as _e,G as ye,e as J,H as Ve,E as b,A as xe,B as we}from"./index-Bwbtb0V1.js";import{g as he,a as Ce,d as ke,c as Ue,u as De,i as Re}from"./basitem-BEdq12hI.js";const Ie={class:"import-result"},Ne={class:"result-summary"},Be={class:"stat-item"},ze={class:"stat-value"},$e={class:"stat-item success"},Te={class:"stat-value"},Le={class:"stat-item error"},Ee={class:"stat-value"},Fe={class:"stat-item"},Se={class:"stat-value"},Oe={key:0,class:"failed-details"},Me={class:"failed-list"},je={class:"error-message"},qe={class:"export-actions"},Ke={key:1,class:"no-failed"},Ae={class:"dialog-footer"},Pe={__name:"ImportResultDialog",props:{modelValue:{type:Boolean,default:!1},importData:{type:Object,default:()=>({})}},emits:["update:modelValue","confirm"],setup(h,{emit:O}){const v=h,T=O,D=$({get:()=>v.modelValue,set:y=>T("update:modelValue",y)}),M=$(()=>{const y=v.importData.totalRows||0,n=v.importData.successCount||0;return y>0?Math.round(n/y*100):0}),r=()=>{const n=["行号,错误信息",...(v.importData.failedRows||[]).map(V=>`${V.rowNumber},"${V.error}"`)].join(`
`),_=new Blob([n],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a");R.href=URL.createObjectURL(_),R.download=`导入失败数据_${new Date().toISOString().slice(0,10)}.csv`,R.click()},L=()=>{D.value=!1},E=()=>{T("confirm"),D.value=!1};return(y,n)=>{const _=i("el-col"),R=i("el-row"),V=i("el-tag"),s=i("el-scrollbar"),j=i("el-icon"),F=i("el-button"),m=i("el-result"),q=i("el-dialog");return f(),S(q,{modelValue:D.value,"onUpdate:modelValue":n[0]||(n[0]=I=>D.value=I),title:"导入结果",width:"600px","close-on-click-modal":!1,onClosed:L},{footer:a(()=>[d("span",Ae,[l(F,{type:"primary",onClick:E},{default:a(()=>n[7]||(n[7]=[g("确定")])),_:1})])]),default:a(()=>[d("div",Ie,[d("div",Ne,[l(R,{gutter:20},{default:a(()=>[l(_,{span:6},{default:a(()=>[d("div",Be,[d("div",ze,U(h.importData.totalRows||0),1),n[1]||(n[1]=d("div",{class:"stat-label"},"导入总数",-1))])]),_:1}),l(_,{span:6},{default:a(()=>[d("div",$e,[d("div",Te,U(h.importData.successCount||0),1),n[2]||(n[2]=d("div",{class:"stat-label"},"成功导入",-1))])]),_:1}),l(_,{span:6},{default:a(()=>[d("div",Le,[d("div",Ee,U(h.importData.failedCount||0),1),n[3]||(n[3]=d("div",{class:"stat-label"},"失败数量",-1))])]),_:1}),l(_,{span:6},{default:a(()=>[d("div",Fe,[d("div",Se,U(M.value)+"%",1),n[4]||(n[4]=d("div",{class:"stat-label"},"成功率",-1))])]),_:1})]),_:1})]),h.importData.failedRows&&h.importData.failedRows.length>0?(f(),w("div",Oe,[n[6]||(n[6]=d("h4",null,"失败详情：",-1)),d("div",Me,[l(s,{"max-height":"300px"},{default:a(()=>[(f(!0),w(B,null,z(h.importData.failedRows,(I,K)=>(f(),w("div",{key:K,class:"failed-item"},[l(V,{type:"danger",size:"small"},{default:a(()=>[g("第 "+U(I.rowNumber)+" 行",1)]),_:2},1024),d("span",je,U(I.error),1)]))),128))]),_:1})]),d("div",qe,[l(F,{size:"small",onClick:r},{default:a(()=>[l(j,null,{default:a(()=>[l(be(ve))]),_:1}),n[5]||(n[5]=g(" 导出失败数据 "))]),_:1})])])):(f(),w("div",Ke,[l(m,{icon:"success",title:"导入成功","sub-title":"所有数据都已成功导入"})]))])]),_:1},8,["modelValue"])}}},Ge=Q(Pe,[["__scopeId","data-v-9058afbe"]]),He={class:"basitem-management"},Je={class:"action-bar"},Qe={class:"pagination-container"},We={__name:"basitem",setup(h){const O=["件","套","个","块","根","袋","箱","捆","托","纸箱"],v=[{id:10,value:"原材料"},{id:20,value:"成品"},{id:30,value:"半成品"},{id:40,value:"低值易耗品"},{id:50,value:"其他"}],T=["钢材","铝锭","铝型材","其它有色金属","导线"],D=$(()=>{const o=v.find(e=>e.id===(n.value?s.type:r.type));return o&&o.id===10?T:o?[o.value]:[]}),M=$(()=>s.type!==10),r=H({itemNo:"",itemName:"",type:"",inclass:"",pageNumber:1,pageSize:10}),L=k([]),E=k(0),y=k(!1),n=k(!1),_=k("add"),R=$(()=>_.value==="add"?"新增物料":"编辑物料"),V=k(null),s=H({id:void 0,no:"",name:"",unit:"",spec:"",description:"",color:"",memo:"",type:10,weight:0,keeper_rule:"",planned_price:0,avg_price:0,location:"",tech_memo:"",status:0,inclass:"",isdelete:0}),j={no:[{required:!0,message:"请输入物料编号",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],name:[{required:!0,message:"请输入物料名称",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],unit:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],spec:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],description:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],color:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],memo:[{max:100,message:"长度不能超过100个字符",trigger:"blur"}],type:[{required:!0,message:"请选择物料类型",trigger:"change"},{type:"number",message:"请选择有效的物料类型",trigger:["blur","change"]}],weight:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],planned_price:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],avg_price:[{type:"number",message:"请输入有效的数字",trigger:["blur","change"]}],location:[{max:50,message:"长度不能超过50个字符",trigger:"blur"}],tech_memo:[{max:100,message:"长度不能超过100个字符",trigger:"blur"}],inclass:[{required:!0,message:"请选择或输入分类",trigger:"change"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}]},F=o=>{const e=v.find(u=>u.id===o);return e?e.value:"未知"},m=async()=>{y.value=!0;try{const o=await he(r);L.value=o.data.page.list,E.value=o.data.page.totalRow}catch(o){console.error("获取物料列表失败",o),b.error("获取物料列表失败")}finally{y.value=!1}},q=o=>{r.pageSize=o,m()},I=o=>{r.pageNumber=o,m()},K=()=>{const o=v.find(e=>e.id===r.type);o&&o.id!==10?r.inclass=o.value:r.inclass=""},W=()=>{const o=v.find(e=>e.id===s.type);o&&o.id!==10?s.inclass=o.value:s.inclass=""},X=()=>{V.value&&V.value.resetFields(),Object.assign(s,{id:void 0,no:"",name:"",unit:"",spec:"",description:"",color:"",memo:"",type:10,weight:0,keeper_rule:"",planned_price:0,avg_price:0,location:"",tech_memo:"",status:0,inclass:"",isdelete:0})},Y=()=>{r.itemNo="",r.itemName="",r.type="",r.inclass="",r.pageNumber=1,m()},Z=()=>{_.value="add",n.value=!0},ee=async o=>{_.value="edit";const e=await Ce({id:o.id});Object.assign(s,e.data.basItem),n.value=!0},le=o=>{xe.confirm(`确认删除物料"${o.no}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ke({id:o.id}),b.success("删除成功"),m()}catch(e){console.error("删除物料失败",e),b.error("删除物料失败")}}).catch(()=>{})},te=()=>{V.value&&V.value.validate(async o=>{if(o)try{_.value==="add"?(await Ue(s),b.success("新增成功")):(await De(s),b.success("修改成功")),n.value=!1,m()}catch(e){console.error("保存物料失败",e),b.error("保存物料失败")}})},A=k(!1),P=k({}),ae=()=>{const o=document.createElement("input");o.type="file",o.accept=".xls,.xlsx",o.style.display="none",o.addEventListener("change",async e=>{const u=e.target.files[0];if(!u){b.error("未选择文件");return}if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(u.type)&&!u.name.match(/\.(xls|xlsx)$/)){b.error("请选择 Excel 文件 (.xls 或 .xlsx)");return}const C=new FormData;C.append("itemListFile",u);try{const p=await Re(C);p.code===200&&p.data?(oe(p.data),b.success(`文件导入完成，总计 ${p.data.totalRows} 条，成功 ${p.data.successCount} 条`)):b.error("导入失败："+(p.msg||"未知错误"))}catch(p){console.error("导入错误",p),b.error("导入物料失败")}finally{document.body.removeChild(o)}}),document.body.appendChild(o),o.click()},oe=o=>{P.value=o,A.value=!0},se=()=>{m()},ne=()=>{try{const o=`${we}/xlsxTemplates/基础物料信息导入示例.xlsx`;window.open(o,"_blank")}catch(o){console.error("下载模板失败:",o),b({message:"下载模板失败，请检查网络或联系管理员",type:"error",duration:5*1e3})}};return _e(()=>{m()}),(o,e)=>{const u=i("el-input"),N=i("el-option"),C=i("el-select"),p=i("el-button"),re=i("Refresh"),ie=i("el-icon"),x=i("el-table-column"),de=i("el-table"),ue=i("el-pagination"),c=i("el-form-item"),G=i("el-col"),pe=i("el-row"),me=i("el-form"),ce=i("el-dialog"),ge=ye("loading");return f(),w("div",He,[d("div",Je,[l(u,{modelValue:r.itemNo,"onUpdate:modelValue":e[0]||(e[0]=t=>r.itemNo=t),placeholder:"请输入物料编号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:m,onKeyup:J(m,["enter"])},null,8,["modelValue"]),l(u,{modelValue:r.itemName,"onUpdate:modelValue":e[1]||(e[1]=t=>r.itemName=t),placeholder:"请输入物料名称查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:m,onKeyup:J(m,["enter"])},null,8,["modelValue"]),l(C,{modelValue:r.inclass,"onUpdate:modelValue":e[2]||(e[2]=t=>r.inclass=t),placeholder:"选择物料所属分类",style:{width:"200px","margin-right":"10px"}},{default:a(()=>[(f(!0),w(B,null,z(D.value,t=>(f(),S(N,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(C,{modelValue:r.type,"onUpdate:modelValue":e[3]||(e[3]=t=>r.type=t),placeholder:"选择物料类型",style:{width:"200px","margin-right":"10px"},onChange:K},{default:a(()=>[(f(),w(B,null,z(v,t=>l(N,{key:t.id,label:t.value,value:t.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(p,{type:"primary",onClick:m},{default:a(()=>e[23]||(e[23]=[g("搜索")])),_:1}),l(p,{type:"warning",onClick:Y},{default:a(()=>[l(ie,null,{default:a(()=>[l(re)]),_:1}),e[24]||(e[24]=g(" 刷新 "))]),_:1}),l(p,{type:"primary",style:{"margin-left":"auto"},onClick:Z},{default:a(()=>e[25]||(e[25]=[g("新增物料")])),_:1}),l(p,{type:"primary",onClick:ae},{default:a(()=>e[26]||(e[26]=[g("导入物料")])),_:1}),l(p,{type:"info",onClick:ne},{default:a(()=>e[27]||(e[27]=[g("下载模板")])),_:1})]),Ve((f(),S(de,{data:L.value,border:"",style:{width:"100%"}},{default:a(()=>[l(x,{type:"index",label:"序号",width:"80"}),l(x,{prop:"no",label:"物料编号"}),l(x,{prop:"spec",label:"规格型号"}),l(x,{prop:"name",label:"物料名称"}),l(x,{prop:"unit",label:"计量单位"}),l(x,{prop:"planned_price",label:"计划价格"}),l(x,{prop:"type",label:"物料类型",width:"120"},{default:a(({row:t})=>[g(U(F(t.type)),1)]),_:1}),l(x,{prop:"inclass",label:"所属分类"}),l(x,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[g(U(t.status===0?"正常":"停用"),1)]),_:1}),l(x,{label:"操作",width:"200"},{default:a(({row:t})=>[l(p,{type:"primary",size:"small",onClick:fe=>ee(t)},{default:a(()=>e[28]||(e[28]=[g("编辑")])),_:2},1032,["onClick"]),l(p,{type:"danger",size:"small",onClick:fe=>le(t)},{default:a(()=>e[29]||(e[29]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,y.value]]),d("div",Qe,[l(ue,{"current-page":r.pageNumber,"onUpdate:currentPage":e[4]||(e[4]=t=>r.pageNumber=t),"page-size":r.pageSize,"onUpdate:pageSize":e[5]||(e[5]=t=>r.pageSize=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:E.value,onSizeChange:q,onCurrentChange:I},null,8,["current-page","page-size","total"])]),l(ce,{title:R.value,modelValue:n.value,"onUpdate:modelValue":e[21]||(e[21]=t=>n.value=t),width:"800px",onClosed:X},{footer:a(()=>[l(p,{onClick:e[20]||(e[20]=t=>n.value=!1)},{default:a(()=>e[30]||(e[30]=[g("取消")])),_:1}),l(p,{type:"primary",onClick:te},{default:a(()=>e[31]||(e[31]=[g("确定")])),_:1})]),default:a(()=>[l(me,{ref_key:"formRef",ref:V,model:s,rules:j,"label-width":"100px"},{default:a(()=>[l(pe,{gutter:20},{default:a(()=>[l(G,{span:12},{default:a(()=>[l(c,{label:"物料编号",prop:"no"},{default:a(()=>[l(u,{modelValue:s.no,"onUpdate:modelValue":e[6]||(e[6]=t=>s.no=t),placeholder:"请输入物料编号"},null,8,["modelValue"])]),_:1}),l(c,{label:"物料名称",prop:"name"},{default:a(()=>[l(u,{modelValue:s.name,"onUpdate:modelValue":e[7]||(e[7]=t=>s.name=t),placeholder:"请输入物料名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"计量单位",prop:"unit"},{default:a(()=>[l(C,{modelValue:s.unit,"onUpdate:modelValue":e[8]||(e[8]=t=>s.unit=t),placeholder:"请选择或输入单位","allow-create":"",filterable:""},{default:a(()=>[(f(),w(B,null,z(O,t=>l(N,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"物料类型",prop:"type"},{default:a(()=>[l(C,{modelValue:s.type,"onUpdate:modelValue":e[9]||(e[9]=t=>s.type=t),placeholder:"请选择物料类型",onChange:W},{default:a(()=>[(f(),w(B,null,z(v,t=>l(N,{key:t.id,label:t.value,value:t.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"所属分类",prop:"inclass"},{default:a(()=>[l(C,{modelValue:s.inclass,"onUpdate:modelValue":e[10]||(e[10]=t=>s.inclass=t),placeholder:"请选择或输入分类","allow-create":"",filterable:"",disabled:M.value},{default:a(()=>[(f(!0),w(B,null,z(D.value,t=>(f(),S(N,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(c,{label:"规格型号",prop:"spec"},{default:a(()=>[l(u,{modelValue:s.spec,"onUpdate:modelValue":e[11]||(e[11]=t=>s.spec=t),placeholder:"请输入规格型号"},null,8,["modelValue"])]),_:1}),l(c,{label:"物料描述",prop:"description"},{default:a(()=>[l(u,{modelValue:s.description,"onUpdate:modelValue":e[12]||(e[12]=t=>s.description=t),placeholder:"请输入物料描述"},null,8,["modelValue"])]),_:1})]),_:1}),l(G,{span:12},{default:a(()=>[l(c,{label:"颜色",prop:"color"},{default:a(()=>[l(u,{modelValue:s.color,"onUpdate:modelValue":e[13]||(e[13]=t=>s.color=t),placeholder:"请输入颜色"},null,8,["modelValue"])]),_:1}),l(c,{label:"重量",prop:"weight"},{default:a(()=>[l(u,{modelValue:s.weight,"onUpdate:modelValue":e[14]||(e[14]=t=>s.weight=t),modelModifiers:{number:!0},placeholder:"请输入重量",type:"number"},null,8,["modelValue"])]),_:1}),l(c,{label:"计划价格",prop:"planned_price"},{default:a(()=>[l(u,{modelValue:s.planned_price,"onUpdate:modelValue":e[15]||(e[15]=t=>s.planned_price=t),modelModifiers:{number:!0},placeholder:"请输入计划价格",type:"number"},null,8,["modelValue"])]),_:1}),l(c,{label:"平均价格",prop:"avg_price"},{default:a(()=>[l(u,{modelValue:s.avg_price,"onUpdate:modelValue":e[16]||(e[16]=t=>s.avg_price=t),modelModifiers:{number:!0},placeholder:"请输入平均价格",type:"number"},null,8,["modelValue"])]),_:1}),l(c,{label:"存放位置",prop:"location"},{default:a(()=>[l(u,{modelValue:s.location,"onUpdate:modelValue":e[17]||(e[17]=t=>s.location=t),placeholder:"请输入存放位置"},null,8,["modelValue"])]),_:1}),l(c,{label:"技术参数",prop:"tech_memo"},{default:a(()=>[l(u,{modelValue:s.tech_memo,"onUpdate:modelValue":e[18]||(e[18]=t=>s.tech_memo=t),placeholder:"请输入技术参数"},null,8,["modelValue"])]),_:1}),l(c,{label:"备注信息",prop:"memo"},{default:a(()=>[l(u,{modelValue:s.memo,"onUpdate:modelValue":e[19]||(e[19]=t=>s.memo=t),placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(Ge,{modelValue:A.value,"onUpdate:modelValue":e[22]||(e[22]=t=>A.value=t),"import-data":P.value,onConfirm:se},null,8,["modelValue","import-data"])])}}},Ze=Q(We,[["__scopeId","data-v-3c034c66"]]);export{Ze as default};
