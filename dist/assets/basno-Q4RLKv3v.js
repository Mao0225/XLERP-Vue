import{_ as L,g as C,r as b,k as O,s as G,h as u,G as H,o as w,c as J,a as B,b as a,e as N,w as l,i as m,H as Q,l as W,q as X,E as p,A as Y}from"./index-Bwbtb0V1.js";import{g as Z,a as ee,d as ae,c as te,u as le}from"./basno-kehUVSav.js";const oe={class:"basno-management"},ne={class:"action-bar"},re={class:"pagination-container"},se={__name:"basno",setup(ue){const n=C({basname:"",memo:"",pageNumber:1,pageSize:10}),V=b([]),x=b(0),_=b(!1),g=b(!1),y=b("add"),k=O(()=>y.value==="add"?"新增编号":"编辑编号"),f=b(null),r=C({id:void 0,basname:"",currentterm:"",basnum:"",memo:"",type:null,flag:null}),z={basname:[{required:!0,message:"请输入编号简称",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],currentterm:[{required:!0,message:"请输入当前期次",trigger:"blur"},{pattern:/^\d{6}$/,message:"请输入6位数字的期次",trigger:"blur"}],basnum:[{required:!0,message:"请输入当前序号",trigger:"blur"},{type:"number",message:"请输入有效的数字",trigger:"blur"}],memo:[{max:100,message:"长度不能超过100个字符",trigger:"blur"}]},s=async()=>{_.value=!0;try{const o=await Z(n);V.value=o.data.page.list,x.value=o.data.page.totalRow}catch(o){console.error("获取编号列表失败",o),p.error("获取编号列表失败")}finally{_.value=!1}},h=o=>{n.pageSize=o,s()},S=o=>{n.pageNumber=o,s()},U=()=>{f.value&&f.value.resetFields(),Object.assign(r,{id:void 0,basname:"",currentterm:"",basnum:"",memo:"",type:null,flag:null})},R=()=>{n.basname="",n.memo="",n.pageNumber=1,s()},q=()=>{y.value="add",g.value=!0},E=async o=>{y.value="edit";try{const e=await ee({id:o.id});Object.assign(r,e.data.Basno),g.value=!0}catch(e){console.error("获取编号详情失败",e),p.error("获取编号详情失败")}},T=o=>{Y.confirm(`确认删除编号"${o.basname}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ae({id:o.id}),p.success("删除成功"),s()}catch(e){console.error("删除编号失败",e),p.error("删除编号失败")}}).catch(()=>{})},$=()=>{f.value&&f.value.validate(async o=>{if(o)try{y.value==="add"?(await te(r),p.success("新增成功")):(await le(r),p.success("修改成功")),g.value=!1,s()}catch(e){console.error("保存编号失败",e),p.error("保存编号失败")}})};return G(()=>{s()}),(o,e)=>{const c=u("el-input"),d=u("el-button"),D=u("Refresh"),M=u("el-icon"),i=u("el-table-column"),j=u("el-table"),F=u("el-pagination"),v=u("el-form-item"),K=u("el-form"),P=u("el-dialog"),A=H("loading");return w(),J("div",oe,[B("div",ne,[a(c,{modelValue:n.basname,"onUpdate:modelValue":e[0]||(e[0]=t=>n.basname=t),placeholder:"请输入编号简称查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:s,onKeyup:N(s,["enter"])},null,8,["modelValue"]),a(c,{modelValue:n.memo,"onUpdate:modelValue":e[1]||(e[1]=t=>n.memo=t),placeholder:"请输入备注查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:s,onKeyup:N(s,["enter"])},null,8,["modelValue"]),a(d,{type:"primary",onClick:s},{default:l(()=>e[10]||(e[10]=[m("搜索")])),_:1}),a(d,{type:"warning",onClick:R},{default:l(()=>[a(M,null,{default:l(()=>[a(D)]),_:1}),e[11]||(e[11]=m(" 刷新 "))]),_:1}),a(d,{type:"primary",style:{"margin-left":"auto"},onClick:q},{default:l(()=>e[12]||(e[12]=[m("新增编号")])),_:1})]),Q((w(),W(j,{data:V.value,border:"",style:{width:"100%"}},{default:l(()=>[a(i,{type:"index",label:"序号",width:"80"}),a(i,{prop:"basname",label:"编号简称"}),a(i,{prop:"currentterm",label:"当前期次"}),a(i,{prop:"basnum",label:"当前序号"}),a(i,{label:"当前完整编号",width:"200"},{default:l(({row:t})=>[m(X(t.basname+t.currentterm+t.basnum.toString().padStart(5,"0")),1)]),_:1}),a(i,{prop:"memo",label:"备注",width:"300"}),a(i,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[a(d,{type:"primary",size:"small",onClick:I=>E(t)},{default:l(()=>e[13]||(e[13]=[m("编辑")])),_:2},1032,["onClick"]),a(d,{type:"danger",size:"small",onClick:I=>T(t)},{default:l(()=>e[14]||(e[14]=[m("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,_.value]]),B("div",re,[a(F,{"current-page":n.pageNumber,"onUpdate:currentPage":e[2]||(e[2]=t=>n.pageNumber=t),"page-size":n.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>n.pageSize=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:h,onCurrentChange:S},null,8,["current-page","page-size","total"])]),a(P,{title:k.value,modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),width:"600px",onClosed:U},{footer:l(()=>[a(d,{onClick:e[8]||(e[8]=t=>g.value=!1)},{default:l(()=>e[15]||(e[15]=[m("取消")])),_:1}),a(d,{type:"primary",onClick:$},{default:l(()=>e[16]||(e[16]=[m("确定")])),_:1})]),default:l(()=>[a(K,{ref_key:"formRef",ref:f,model:r,rules:z,"label-width":"100px"},{default:l(()=>[a(v,{label:"编号简称",prop:"basname"},{default:l(()=>[a(c,{modelValue:r.basname,"onUpdate:modelValue":e[4]||(e[4]=t=>r.basname=t),placeholder:"请输入编号简称"},null,8,["modelValue"])]),_:1}),a(v,{label:"当前期次",prop:"currentterm"},{default:l(()=>[a(c,{modelValue:r.currentterm,"onUpdate:modelValue":e[5]||(e[5]=t=>r.currentterm=t),placeholder:"请输入当前期次"},null,8,["modelValue"])]),_:1}),a(v,{label:"当前序号",prop:"basnum"},{default:l(()=>[a(c,{modelValue:r.basnum,"onUpdate:modelValue":e[6]||(e[6]=t=>r.basnum=t),modelModifiers:{number:!0},placeholder:"请输入当前序号"},null,8,["modelValue"])]),_:1}),a(v,{label:"备注",prop:"memo"},{default:l(()=>[a(c,{modelValue:r.memo,"onUpdate:modelValue":e[7]||(e[7]=t=>r.memo=t),placeholder:"请输入备注信息",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},ie=L(se,[["__scopeId","data-v-396f7cbb"]]);export{ie as default};
