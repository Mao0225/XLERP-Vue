import{_ as Z,r as v,v as K,g as J,E as z,h as c,G as oe,o as H,l as Q,w as l,a as N,b as e,e as Y,i as h,H as ne,q as W,f as ie,k as de,c as X,F as te,m as ue,W as se,s as pe,A as me}from"./index-DvIhe9Wx.js";import{c as ce,u as ge,g as fe,a as be,b as ve,d as we}from"./plpaichanjihua-B72CbsUm.js";import{a as Ve,g as ye}from"./plshengchangongdan-xXUNx7N2.js";import{g as re}from"./department-Cki7KwLG.js";import{b as he}from"./basno-r_kypwuO.js";import{c as Ce,T as Ne}from"./TuzhiInfoDialog-BsUEY8hs.js";const _e={class:"search-bar"},Se={class:"pagination-container"},De={__name:"gongdanSelector",props:{modelValue:{type:Boolean,default:!1},onSelect:{type:Function,default:()=>{}}},emits:["update:modelValue"],setup(E,{emit:A}){const k=E,O=A,C=v(!1);K(()=>k.modelValue,i=>{C.value=i,i&&P()}),K(C,i=>{O("update:modelValue",i)});const g=J({woNo:"",contractNo:""}),u=J({pageNumber:1,pageSize:10,woNo:"",contractNo:""}),F=v([]),x=v(0),q=v(!1),_=[{id:1,value:"待处理",type:"info"},{id:2,value:"处理中",type:"warning"},{id:3,value:"已完成",type:"success"},{id:4,value:"已取消",type:"danger"},{id:5,value:"已过期",type:"danger"}],M=i=>{const p=_.find(B=>B.id===i);return p?p.value:"未知状态"},$=i=>{const p=_.find(B=>B.id===i);return p?p.type:"info"},j=i=>{if(!i)return"";const p=new Date(i);return`${p.getFullYear()}-${(p.getMonth()+1).toString().padStart(2,"0")}-${p.getDate().toString().padStart(2,"0")}`},P=async()=>{q.value=!0;try{u.woNo=g.woNo,u.contractNo=g.contractNo;const i=await Ve(u);F.value=i.data.page.list,x.value=i.data.page.totalRow}catch(i){z.error("获取生产工单列表失败: "+i.message)}finally{q.value=!1}},T=()=>{u.pageNumber=1,P()},o=()=>{g.woNo="",g.contractNo="",u.pageNumber=1,P()},G=i=>{u.pageSize=i,u.pageNumber=1,P()},s=i=>{u.pageNumber=i,P()},y=i=>{k.onSelect(i),C.value=!1},S=i=>{y(i)},w=()=>{g.woNo="",g.contractNo="",u.pageNumber=1};return(i,p)=>{const B=c("el-input"),R=c("el-col"),D=c("el-button"),d=c("el-row"),a=c("el-table-column"),f=c("el-tag"),r=c("el-table"),t=c("el-pagination"),I=c("el-dialog"),U=oe("loading");return H(),Q(I,{title:"选择生产工单",modelValue:C.value,"onUpdate:modelValue":p[4]||(p[4]=b=>C.value=b),width:"80%",onClosed:w},{default:l(()=>[N("div",_e,[e(d,{gutter:20},{default:l(()=>[e(R,{span:8},{default:l(()=>[e(B,{modelValue:g.woNo,"onUpdate:modelValue":p[0]||(p[0]=b=>g.woNo=b),placeholder:"请输入生产工单号",onKeyup:Y(T,["enter"])},null,8,["modelValue"])]),_:1}),e(R,{span:8},{default:l(()=>[e(B,{modelValue:g.contractNo,"onUpdate:modelValue":p[1]||(p[1]=b=>g.contractNo=b),placeholder:"请输入合同编号",onKeyup:Y(T,["enter"])},null,8,["modelValue"])]),_:1}),e(R,{span:8},{default:l(()=>[e(D,{type:"primary",onClick:T},{default:l(()=>p[5]||(p[5]=[h("搜索")])),_:1}),e(D,{onClick:o},{default:l(()=>p[6]||(p[6]=[h("重置")])),_:1})]),_:1})]),_:1})]),ne((H(),Q(r,{data:F.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:S},{default:l(()=>[e(a,{type:"index",label:"序号",width:"80"}),e(a,{prop:"woNo",label:"生产工单号",width:"150"}),e(a,{prop:"contractNo",label:"合同编号",width:"120"}),e(a,{prop:"contractName",label:"合同名称"}),e(a,{prop:"planStartDate",label:"计划开始日期",width:"120"},{default:l(({row:b})=>[h(W(j(b.planStartDate)),1)]),_:1}),e(a,{prop:"planFinishDate",label:"计划完成日期",width:"120"},{default:l(({row:b})=>[h(W(j(b.planFinishDate)),1)]),_:1}),e(a,{prop:"ipoStatus",label:"工单状态",width:"100"},{default:l(({row:b})=>[e(f,{type:$(b.ipoStatus)},{default:l(()=>[h(W(M(b.ipoStatus)),1)]),_:2},1032,["type"])]),_:1}),e(a,{prop:"writer",label:"录入人",width:"100"}),e(a,{prop:"writetime",label:"录入时间",width:"120"}),e(a,{label:"操作",width:"150"},{default:l(({row:b})=>[e(D,{type:"primary",size:"small",onClick:L=>y(b)},{default:l(()=>p[7]||(p[7]=[h(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,q.value]]),N("div",Se,[e(t,{"current-page":u.pageNumber,"onUpdate:currentPage":p[2]||(p[2]=b=>u.pageNumber=b),"page-size":u.pageSize,"onUpdate:pageSize":p[3]||(p[3]=b=>u.pageSize=b),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:G,onCurrentChange:s},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},ke=Z(De,[["__scopeId","data-v-4984b3b5"]]),ze={class:"pagination-container"},Ue={__name:"gongdanItemSelector",props:{modelValue:{type:Boolean,default:!1},woNo:{type:String,default:""},onSelect:{type:Function,default:()=>{}}},emits:["update:modelValue"],setup(E,{emit:A}){const k=E,O=A,C=v(!1);K(()=>k.modelValue,s=>{C.value=s,s&&k.woNo&&(_(),$())}),K(C,s=>{O("update:modelValue",s)});const g=J({pageNumber:1,pageSize:10,woNo:""}),u=v([]),F=v(0),x=v(!1),q=v([]),_=async()=>{try{const s=await re();if(!s.success){console.error(s.msg);return}q.value=s.data.options||[]}catch{console.error("加载车间数据失败")}},M=s=>s?s.split(",").map(w=>{const i=q.value.find(p=>p.code===w.trim());return i?i.name:w}).join(","):"",$=async()=>{var s;if(!k.woNo){z.warning("未提供生产工单号"),u.value=[],F.value=0;return}x.value=!0;try{g.woNo=k.woNo;const y=await ye(g);u.value=y.data.itemList||[],F.value=((s=y.data.itemList)==null?void 0:s.length)||0}catch(y){z.error("加载物料列表失败: "+y.message),u.value=[],F.value=0}finally{x.value=!1}},j=s=>{g.pageSize=s,g.pageNumber=1,$()},P=s=>{g.pageNumber=s,$()},T=s=>{k.onSelect(s),C.value=!1},o=s=>{T(s)},G=()=>{g.pageNumber=1,g.woNo="",u.value=[],F.value=0};return(s,y)=>{const S=c("el-table-column"),w=c("el-button"),i=c("el-table"),p=c("el-pagination"),B=c("el-dialog"),R=oe("loading");return H(),Q(B,{title:"选择工单物料",modelValue:C.value,"onUpdate:modelValue":y[2]||(y[2]=D=>C.value=D),width:"60%",onClosed:G},{default:l(()=>[ne((H(),Q(i,{data:u.value,border:"",style:{width:"100%","margin-top":"20px"},onRowClick:o},{default:l(()=>[e(S,{type:"index",label:"序号",width:"80"}),e(S,{prop:"woNo",label:"生产工单号",width:"150"}),e(S,{prop:"itemname",label:"物料名称",width:"200"}),e(S,{prop:"productModel",label:"产品型号",width:"120"}),e(S,{prop:"amount",label:"数量",width:"100"}),e(S,{prop:"unit",label:"单位",width:"80"}),e(S,{prop:"workshopName",label:"车间",width:"150"},{default:l(({row:D})=>[h(W(M(D.workshopName)),1)]),_:1}),e(S,{prop:"memo",label:"备注",width:"150"}),e(S,{label:"操作",width:"150"},{default:l(({row:D})=>[e(w,{type:"primary",size:"small",onClick:d=>T(D)},{default:l(()=>y[3]||(y[3]=[h(" 选择 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,x.value]]),N("div",ze,[e(p,{"current-page":g.pageNumber,"onUpdate:currentPage":y[0]||(y[0]=D=>g.pageNumber=D),"page-size":g.pageSize,"onUpdate:pageSize":y[1]||(y[1]=D=>g.pageSize=D),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:F.value,onSizeChange:j,onCurrentChange:P},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])}}},xe=Z(Ue,[["__scopeId","data-v-043c8525"]]),Ie={class:"plan-section"},Fe={class:"form-section"},Pe={class:"form-section"},qe={class:"form-section"},$e={class:"form-section"},je={class:"form-section"},Te={__name:"paichanjihuaForm",props:{visible:{type:Boolean,default:!1},type:{type:String,default:"add"},formData:{type:Object,default:()=>({})}},emits:["update:visible","submit","cancel"],setup(E,{emit:A}){const k=ie(),O=()=>(console.log("获取登录用户名称",k.descr),k.descr),C=E,g=A,u=[{id:1,value:"生产计划"},{id:2,value:"采购计划"},{id:3,value:"销售计划"},{id:4,value:"其他计划"}],F=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],x=de({get:()=>C.visible,set:d=>g("update:visible",d)}),q=de(()=>C.type==="add"?"新增排产计划":"编辑排产计划"),_=v(null),M=v(!1),$=v([]),j=async()=>{const d=await re();if(!d.success){z.error(d.msg);return}$.value=d.data.options},P=d=>(console.log("获取车间名称",d),j(),d?d.split(",").map(r=>{const t=$.value.find(I=>I.code===r.trim());return t?t.name:r}).join(","):""),T=async()=>{try{const d=await he("pcjh");return(d==null?void 0:d.code)===200?(console.log("获取编码成功",d.data.fullNoNyName),d.data.fullNoNyName):(z.error((d==null?void 0:d.msg)||"获取编码失败"),"")}catch(d){return console.error("生成排产计划编码出错:",d),z.error("请求编码服务时发生错误"),""}};K(x,async d=>{d&&C.type==="add"&&(o.scheduleCode=await T())});const o=J({id:void 0,purchaserHqCode:"",supplierCode:"1000014491",supplierName:"中国电建集团四平线路器材有限公司",poItemId:void 0,scheduleCode:"",gdItemId:void 0,woNo:"",provCoCode:"",provCoName:"",planPeriod:"",actualPeriod:"",schedule:"",dueDate:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",categoryCode:"60",subclassCode:"6004",remark:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",type:"",status:1,flag:"",writer:O(),isdelete:0}),G={purchaserHqCode:[{required:!0,message:"请输入采购方总部编码",trigger:"blur"},{max:20,message:"长度不能超过20个字符",trigger:"blur"}],supplierCode:[{required:!0,message:"请输入供应商编码",trigger:"blur"},{max:48,message:"长度不能超过48个字符",trigger:"blur"}],supplierName:[{required:!0,message:"请输入供应商名称",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],woNo:[{required:!0,message:"请选择工单编号",trigger:"blur"}],ipoNo:[{required:!0,message:"请选择工单编号",trigger:"blur"}],contractNo:[{required:!0,message:"请选择工单编号",trigger:"blur"}],itemname:[{required:!0,message:"请选择工单物料",trigger:"blur"}],scheduleCode:[{required:!0,message:"请输入排产计划编码",trigger:"blur"},{max:48,message:"长度不能超过48个字符",trigger:"blur"}],planPeriod:[{required:!0,message:"请输入计划工期",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],dueDate:[{required:!0,message:"请选择交付日期",trigger:"change"}],planStartDate:[{required:!0,message:"请选择计划开始日期",trigger:"change"}],planFinishDate:[{required:!0,message:"请选择计划完成日期",trigger:"change"}],categoryCode:[{required:!0,message:"请输入品类编码",trigger:"blur"},{max:10,message:"长度不能超过10个字符",trigger:"blur"}],subclassCode:[{required:!0,message:"请输入种类编码",trigger:"blur"},{max:10,message:"长度不能超过10个字符",trigger:"blur"}],dataSource:[{required:!0,message:"请输入数据来源",trigger:"blur"},{max:60,message:"长度不能超过60个字符",trigger:"blur"}],dataSourceCreateTime:[{required:!0,message:"请选择来源创建时间",trigger:"change"}]};K(()=>C.formData,d=>{if(d&&Object.keys(d).length>0){const a={...d};a.dueDate&&(a.dueDate=new Date(a.dueDate)),a.planStartDate&&(a.planStartDate=new Date(a.planStartDate)),a.planFinishDate&&(a.planFinishDate=new Date(a.planFinishDate)),a.actualStartDate&&(a.actualStartDate=new Date(a.actualStartDate)),a.actualFinishDate&&(a.actualFinishDate=new Date(a.actualFinishDate)),a.dataSourceCreateTime&&(a.dataSourceCreateTime=new Date(a.dataSourceCreateTime)),Object.assign(o,a)}},{immediate:!0,deep:!0});const s=v(!1),y=v(!1),S=d=>{d.stopPropagation(),s.value=!0},w=d=>{if(o.woNo==""){z.error("请先选择生产工单！");return}d.stopPropagation(),y.value=!0},i=d=>{d&&(o.woNo=d.woNo,o.purchaserHqCode=d.purchaserHqCode,o.supplierCode=d.supplierCode,o.supplierName=d.supplierName,o.categoryCode=d.categoryCode,o.subclassCode=d.subclassCode,o.contractNo=d.contractNo,o.ipoNo=d.ipoNo),s.value=!1},p=d=>{d&&(o.gdItemId=d.id,o.amount=d.amount,o.itemname=d.itemname,o.productModel=d.productModel,o.unit=d.unit,o.workshopName=P(d.workshopName))},B=()=>{_.value&&_.value.resetFields(),Object.assign(o,{id:void 0,purchaserHqCode:"",supplierCode:"1000014491",supplierName:"中国电建集团四平线路器材有限公司",poItemId:void 0,scheduleCode:"",gdItemId:void 0,woNo:"",provCoCode:"",provCoName:"",planPeriod:"",actualPeriod:"",schedule:"",dueDate:"",planStartDate:"",planFinishDate:"",actualStartDate:"",actualFinishDate:"",categoryCode:"60",subclassCode:"6004",remark:"",dataSource:"",dataSourceCreateTime:"",ownerId:"",openId:"",type:"",status:1,flag:"",writer:O(),isdelete:0})},R=()=>{_.value&&_.value.validate(async d=>{if(d)try{M.value=!0;const a={...o};C.type==="add"?(await ce(a),z.success("计划信息保存成功")):(await ge(a),z.success("计划信息更新成功")),g("submit"),x.value=!1}catch(a){console.error("保存排产计划失败",a),z.error("保存排产计划失败")}finally{M.value=!1}})},D=()=>{g("cancel")};return(d,a)=>{const f=c("el-input"),r=c("el-form-item"),t=c("el-col"),I=c("el-option"),U=c("el-select"),b=c("el-button"),L=c("el-row"),V=c("el-date-picker"),ee=c("el-form"),ae=c("el-dialog");return H(),X(te,null,[e(ae,{title:q.value,modelValue:x.value,"onUpdate:modelValue":a[30]||(a[30]=n=>x.value=n),width:"1400px",onClosed:B},{footer:l(()=>[e(b,{type:"primary",onClick:R,loading:M.value},{default:l(()=>a[41]||(a[41]=[h(" 保存计划信息 ")])),_:1},8,["loading"]),e(b,{onClick:D},{default:l(()=>a[42]||(a[42]=[h("关闭")])),_:1})]),default:l(()=>[N("div",Ie,[a[40]||(a[40]=N("div",{class:"section-header"},[N("h3",null,"排产计划信息")],-1)),e(ee,{ref_key:"formRef",ref:_,model:o,rules:G,"label-width":"120px",size:"small"},{default:l(()=>[N("div",Fe,[a[34]||(a[34]=N("div",{class:"section-title"},"基本信息",-1)),e(L,{gutter:10},{default:l(()=>[e(t,{span:8},{default:l(()=>[e(r,{label:"采购方总部编码",prop:"purchaserHqCode"},{default:l(()=>[e(f,{modelValue:o.purchaserHqCode,"onUpdate:modelValue":a[0]||(a[0]=n=>o.purchaserHqCode=n),placeholder:"选择工单号后自动填充",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"计划类型",prop:"type"},{default:l(()=>[e(U,{modelValue:o.type,"onUpdate:modelValue":a[1]||(a[1]=n=>o.type=n),placeholder:"请选择计划类型",style:{width:"100%"}},{default:l(()=>[(H(),X(te,null,ue(u,n=>e(I,{key:n.id,label:n.value,value:n.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"排产计划编码",prop:"scheduleCode"},{default:l(()=>[e(f,{modelValue:o.scheduleCode,"onUpdate:modelValue":a[2]||(a[2]=n=>o.scheduleCode=n),placeholder:"请输入排产计划编码",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"生产工单号",prop:"woNo"},{default:l(()=>[e(f,{modelValue:o.woNo,"onUpdate:modelValue":a[3]||(a[3]=n=>o.woNo=n),placeholder:"选择生产工单号",readonly:"",onClick:se(S,["stop"])},{append:l(()=>[e(b,{onClick:S,size:"small"},{default:l(()=>a[33]||(a[33]=[h("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"厂内合同号",prop:"contractNo"},{default:l(()=>[e(f,{modelValue:o.contractNo,"onUpdate:modelValue":a[4]||(a[4]=n=>o.contractNo=n),modelModifiers:{number:!0},placeholder:"选择工单号后自动填充",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"生产订单号",prop:"ipoNo"},{default:l(()=>[e(f,{modelValue:o.ipoNo,"onUpdate:modelValue":a[5]||(a[5]=n=>o.ipoNo=n),modelModifiers:{number:!0},placeholder:"选择工单号后自动填充",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8})]),_:1})]),N("div",Pe,[a[36]||(a[36]=N("div",{class:"section-title"},"物料信息(选择工单物料后自动填充)",-1)),e(L,{gutter:10},{default:l(()=>[e(t,{span:8},{default:l(()=>[e(r,{label:"物料名称",prop:"itemname"},{default:l(()=>[e(f,{modelValue:o.itemname,"onUpdate:modelValue":a[6]||(a[6]=n=>o.itemname=n),placeholder:"选择工单物料",readonly:"",onClick:se(w,["stop"])},{append:l(()=>[e(b,{onClick:w,size:"small"},{default:l(()=>a[35]||(a[35]=[h("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"规格型号",prop:"productModel"},{default:l(()=>[e(f,{modelValue:o.productModel,"onUpdate:modelValue":a[7]||(a[7]=n=>o.productModel=n),disabled:"",placeholder:"选择物料后自动填充"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"数量",prop:"amount"},{default:l(()=>[e(f,{modelValue:o.amount,"onUpdate:modelValue":a[8]||(a[8]=n=>o.amount=n),disabled:"",placeholder:"选择物料后自动填充"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"单位",prop:"unit"},{default:l(()=>[e(f,{modelValue:o.unit,"onUpdate:modelValue":a[9]||(a[9]=n=>o.unit=n),disabled:"",placeholder:"选择物料后自动填充"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"生产车间",prop:"unit"},{default:l(()=>[e(f,{modelValue:o.workshopName,"onUpdate:modelValue":a[10]||(a[10]=n=>o.workshopName=n),disabled:"",placeholder:"选择物料后自动填充"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),N("div",qe,[a[37]||(a[37]=N("div",{class:"section-title"},"供应商信息",-1)),e(L,{gutter:10},{default:l(()=>[e(t,{span:8},{default:l(()=>[e(r,{label:"供应商编码",prop:"supplierCode"},{default:l(()=>[e(f,{modelValue:o.supplierCode,"onUpdate:modelValue":a[11]||(a[11]=n=>o.supplierCode=n),disabled:"",placeholder:"请输入供应商编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"供应商名称",prop:"supplierName"},{default:l(()=>[e(f,{modelValue:o.supplierName,"onUpdate:modelValue":a[12]||(a[12]=n=>o.supplierName=n),disabled:"",placeholder:"请输入供应商名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"省公司编码",prop:"provCoCode"},{default:l(()=>[e(f,{modelValue:o.provCoCode,"onUpdate:modelValue":a[13]||(a[13]=n=>o.provCoCode=n),placeholder:"请输入省公司编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"省公司名称",prop:"provCoName"},{default:l(()=>[e(f,{modelValue:o.provCoName,"onUpdate:modelValue":a[14]||(a[14]=n=>o.provCoName=n),placeholder:"请输入省公司名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),N("div",$e,[a[38]||(a[38]=N("div",{class:"section-title"},"进度信息",-1)),e(L,{gutter:10},{default:l(()=>[e(t,{span:8},{default:l(()=>[e(r,{label:"计划工期",prop:"planPeriod"},{default:l(()=>[e(f,{modelValue:o.planPeriod,"onUpdate:modelValue":a[15]||(a[15]=n=>o.planPeriod=n),placeholder:"请输入计划工期（天数）"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"实际工期",prop:"actualPeriod"},{default:l(()=>[e(f,{modelValue:o.actualPeriod,"onUpdate:modelValue":a[16]||(a[16]=n=>o.actualPeriod=n),placeholder:"请输入实际工期"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"进度",prop:"schedule"},{default:l(()=>[e(f,{modelValue:o.schedule,"onUpdate:modelValue":a[17]||(a[17]=n=>o.schedule=n),placeholder:"请输入进度",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"交付日期",prop:"dueDate"},{default:l(()=>[e(V,{modelValue:o.dueDate,"onUpdate:modelValue":a[18]||(a[18]=n=>o.dueDate=n),type:"date",placeholder:"选择交付日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"计划开始日期",prop:"planStartDate"},{default:l(()=>[e(V,{modelValue:o.planStartDate,"onUpdate:modelValue":a[19]||(a[19]=n=>o.planStartDate=n),type:"date",placeholder:"选择计划开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"计划完成日期",prop:"planFinishDate"},{default:l(()=>[e(V,{modelValue:o.planFinishDate,"onUpdate:modelValue":a[20]||(a[20]=n=>o.planFinishDate=n),type:"date",placeholder:"选择计划完成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"实际开始日期",prop:"actualStartDate"},{default:l(()=>[e(V,{modelValue:o.actualStartDate,"onUpdate:modelValue":a[21]||(a[21]=n=>o.actualStartDate=n),type:"date",placeholder:"选择实际开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"实际完成日期",prop:"actualFinishDate"},{default:l(()=>[e(V,{modelValue:o.actualFinishDate,"onUpdate:modelValue":a[22]||(a[22]=n=>o.actualFinishDate=n),type:"date",placeholder:"选择实际完成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),N("div",je,[a[39]||(a[39]=N("div",{class:"section-title"},"其他信息",-1)),e(L,{gutter:10},{default:l(()=>[e(t,{span:8},{default:l(()=>[e(r,{label:"品类编码",prop:"categoryCode"},{default:l(()=>[e(f,{modelValue:o.categoryCode,"onUpdate:modelValue":a[23]||(a[23]=n=>o.categoryCode=n),disabled:"",placeholder:"请输入品类编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"种类编码",prop:"subclassCode"},{default:l(()=>[e(f,{modelValue:o.subclassCode,"onUpdate:modelValue":a[24]||(a[24]=n=>o.subclassCode=n),disabled:"",placeholder:"请输入种类编码"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"计划状态",prop:"status"},{default:l(()=>[e(U,{modelValue:o.status,"onUpdate:modelValue":a[25]||(a[25]=n=>o.status=n),placeholder:"请选择计划状态",style:{width:"100%"}},{default:l(()=>[(H(),X(te,null,ue(F,n=>e(I,{key:n.id,label:n.value,value:n.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"数据来源",prop:"dataSource"},{default:l(()=>[e(f,{modelValue:o.dataSource,"onUpdate:modelValue":a[26]||(a[26]=n=>o.dataSource=n),placeholder:"请输入数据来源"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"来源创建时间",prop:"dataSourceCreateTime"},{default:l(()=>[e(V,{modelValue:o.dataSourceCreateTime,"onUpdate:modelValue":a[27]||(a[27]=n=>o.dataSourceCreateTime=n),type:"date",placeholder:"选择来源创建时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:8},{default:l(()=>[e(r,{label:"录入人",prop:"writer"},{default:l(()=>[e(f,{modelValue:o.writer,"onUpdate:modelValue":a[28]||(a[28]=n=>o.writer=n),placeholder:"请输入录入人",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:24},{default:l(()=>[e(r,{label:"备注",prop:"remark"},{default:l(()=>[e(f,{modelValue:o.remark,"onUpdate:modelValue":a[29]||(a[29]=n=>o.remark=n),placeholder:"请输入备注",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])])]),_:1},8,["title","modelValue"]),e(ke,{modelValue:s.value,"onUpdate:modelValue":a[31]||(a[31]=n=>s.value=n),onSelect:i},null,8,["modelValue"]),e(xe,{modelValue:y.value,"onUpdate:modelValue":a[32]||(a[32]=n=>y.value=n),woNo:o.woNo,onSelect:p},null,8,["modelValue","woNo"])],64)}}},Be=Z(Te,[["__scopeId","data-v-d75c69ee"]]),Me={class:"production-plan-management"},Le={class:"action-bar"},Oe={class:"pagination-container"},Re={__name:"paichanjihua",setup(E){const A=[{id:1,value:"待处理"},{id:2,value:"处理中"},{id:3,value:"已完成"},{id:4,value:"已取消"},{id:5,value:"已过期"}],k=v(!1),O=v({}),C=r=>{const t=A.find(I=>I.id===r);return t?t.value:"未知状态"},g=r=>{if(!r)return"";const t=new Date(r);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},u=J({contractNo:"",woNo:"",ipoNo:"",scheduleCode:"",pageNumber:1,pageSize:10}),F=v([]),x=v(0),q=v(!1),_=v(!1),M=v("add"),$=v({}),j=v(!1),P=v(""),T=v(""),o=()=>{console.log("关闭备料计划弹窗"),j.value=!1,T.value="",P.value=""},G=r=>{console.log("查看备料计划，row:",r),T.value=r.contractNo,P.value=r.gdItemId||"",j.value=!0},s=v([]),y=async()=>{try{const r=await re();if(!r.success){console.error(r.msg);return}s.value=r.data.options||[]}catch{console.error("加载车间数据失败")}},S=r=>r?s.value.length===0?r:r.split(",").map(U=>{const b=U.trim(),L=s.value.find(V=>V.code===b);return L?L.name:U}).join(","):"",w=async()=>{q.value=!0;try{const r=await fe(u);console.log("获取排产计划列表响应:",r),F.value=r.data.page.list.map(t=>({...t,workshopName:S(t.workshopName)})),x.value=r.data.page.totalRow}catch(r){console.error("获取排产计划列表失败:",r),z.error("获取排产计划列表失败")}finally{q.value=!1}},i=async r=>{if(!r){z.error("暂未选择图纸");return}try{const t=await be({tuzhiId:r});console.log("获取图纸信息响应:",t),t.success?(O.value=t.data.tuzhiInfo,k.value=!0):z.error("获取图纸信息失败: "+t.msg)}catch(t){console.error("获取图纸信息失败:",t),z.error("获取图纸信息失败")}},p=r=>{u.pageSize=r,w()},B=r=>{u.pageNumber=r,w()},R=()=>{u.contractNo="",u.woNo="",u.ipoNo="",u.scheduleCode="",u.pageNumber=1,w()},D=()=>{M.value="add",$.value={},_.value=!0},d=async r=>{M.value="edit";const t=await ve({id:r.id});$.value=t.data.plpaichanjihua,_.value=!0},a=r=>{me.confirm(`确认删除排产计划"${r.planNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await we({id:r.id}),z.success("删除成功"),w()}catch(t){console.error("删除排产计划失败:",t),z.error("删除排产计划失败")}}).catch(()=>{})},f=()=>{console.log("表单取消"),_.value=!1};return K(_,(r,t)=>{t&&!r&&w()}),pe(()=>{console.log("页面初始化，加载排产计划列表"),y(),w()}),(r,t)=>{const I=c("el-input"),U=c("el-button"),b=c("Refresh"),L=c("el-icon"),V=c("el-table-column"),ee=c("el-table"),ae=c("el-pagination"),n=oe("loading");return H(),X("div",Me,[N("div",Le,[e(I,{modelValue:u.scheduleCode,"onUpdate:modelValue":t[0]||(t[0]=m=>u.scheduleCode=m),placeholder:"请输入排产计划号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:w,onKeyup:Y(w,["enter"])},null,8,["modelValue"]),e(I,{modelValue:u.ipoNo,"onUpdate:modelValue":t[1]||(t[1]=m=>u.ipoNo=m),placeholder:"请输入生产订单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:w,onKeyup:Y(w,["enter"])},null,8,["modelValue"]),e(I,{modelValue:u.woNo,"onUpdate:modelValue":t[2]||(t[2]=m=>u.woNo=m),placeholder:"请输入生产工单号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:w,onKeyup:Y(w,["enter"])},null,8,["modelValue"]),e(I,{modelValue:u.contractNo,"onUpdate:modelValue":t[3]||(t[3]=m=>u.contractNo=m),placeholder:"请输入厂内合同号查询",style:{width:"200px","margin-right":"10px"},clearable:"",onClear:w,onKeyup:Y(w,["enter"])},null,8,["modelValue"]),e(U,{type:"primary",onClick:w},{default:l(()=>t[11]||(t[11]=[h("搜索")])),_:1}),e(U,{type:"warning",onClick:R},{default:l(()=>[e(L,null,{default:l(()=>[e(b)]),_:1}),t[12]||(t[12]=h(" 刷新 "))]),_:1}),e(U,{type:"primary",style:{"margin-left":"auto"},onClick:D},{default:l(()=>t[13]||(t[13]=[h("新增排产计划")])),_:1})]),ne((H(),Q(ee,{data:F.value,border:"",style:{width:"100%"}},{default:l(()=>[e(V,{type:"index",label:"序号","min-width":"80"}),e(V,{prop:"scheduleCode",label:"排产计划号","min-width":"200"}),e(V,{prop:"contractNo",label:"合同编号","min-width":"120"}),e(V,{prop:"itemName",label:"物料名称","min-width":"150"}),e(V,{prop:"itemNo",label:"物料编号","min-width":"120"}),e(V,{prop:"spec",label:"物料型号","min-width":"120"}),e(V,{prop:"workshopName",label:"生产车间","min-width":"150"}),e(V,{prop:"conamount",label:"合同订货数","min-width":"100"}),e(V,{prop:"ddamount",label:"关联订单货数","min-width":"120"}),e(V,{prop:"gdamount",label:"关联工单货数","min-width":"120"}),e(V,{prop:"planStartDate",label:"计划开始日期","min-width":"180"},{default:l(({row:m})=>[h(W(g(m.planStartDate)),1)]),_:1}),e(V,{prop:"planFinishDate",label:"计划完成日期","min-width":"180"},{default:l(({row:m})=>[h(W(g(m.planFinishDate)),1)]),_:1}),e(V,{prop:"status",label:"计划状态","min-width":"120"},{default:l(({row:m})=>[h(W(C(m.status)),1)]),_:1}),e(V,{prop:"writer",label:"录入人","min-width":"100"}),e(V,{prop:"writetime",label:"录入时间","min-width":"120"}),e(V,{label:"操作","min-width":"400",fixed:"right"},{default:l(({row:m})=>[e(U,{type:"primary",size:"small",onClick:le=>d(m)},{default:l(()=>t[14]||(t[14]=[h("编辑")])),_:2},1032,["onClick"]),e(U,{type:"danger",size:"small",onClick:le=>a(m)},{default:l(()=>t[15]||(t[15]=[h("删除")])),_:2},1032,["onClick"]),e(U,{type:"warning",size:"small",onClick:le=>i(m.noticetuzhiid)},{default:l(()=>t[16]||(t[16]=[h("查看图纸")])),_:2},1032,["onClick"]),e(U,{type:"info",size:"small",onClick:le=>G(m)},{default:l(()=>t[17]||(t[17]=[h("查看备料计划")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[n,q.value]]),N("div",Oe,[e(ae,{"current-page":u.pageNumber,"onUpdate:currentPage":t[4]||(t[4]=m=>u.pageNumber=m),"page-size":u.pageSize,"onUpdate:pageSize":t[5]||(t[5]=m=>u.pageSize=m),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next,Jumper",total:x.value,onSizeChange:p,onCurrentChange:B},null,8,["current-page","page-size","total"])]),e(Be,{visible:_.value,"onUpdate:visible":t[6]||(t[6]=m=>_.value=m),type:M.value,"form-data":$.value,onCancel:f},null,8,["visible","type","form-data"]),e(Ce,{visible:j.value,"onUpdate:visible":[t[7]||(t[7]=m=>j.value=m),t[8]||(t[8]=m=>j.value=m)],contractno:T.value,gdItemId:P.value,onCancel:o},null,8,["visible","contractno","gdItemId"]),e(Ne,{visible:k.value,"onUpdate:visible":[t[9]||(t[9]=m=>k.value=m),t[10]||(t[10]=m=>k.value=m)],"tuzhi-info":O.value},null,8,["visible","tuzhi-info"])])}}},Ye=Z(Re,[["__scopeId","data-v-a378fe42"]]);export{Ye as default};
