import{d as le,S as j,r as u,T as te,U as oe,s as X,D as ae,h as r,o as c,c as x,b as l,w as t,a as w,V as ne,l as b,n as A,p as P,W as G,X as H,F as re,m as se,_ as Y,g as W,k as ie,G as de,x as N,z as ue,i as C,H as ce,q as pe,Y as me,Z as fe,$ as ve,a0 as _e,E as v,a1 as ge,A as ye,a2 as be,a3 as Ve,a4 as he}from"./index-DvIhe9Wx.js";const we={class:"icon-grid"},ke=["onClick"],Ce=le({__name:"IconSelect",props:j({modelValue:{type:String,default:""},width:{type:String,default:"500px"}},{modelValue:{type:String,required:!0,default:""},modelModifiers:{}}),emits:j(["update:modelValue"],["update:modelValue"]),setup(L,{emit:D}){const I=L,k=D,V=u(),_=u(),i=u(!1),M=u(Object.keys(te)),m=oe(L,"modelValue"),o=u(""),E=u(M.value);function S(){E.value=o.value?M.value.filter(y=>y.toLowerCase().includes(o.value.toLowerCase())):M.value}function U(y){const p="el-icon-"+y;k("update:modelValue",p),i.value=!1}function $(){i.value=!i.value}function T(y){const p=y.target;i.value&&V.value&&!V.value.contains(p)&&_.value&&!_.value.contains(p)&&(i.value=!1)}function q(){m.value="",k("update:modelValue","")}return X(()=>{document.addEventListener("click",T)}),ae(()=>{document.removeEventListener("click",T)}),(y,p)=>{const n=r("el-icon"),e=r("CircleClose"),d=r("ArrowDown"),s=r("el-input"),g=r("el-tooltip"),R=r("el-scrollbar"),z=r("el-popover");return c(),x("div",{ref_key:"iconSelectRef",ref:V,style:H({width:I.width})},[l(z,{visible:i.value,width:I.width,placement:"bottom-end"},{reference:t(()=>[w("div",{onClick:p[1]||(p[1]=f=>i.value=!i.value)},[ne(y.$slots,"default",{},()=>[l(s,{modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=f=>m.value=f),readonly:"",placeholder:"点击选择图标",class:"reference"},{prepend:t(()=>[m.value?(c(),b(n,{key:0},{default:t(()=>[(c(),b(A(m.value.replace("el-icon-",""))))]),_:1})):P("",!0)]),suffix:t(()=>[m.value?(c(),b(n,{key:0,style:{"margin-right":"8px"},onClick:G(q,["stop"])},{default:t(()=>[l(e)]),_:1})):P("",!0),l(n,{style:H({transform:i.value?"rotate(180deg)":"rotate(0)",transition:"transform .5s"})},{default:t(()=>[l(d,{onClick:G($,["stop"])})]),_:1},8,["style"])]),_:1},8,["modelValue"])],!0)])]),default:t(()=>[w("div",{ref_key:"popoverContentRef",ref:_},[l(s,{modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=f=>o.value=f),placeholder:"搜索图标",clearable:"",onInput:S},null,8,["modelValue"]),l(R,{height:"300px"},{default:t(()=>[w("ul",we,[(c(!0),x(re,null,se(E.value,f=>(c(),x("li",{key:f,class:"icon-grid-item",onClick:O=>U(f)},[l(g,{content:"el-icon-"+f,placement:"bottom",effect:"light"},{default:t(()=>[l(n,null,{default:t(()=>[(c(),b(A(f)))]),_:2},1024)]),_:2},1032,["content"])],8,ke))),128))])]),_:1})],512)]),_:3},8,["visible","width"])],4)}}}),xe=Y(Ce,[["__scopeId","data-v-3651672e"]]),Ie={class:"menu-management"},Me={class:"card-header"},Se={key:1},Ue={class:"dialog-footer"},$e={__name:"menu",setup(L){W({});const D=u([]),I=u([]);u(0);const k=u(!1),V=u(!1),_=u(!1),i=u("add"),M=ie(()=>i.value==="add"?"新增菜单":"编辑菜单"),m=u(null),o=W({id:void 0,title:"",path:"",component:"",layout:"default",icon:"",writer:"",parentid:void 0}),E={title:[{required:!0,message:"请输入菜单标题",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],path:[{required:!0,message:"请输入菜单路径",trigger:"blur"}],component:[{required:!0,message:"请输入组件路径",trigger:"blur"}],layout:[{required:!0,message:"请选择布局类型",trigger:"change"}]},S=async()=>{k.value=!0;try{const n=await _e();if(n.code===200){const e=n.data.list;D.value=U(e,0),I.value=[{id:0,title:"顶级菜单",children:U([...e],0)}]}else v.error(n.message||"获取菜单列表失败")}catch(n){console.error("获取菜单列表失败",n),v.error("获取菜单列表失败")}finally{k.value=!1}},U=(n,e)=>n.filter(d=>d.parentid===e).map(d=>{const s=U(n,d.id);return{...d,children:s.length?s:void 0}}),$=()=>{m.value&&m.value.resetFields(),o.id=void 0,o.title="",o.path="",o.component="",o.layout="default",o.icon="",o.parentid=void 0,o.writer=""},T=()=>{i.value="add",$(),_.value=!0},q=async n=>{i.value="edit",$();try{const e=await ge({id:n.id});if(e.success)Object.assign(o,e.data.menu),o.layout||(o.layout="default");else{v.error(e.message||"获取菜单详情失败");return}}catch(e){console.error("获取菜单详情失败",e),v.error("获取菜单详情失败");return}_.value=!0},y=n=>{ye.confirm(`确认删除菜单"${n.title}"吗？删除后其子菜单也将被删除！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{try{const e=await be({id:n.id});e.success?(v.success("删除成功"),S()):v.error(e.message||"删除失败")}catch(e){console.error("删除菜单失败",e),v.error("删除菜单失败")}}).catch(()=>{v.info("已取消删除")})},p=()=>{m.value&&m.value.validate(async n=>{var e;if(n){const d={...o,parentid:o.parentid===void 0?0:o.parentid,icon:((e=o.icon)==null?void 0:e.replace(/^el-icon-/,""))||""};V.value=!0;try{let s;i.value==="add"?s=await Ve(d):s=await he(d),s.success?(v.success(i.value==="add"?"新增成功":"修改成功"),_.value=!1,S()):v.error(s.message||"保存失败")}catch(s){console.error("保存菜单失败",s),v.error("保存菜单失败")}finally{V.value=!1}}})};return X(()=>{S()}),(n,e)=>{const d=r("el-icon"),s=r("el-button"),g=r("el-table-column"),R=r("el-tag"),z=r("el-table"),f=r("el-card"),O=r("el-tree-select"),h=r("el-form-item"),B=r("el-input"),F=r("el-option"),Z=r("el-select"),J=r("el-form"),K=r("el-dialog"),Q=de("loading");return c(),x("div",Ie,[l(f,{class:"box-card"},{header:t(()=>[w("div",Me,[e[10]||(e[10]=w("span",{class:"title"},"菜单管理",-1)),l(s,{type:"primary",onClick:T},{default:t(()=>[l(d,null,{default:t(()=>[l(N(ue))]),_:1}),e[9]||(e[9]=C("新增菜单 "))]),_:1})])]),default:t(()=>[ce((c(),b(z,{data:D.value,border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266"}},{default:t(()=>[l(g,{prop:"id",label:"ID",width:"80",align:"center"}),l(g,{prop:"title",label:"菜单名称","min-width":"120"}),l(g,{prop:"path",label:"路径","min-width":"150"}),l(g,{prop:"component",label:"组件路径","min-width":"150"}),l(g,{prop:"writer",label:"创建人",width:"100",align:"center"}),l(g,{prop:"layout",label:"布局",width:"100",align:"center"},{default:t(({row:a})=>[a.layout?(c(),b(R,{key:0},{default:t(()=>[C(pe(a.layout),1)]),_:2},1024)):(c(),x("span",Se,"-"))]),_:1}),l(g,{prop:"icon",label:"图标",width:"100",align:"center"},{default:t(({row:a})=>[a.icon?(c(),b(d,{key:0},{default:t(()=>[(c(),b(A(a.icon.replace("el-icon-",""))))]),_:2},1024)):(c(),x("div",{key:1,class:me(`i-svg:${a.icon}`)},null,2))]),_:1}),l(g,{label:"操作",width:"180",align:"center"},{default:t(({row:a})=>[l(s,{type:"primary",size:"small",onClick:ee=>q(a)},{default:t(()=>[l(d,null,{default:t(()=>[l(N(fe))]),_:1}),e[11]||(e[11]=C("编辑 "))]),_:2},1032,["onClick"]),l(s,{type:"danger",size:"small",onClick:ee=>y(a)},{default:t(()=>[l(d,null,{default:t(()=>[l(N(ve))]),_:1}),e[12]||(e[12]=C("删除 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]])]),_:1}),l(K,{title:M.value,modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),width:"550px",onClosed:$,"destroy-on-close":""},{footer:t(()=>[w("div",Ue,[l(s,{onClick:e[7]||(e[7]=a=>_.value=!1)},{default:t(()=>e[14]||(e[14]=[C("取 消")])),_:1}),l(s,{type:"primary",onClick:p,loading:V.value},{default:t(()=>e[15]||(e[15]=[C("确 定")])),_:1},8,["loading"])])]),default:t(()=>[l(J,{ref_key:"formRef",ref:m,model:o,rules:E,"label-width":"100px","status-icon":""},{default:t(()=>[l(h,{label:"上级菜单",prop:"parentid"},{default:t(()=>[l(O,{modelValue:o.parentid,"onUpdate:modelValue":e[0]||(e[0]=a=>o.parentid=a),data:I.value,props:{label:"title",children:"children",value:"id"},placeholder:"请选择上级菜单，不选择则为顶级菜单","check-strictly":"",style:{width:"100%"},clearable:""},null,8,["modelValue","data"])]),_:1}),l(h,{label:"菜单标题",prop:"title"},{default:t(()=>[l(B,{modelValue:o.title,"onUpdate:modelValue":e[1]||(e[1]=a=>o.title=a),placeholder:"请输入菜单标题"},null,8,["modelValue"])]),_:1}),l(h,{label:"菜单路径",prop:"path"},{default:t(()=>[l(B,{modelValue:o.path,"onUpdate:modelValue":e[2]||(e[2]=a=>o.path=a),placeholder:"请输入菜单路径，例如：/system/user"},null,8,["modelValue"])]),_:1}),l(h,{label:"组件路径",prop:"component"},{default:t(()=>[l(B,{modelValue:o.component,"onUpdate:modelValue":e[3]||(e[3]=a=>o.component=a),placeholder:"请输入组件路径，例如：system/user"},null,8,["modelValue"]),e[13]||(e[13]=w("div",{class:"form-tip"},"组件路径为相对于@/views的路径，不需要带.vue后缀",-1))]),_:1}),l(h,{label:"布局类型",prop:"layout"},{default:t(()=>[l(Z,{modelValue:o.layout,"onUpdate:modelValue":e[4]||(e[4]=a=>o.layout=a),placeholder:"请选择布局类型",style:{width:"100%"}},{default:t(()=>[l(F,{label:"默认布局",value:"default"}),l(F,{label:"简单布局",value:"simple"}),l(F,{label:"无布局",value:"none"})]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"菜单图标",prop:"icon"},{default:t(()=>[l(xe,{modelValue:o.icon,"onUpdate:modelValue":e[5]||(e[5]=a=>o.icon=a)},null,8,["modelValue"])]),_:1}),l(h,{label:"创建人",prop:"writer"},{default:t(()=>[l(B,{modelValue:o.writer,"onUpdate:modelValue":e[6]||(e[6]=a=>o.writer=a),placeholder:"请输入菜单创建人"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},Ee=Y($e,[["__scopeId","data-v-6f8ec880"]]);export{Ee as default};
